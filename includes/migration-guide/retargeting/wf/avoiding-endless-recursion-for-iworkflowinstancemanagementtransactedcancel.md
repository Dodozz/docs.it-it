---
ms.openlocfilehash: 5850e3359dab6503d5745a2266c7bf77780e5cc0
ms.sourcegitcommit: 0aca6c5d166d7961a1e354c248495645b97a1dc5
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 04/01/2019
ms.locfileid: "58760824"
---
### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a>Evitare la ricorsione infinita per IWorkflowInstanceManagement.TransactedCancel e IWorkflowInstanceManagement.TransactedTerminate

|   |   |
|---|---|
|Dettagli|In alcune circostanze, quando si usa l'API <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> per annullare o terminare un'istanza del servizio del flusso di lavoro, nell'istanza del flusso di lavoro può verificarsi un overflow dello stack a causa della ricorsione infinita quando il runtime di <code>Workflow</code> tenta di rendere persistente l'istanza del servizio nell'ambito dell'elaborazione della richiesta. Il problema si verifica se l'istanza del flusso di lavoro si trova in uno stato di attesa del completamento di un'altra richiesta WCF in sospeso a un altro servizio. Le operazioni <code>TransactedCancel</code> e <code>TransactedTerminate</code> creano elementi di lavoro in coda per l'istanza del servizio del flusso di lavoro. Questi elementi di lavoro non vengono eseguiti nell'ambito dell'elaborazione della richiesta <code>TransactedCancel/TransactedTerminate</code>. Poiché l'istanza del servizio del flusso di lavoro è in attesa del completamento dell'altra richiesta WCF in sospeso, l'elemento di lavoro creato rimane in coda. L'operazione <code>TransactedCancel/TransactedTerminate</code> viene completata e il controllo torna al client. Quando la transazione associata all'operazione <code>TransactedCancel/TransactedTerminate</code> tenta di eseguire il commit, è necessario che lo stato dell'istanza del servizio del flusso di lavoro sia persistente. Tuttavia, la presenza di una richiesta <code>WCF</code> in sospeso per l'istanza impedisce al runtime di Workflow di rendere persistente l'istanza del servizio del flusso di lavoro e un ciclo di ricorsione infinito determina l'overflow dello stack. Dal momento che <code>TransactedCancel</code> e <code>TransactedTerminate</code> creano un elemento di lavoro solo in memoria, l'esistenza di una transazione non produce alcun effetto. Il rollback della transazione non rimuove l'elemento di lavoro. Per risolvere questo problema, a partire da .NET Framework 4.7.2, è stato introdotto un elemento <code>AppSetting</code> che può essere aggiunto al file <code>web.config/app.config</code> del servizio del flusso di lavoro che indica a quest'ultimo di ignorare le transazioni per <code>TransactedCancel</code> e <code>TransactedTerminate</code>. Ciò consente il commit della transazione senza attendere che l'istanza del flusso di lavoro sia persistente. L'elemento AppSetting per questa funzionalità è denominato <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>. Il valore <code>true</code> indica che la transazione deve essere ignorata, evitando quindi l'overflow dello stack. Il valore predefinito di AppSetting è <code>false</code>, quindi le istanze del servizio del flusso di lavoro esistenti non sono interessate.|
|Suggerimento|Se si usa AppFabric o un altro client <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> e si riscontra un overflow dello stack nell'istanza del servizio del flusso di lavoro quando si tenta di annullare o terminare un'istanza, è possibile aggiungere il codice seguente alla sezione <code>&lt;appSettings&gt;</code> del file web.config/app.config per il servizio del flusso di lavoro:<pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre>Se il problema non si verifica, questa operazione non è necessaria.|
|Ambito|Microsoft Edge|
|Versione|4.7.2|
|Tipo|Ridestinazione|

