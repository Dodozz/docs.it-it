---
title: Operazioni interlocked
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- Interlocked class, about Interlocked class
- threading [.NET Framework], Interlocked class
ms.assetid: cbda7114-c752-4f3e-ada1-b1e8dd262f2b
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 069a95656e7ceaf454c01c47d61ff391bcbed2fe
ms.sourcegitcommit: 2350a091ef6459f0fcfd894301242400374d8558
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 09/21/2018
ms.locfileid: "46538885"
---
# <a name="interlocked-operations"></a><span data-ttu-id="9390e-102">Operazioni interlocked</span><span class="sxs-lookup"><span data-stu-id="9390e-102">Interlocked operations</span></span>

<span data-ttu-id="9390e-103">La classe <xref:System.Threading.Interlocked?displayProperty=nameWithType> fornisce metodi per la sincronizzazione dell'accesso a una variabile condivisa da più thread.</span><span class="sxs-lookup"><span data-stu-id="9390e-103">The <xref:System.Threading.Interlocked?displayProperty=nameWithType> class provides methods that synchronize access to a variable that is shared by multiple threads.</span></span> <span data-ttu-id="9390e-104">I thread di processi differenti possono usare questo meccanismo se la variabile si trova nella memoria condivisa.</span><span class="sxs-lookup"><span data-stu-id="9390e-104">The threads of different processes can use this mechanism if the variable is in shared memory.</span></span> <span data-ttu-id="9390e-105">Le operazioni interlocked sono atomiche, ovvero un'intera operazione costituisce un'unità che non può essere interrotta da un'altra operazione nella stessa variabile.</span><span class="sxs-lookup"><span data-stu-id="9390e-105">Interlocked operations are atomic — that is, the entire operation is a unit that cannot be interrupted by another operation on the same variable.</span></span> <span data-ttu-id="9390e-106">Questa caratteristica è importante nei sistemi operativi con multithreading preemptive in cui un thread può essere sospeso dopo il caricamento di un valore da un indirizzo di memoria, ma prima che sia possibile modificarlo e memorizzarlo.</span><span class="sxs-lookup"><span data-stu-id="9390e-106">This is important in operating systems with preemptive multithreading, where a thread can be suspended after loading a value from a memory address, but before having the chance to alter it and store it.</span></span>  
  
 <span data-ttu-id="9390e-107">La classe <xref:System.Threading.Interlocked> fornisce le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="9390e-107">The <xref:System.Threading.Interlocked> class provides the following operations:</span></span>  
  
-   <span data-ttu-id="9390e-108">Il metodo <xref:System.Threading.Interlocked.Add%2A?displayProperty=nameWithType> aggiunge un valore intero a una variabile e restituisce il nuovo valore della variabile.</span><span class="sxs-lookup"><span data-stu-id="9390e-108">The <xref:System.Threading.Interlocked.Add%2A?displayProperty=nameWithType> method adds an integer value to a variable and returns the new value of the variable.</span></span>  
  
-   <span data-ttu-id="9390e-109">Il metodo <xref:System.Threading.Interlocked.Read%2A?displayProperty=nameWithType> legge un valore intero a 64 bit come operazione atomica.</span><span class="sxs-lookup"><span data-stu-id="9390e-109">The <xref:System.Threading.Interlocked.Read%2A?displayProperty=nameWithType> method reads a 64-bit integer value as an atomic operation.</span></span> <span data-ttu-id="9390e-110">Questa caratteristica è utile nei sistemi a 32 bit in cui la lettura di un valore integer a 64 bit non è normalmente un'operazione atomica.</span><span class="sxs-lookup"><span data-stu-id="9390e-110">This is useful on 32-bit operating systems, where reading a 64-bit integer is not ordinarily an atomic operation.</span></span>  
  
-   <span data-ttu-id="9390e-111">I metodi <xref:System.Threading.Interlocked.Increment%2A?displayProperty=nameWithType> e <xref:System.Threading.Interlocked.Decrement%2A?displayProperty=nameWithType> aumentano o riducono il valore di una variabile e restituiscono il valore risultante.</span><span class="sxs-lookup"><span data-stu-id="9390e-111">The <xref:System.Threading.Interlocked.Increment%2A?displayProperty=nameWithType> and <xref:System.Threading.Interlocked.Decrement%2A?displayProperty=nameWithType> methods increment or decrement a variable and return the resulting value.</span></span>  
  
-   <span data-ttu-id="9390e-112">Il metodo <xref:System.Threading.Interlocked.Exchange%2A?displayProperty=nameWithType> esegue uno scambio atomico del valore in una variabile specificata, restituendo il valore e sostituendolo con un nuovo valore.</span><span class="sxs-lookup"><span data-stu-id="9390e-112">The <xref:System.Threading.Interlocked.Exchange%2A?displayProperty=nameWithType> method performs an atomic exchange of the value in a specified variable, returning that value and replacing it with a new value.</span></span> <span data-ttu-id="9390e-113">Usare un overload <xref:System.Threading.Interlocked.Exchange%60%601%28%60%600%40%2C%60%600%29> generico di questo metodo per eseguire lo scambio in una variabile di qualsiasi tipo riferimento.</span><span class="sxs-lookup"><span data-stu-id="9390e-113">Use a generic <xref:System.Threading.Interlocked.Exchange%60%601%28%60%600%40%2C%60%600%29> overload of this method to perform the exchange on a variable of any reference type.</span></span>  
  
-   <span data-ttu-id="9390e-114">Anche il metodo <xref:System.Threading.Interlocked.CompareExchange%2A?displayProperty=nameWithType> scambia due valori, ma in base al risultato di un confronto.</span><span class="sxs-lookup"><span data-stu-id="9390e-114">The <xref:System.Threading.Interlocked.CompareExchange%2A?displayProperty=nameWithType> method also exchanges two values, but contingent on the result of a comparison.</span></span> <span data-ttu-id="9390e-115">Usare un overload <xref:System.Threading.Interlocked.CompareExchange%60%601%28%60%600%40%2C%60%600%2C%60%600%29> generico di questo metodo per eseguire lo scambio in una variabile di qualsiasi tipo riferimento.</span><span class="sxs-lookup"><span data-stu-id="9390e-115">Use a generic <xref:System.Threading.Interlocked.CompareExchange%60%601%28%60%600%40%2C%60%600%2C%60%600%29> overload of this method to perform the exchange on a variable of any reference type.</span></span>  
  
 <span data-ttu-id="9390e-116">Nei processori moderni i metodi della classe <xref:System.Threading.Interlocked> possono essere spesso implementati da una singola istruzione.</span><span class="sxs-lookup"><span data-stu-id="9390e-116">On modern processors, the methods of the <xref:System.Threading.Interlocked> class can often be implemented by a single instruction.</span></span> <span data-ttu-id="9390e-117">In questo modo, offrono una sincronizzazione ad alte prestazioni e possono essere usati per compilare meccanismi di sincronizzazione di livello più elevato, come gli spinlock.</span><span class="sxs-lookup"><span data-stu-id="9390e-117">Thus, they provide very high-performance synchronization and can be used to build higher-level synchronization mechanisms, like spin locks.</span></span>  
  
 <span data-ttu-id="9390e-118">Per un esempio che usa le classi <xref:System.Threading.Monitor> e <xref:System.Threading.Interlocked> in combinazione, vedere [Monitor](https://msdn.microsoft.com/library/33fe4aef-b44b-42fd-9e72-c908e39e75db).</span><span class="sxs-lookup"><span data-stu-id="9390e-118">For an example that uses the <xref:System.Threading.Monitor> and <xref:System.Threading.Interlocked> classes in combination, see [Monitors](https://msdn.microsoft.com/library/33fe4aef-b44b-42fd-9e72-c908e39e75db).</span></span>  
  
## <a name="compareexchange-example"></a><span data-ttu-id="9390e-119">Esempio di CompareExchange</span><span class="sxs-lookup"><span data-stu-id="9390e-119">CompareExchange example</span></span>

 <span data-ttu-id="9390e-120">Il metodo <xref:System.Threading.Interlocked.CompareExchange%2A> può essere usato per la protezione di calcoli più complessi rispetto al semplice incremento o decremento.</span><span class="sxs-lookup"><span data-stu-id="9390e-120">The <xref:System.Threading.Interlocked.CompareExchange%2A> method can be used to protect computations that are more complicated than simple increment and decrement.</span></span> <span data-ttu-id="9390e-121">L'esempio seguente illustra un metodo thread-safe che aggiunge un totale parziale memorizzato come numero a virgola mobile.</span><span class="sxs-lookup"><span data-stu-id="9390e-121">The following example demonstrates a thread-safe method that adds to a running total stored as a floating point number.</span></span> <span data-ttu-id="9390e-122">Per i valori interi, il metodo <xref:System.Threading.Interlocked.Add%2A> rappresenta una soluzione più semplice. Per esempi di codice completi, vedere gli overload di <xref:System.Threading.Interlocked.CompareExchange%2A> che accettano argomenti a virgola mobile a precisione singola e precisione doppia (<xref:System.Threading.Interlocked.CompareExchange%28System.Single%40%2CSystem.Single%2CSystem.Single%29> e <xref:System.Threading.Interlocked.CompareExchange%28System.Double%40%2CSystem.Double%2CSystem.Double%29>).</span><span class="sxs-lookup"><span data-stu-id="9390e-122">(For integers, the <xref:System.Threading.Interlocked.Add%2A> method is a simpler solution.) For complete code examples, see the overloads of <xref:System.Threading.Interlocked.CompareExchange%2A> that take single-precision and double-precision floating-point arguments (<xref:System.Threading.Interlocked.CompareExchange%28System.Single%40%2CSystem.Single%2CSystem.Single%29> and <xref:System.Threading.Interlocked.CompareExchange%28System.Double%40%2CSystem.Double%2CSystem.Double%29>).</span></span>  
  
 [!code-cpp[Conceptual.Interlocked#1](../../../samples/snippets/cpp/VS_Snippets_CLR/conceptual.interlocked/cpp/source1.cpp#1)]
 [!code-csharp[Conceptual.Interlocked#1](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.interlocked/cs/source1.cs#1)]
 [!code-vb[Conceptual.Interlocked#1](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.interlocked/vb/source1.vb#1)]  
  
## <a name="untyped-overloads-of-exchange-and-compareexchange"></a><span data-ttu-id="9390e-123">Overload non tipizzati di Exchange e CompareExchange</span><span class="sxs-lookup"><span data-stu-id="9390e-123">Untyped overloads of Exchange and CompareExchange</span></span>

 <span data-ttu-id="9390e-124">I metodi <xref:System.Threading.Interlocked.Exchange%2A> e <xref:System.Threading.Interlocked.CompareExchange%2A> hanno overload che accettano argomenti di tipo <xref:System.Object>.</span><span class="sxs-lookup"><span data-stu-id="9390e-124">The <xref:System.Threading.Interlocked.Exchange%2A> and <xref:System.Threading.Interlocked.CompareExchange%2A> methods have overloads that take arguments of type <xref:System.Object>.</span></span> <span data-ttu-id="9390e-125">Il primo argomento di ognuno di questi overload è `ref Object` (`ByRef … As Object` in Visual Basic) e, per garantire l'indipendenza dai tipi, la variabile passata a questo argomento deve essere rigorosamente di tipo <xref:System.Object>. Non è possibile eseguire semplicemente il cast del primo argomento nel tipo <xref:System.Object> quando si chiamano questi metodi.</span><span class="sxs-lookup"><span data-stu-id="9390e-125">The first argument of each of these overloads is `ref Object` (`ByRef … As Object` in Visual Basic), and type safety requires the variable passed to this argument to be typed strictly as <xref:System.Object>; you cannot simply cast the first argument to type <xref:System.Object> when calling these methods.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="9390e-126">In .NET Framework versione 2.0 e successive usare gli overload generici dei metodi <xref:System.Threading.Interlocked.Exchange%2A> e <xref:System.Threading.Interlocked.CompareExchange%2A> per lo scambio di variabili fortemente tipizzate.</span><span class="sxs-lookup"><span data-stu-id="9390e-126">In the .NET Framework version 2.0 and later, use the generic overloads of the <xref:System.Threading.Interlocked.Exchange%2A> and <xref:System.Threading.Interlocked.CompareExchange%2A> methods to exchange strongly typed variables.</span></span>  
  
 <span data-ttu-id="9390e-127">L'esempio di codice seguente illustra una proprietà di tipo `ClassA` che può essere impostata una sola volta poiché può essere implementata in .NET Framework versione 1.0 o 1.1.</span><span class="sxs-lookup"><span data-stu-id="9390e-127">The following code example shows a property of type `ClassA` that can be set only once, as it might be implemented in the .NET Framework version 1.0 or 1.1.</span></span>  
  
 [!code-cpp[Conceptual.Interlocked#2](../../../samples/snippets/cpp/VS_Snippets_CLR/conceptual.interlocked/cpp/source2.cpp#2)]
 [!code-csharp[Conceptual.Interlocked#2](../../../samples/snippets/csharp/VS_Snippets_CLR/conceptual.interlocked/cs/source2.cs#2)]
 [!code-vb[Conceptual.Interlocked#2](../../../samples/snippets/visualbasic/VS_Snippets_CLR/conceptual.interlocked/vb/source2.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="9390e-128">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="9390e-128">See also</span></span>

- <xref:System.Threading.Interlocked?displayProperty=nameWithType>  
- <xref:System.Threading.Monitor?displayProperty=nameWithType>  
- [<span data-ttu-id="9390e-129">Threading</span><span class="sxs-lookup"><span data-stu-id="9390e-129">Threading</span></span>](index.md)  
- [<span data-ttu-id="9390e-130">Oggetti e funzionalità del threading</span><span class="sxs-lookup"><span data-stu-id="9390e-130">Threading objects and features</span></span>](threading-objects-and-features.md)
