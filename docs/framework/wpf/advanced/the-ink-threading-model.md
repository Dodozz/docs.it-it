---
title: Modello di threading dell'input penna
ms.date: 03/30/2017
helpviewer_keywords:
- application user interface thread [WPF]
- stylus plug-in
- ink threading model [WPF]
- ink [WPF], rendering
- pen thread [WPF]
- threading model [WPF]
- rendering ink [WPF]
- dynamic rendering thread [WPF]
- ink collection plug-in
- plug-ins [WPF], for ink
ms.assetid: c85fcad1-cb50-4431-847c-ac4145a35c89
ms.openlocfilehash: 80e7ef202c46a23069766512cf4e67bb21a49564
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/09/2019
ms.locfileid: "59335320"
---
# <a name="the-ink-threading-model"></a><span data-ttu-id="a0e5a-102">Modello di threading dell'input penna</span><span class="sxs-lookup"><span data-stu-id="a0e5a-102">The Ink Threading Model</span></span>
<span data-ttu-id="a0e5a-103">Uno dei vantaggi dell'input penna su un Tablet PC è che presenta notevoli analogie con la scrittura con una carta e penna regolare.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-103">One of the benefits of ink on a Tablet PC is that it feels a lot like writing with a regular pen and paper.</span></span>  <span data-ttu-id="a0e5a-104">A tale scopo, la penna del tablet PC raccoglie i dati di input con una frequenza molto più elevato rispetto a un mouse ed esegue il rendering dell'input penna mentre l'utente scrive.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-104">To accomplish this, the tablet pen collects input data at a much higher rate than a mouse does and renders the ink as the user writes.</span></span>  <span data-ttu-id="a0e5a-105">Thread dell'interfaccia utente dell'applicazione non è sufficiente per la raccolta dei dati della penna e rendering di input penna, perché può essere bloccato.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-105">The application's user interface (UI) thread is not sufficient for collecting pen data and rendering ink, because it can become blocked.</span></span>  <span data-ttu-id="a0e5a-106">Per risolvere il problema, un [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] applicazione utilizza due thread aggiuntivi quando l'utente scrive tramite input penna.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-106">To solve this, a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application uses two additional threads when a user writes ink.</span></span>  
  
 <span data-ttu-id="a0e5a-107">L'elenco seguente descrive il thread che partecipano nella raccolta e il rendering dell'input penna digitale:</span><span class="sxs-lookup"><span data-stu-id="a0e5a-107">The following list describes the threads that take part in collecting and rendering digital ink:</span></span>  
  
-   <span data-ttu-id="a0e5a-108">Thread di penna - il thread che accetta l'input dallo stilo.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-108">Pen thread - the thread that takes input from the stylus.</span></span>  <span data-ttu-id="a0e5a-109">(In realtà, si tratta di un pool di thread, ma in questo argomento fa riferimento a esso come un thread di penna).</span><span class="sxs-lookup"><span data-stu-id="a0e5a-109">(In reality, this is a thread pool, but this topic refers to it as a pen thread.)</span></span>  
  
-   <span data-ttu-id="a0e5a-110">Thread interfaccia utente dell'applicazione - il thread che controlla l'interfaccia utente dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-110">Application user interface thread - the thread that controls the user interface of the application.</span></span>  
  
-   <span data-ttu-id="a0e5a-111">Thread di rendering dinamico - il thread che esegue il rendering dell'input penna mentre l'utente consente di disegnare un tratto.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-111">Dynamic rendering thread - the thread that renders the ink while the user draws a stroke.</span></span> <span data-ttu-id="a0e5a-112">Il thread di rendering dinamico è diverso rispetto al thread che esegue il rendering di altri elementi dell'interfaccia utente per l'applicazione, come indicato in Windows Presentation Foundation [modello di Threading](threading-model.md).</span><span class="sxs-lookup"><span data-stu-id="a0e5a-112">The dynamic rendering thread is different than the thread that renders other UI elements for the application, as mentioned in Window Presentation Foundation [Threading Model](threading-model.md).</span></span>  
  
 <span data-ttu-id="a0e5a-113">Il modello di input penna non cambiano se l'applicazione usa la <xref:System.Windows.Controls.InkCanvas> o un controllo personalizzato simile a quello riportato nella [creazione di un controllo Input penna](creating-an-ink-input-control.md).</span><span class="sxs-lookup"><span data-stu-id="a0e5a-113">The inking model is the same whether the application uses the <xref:System.Windows.Controls.InkCanvas> or a custom control similar to the one in [Creating an Ink Input Control](creating-an-ink-input-control.md).</span></span>  <span data-ttu-id="a0e5a-114">Anche se il threading in termini di questo argomento viene descritto il <xref:System.Windows.Controls.InkCanvas>, gli stessi concetti si applicano quando si crea un controllo personalizzato.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-114">Although this topic discusses threading in terms of the <xref:System.Windows.Controls.InkCanvas>, the same concepts apply when you create a custom control.</span></span>  
  
## <a name="threading-overview"></a><span data-ttu-id="a0e5a-115">Cenni preliminari sul threading</span><span class="sxs-lookup"><span data-stu-id="a0e5a-115">Threading Overview</span></span>  
 <span data-ttu-id="a0e5a-116">Quando un utente consente di disegnare un tratto, il diagramma seguente illustra il modello di threading:</span><span class="sxs-lookup"><span data-stu-id="a0e5a-116">The following diagram illustrates the threading model when a user draws a stroke:</span></span>  
  
 <span data-ttu-id="a0e5a-117">![Modello di threading nel disegno di un tratto. ](./media/inkthreading-drawingink.png "InkThreading_DrawingInk")</span><span class="sxs-lookup"><span data-stu-id="a0e5a-117">![Threading model while drawing a stroke.](./media/inkthreading-drawingink.png "InkThreading_DrawingInk")</span></span>  
  
1. <span data-ttu-id="a0e5a-118">Azioni che si verificano mentre l'utente lo disegna</span><span class="sxs-lookup"><span data-stu-id="a0e5a-118">Actions occurring while the user draws the stroke</span></span>  
  
    1.  <span data-ttu-id="a0e5a-119">Quando l'utente consente di disegnare un tratto, i punti dello stilo sono disponibili in sul thread di penna.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-119">When the user draws a stroke, the stylus points come in on the pen thread.</span></span>  <span data-ttu-id="a0e5a-120">Plug-in dello stilo, tra cui il <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, accettare i punti dello stilo sul thread di penna e ha la possibilità di modificarli prima di <xref:System.Windows.Controls.InkCanvas> li riceve.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-120">Stylus plug-ins, including the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, accept the stylus points on the pen thread and have the chance to modify them before the <xref:System.Windows.Controls.InkCanvas> receives them.</span></span>  
  
    2.  <span data-ttu-id="a0e5a-121">Il <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> esegue il rendering dei punti dello stilo nel thread di rendering dinamico.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-121">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renders the stylus points on the dynamic rendering thread.</span></span> <span data-ttu-id="a0e5a-122">Ciò si verifica nello stesso momento del passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-122">This happens at the same time as the previous step.</span></span>  
  
    3.  <span data-ttu-id="a0e5a-123">Il <xref:System.Windows.Controls.InkCanvas> riceve i punti dello stilo sul thread UI.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-123">The <xref:System.Windows.Controls.InkCanvas> receives the stylus points on the UI thread.</span></span>  
  
2. <span data-ttu-id="a0e5a-124">Azioni che si verificano dopo che l'utente termina il tratto</span><span class="sxs-lookup"><span data-stu-id="a0e5a-124">Actions occurring after the user ends the stroke</span></span>  
  
    1.  <span data-ttu-id="a0e5a-125">Quando l'utente completa il disegno del tratto, la <xref:System.Windows.Controls.InkCanvas> crea un' <xref:System.Windows.Ink.Stroke> dell'oggetto e lo aggiunge al <xref:System.Windows.Controls.InkPresenter>, che in modo statico ne esegue il rendering.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-125">When the user finishes drawing the stroke, the <xref:System.Windows.Controls.InkCanvas> creates a <xref:System.Windows.Ink.Stroke> object and adds it to the <xref:System.Windows.Controls.InkPresenter>, which statically renders it.</span></span>  
  
    2.  <span data-ttu-id="a0e5a-126">Gli avvisi di thread dell'interfaccia utente di <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> che in modo statico di rendering del tratto, pertanto la <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> rimuove la rappresentazione visiva del tratto.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-126">The UI thread alerts the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> that the stroke is statically rendered, so the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> removes its visual representation of the stroke.</span></span>  
  
## <a name="ink-collection-and-stylus-plug-ins"></a><span data-ttu-id="a0e5a-127">Raccolta di input penna e Plug-in dello stilo</span><span class="sxs-lookup"><span data-stu-id="a0e5a-127">Ink collection and Stylus Plug-ins</span></span>  
 <span data-ttu-id="a0e5a-128">Ciascuna <xref:System.Windows.UIElement> ha un <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-128">Each <xref:System.Windows.UIElement> has a <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span></span>  <span data-ttu-id="a0e5a-129">Il <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> oggetti nel <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection> ricevono e possono modificare i punti dello stilo sul thread di penna.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-129">The <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objects in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection> receive and can modify the stylus points on the pen thread.</span></span> <span data-ttu-id="a0e5a-130">Il <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> gli oggetti ricevono i punti dello stilo in base al relativo ordine nella <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-130">The <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objects receive the stylus points according to their order in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span></span>  
  
 <span data-ttu-id="a0e5a-131">Il diagramma seguente illustra lo scenario ipotetico in cui il <xref:System.Windows.UIElement.StylusPlugIns%2A> raccolta di un <xref:System.Windows.UIElement> contiene `stylusPlugin1`, una <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, e `stylusPlugin2`, in questo ordine.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-131">The following diagram illustrates the hypothetical situation where the <xref:System.Windows.UIElement.StylusPlugIns%2A> collection of a <xref:System.Windows.UIElement> contains `stylusPlugin1`, a <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, and `stylusPlugin2`, in that order.</span></span>  
  
 <span data-ttu-id="a0e5a-132">![Ordine di StylusPlugIns influisce sull'output. ](./media/inkthreading-pluginorder.png "InkThreading_PluginOrder")</span><span class="sxs-lookup"><span data-stu-id="a0e5a-132">![Order of Stylus Plugins affect output.](./media/inkthreading-pluginorder.png "InkThreading_PluginOrder")</span></span>  
  
 <span data-ttu-id="a0e5a-133">Nel diagramma precedente, il comportamento seguente viene eseguita:</span><span class="sxs-lookup"><span data-stu-id="a0e5a-133">In the previous diagram, the following behavior takes place:</span></span>  
  
1. `StylusPlugin1` <span data-ttu-id="a0e5a-134">Modifica i valori per x e y.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-134">modifies the values for x and y.</span></span>  
  
2. <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> <span data-ttu-id="a0e5a-135">riceve i punti dello stilo modificato e ne esegue il rendering nel thread di rendering dinamico.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-135">receives the modified stylus points and renders them on the dynamic rendering thread.</span></span>  
  
3. `StylusPlugin2` <span data-ttu-id="a0e5a-136">riceve i punti dello stilo modificato e ulteriore modifica i valori per x e y.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-136">receives the modified stylus points and further modifies the values for x and y.</span></span>  
  
4. <span data-ttu-id="a0e5a-137">L'applicazione raccoglie i punti dello stilo e, quando l'utente completa del tratto, in modo statico viene eseguito il rendering del tratto.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-137">The application collects the stylus points, and, when the user finishes the stroke, statically renders the stroke.</span></span>  
  
 <span data-ttu-id="a0e5a-138">Si supponga che `stylusPlugin1` limita i punti dello stilo a un rettangolo e `stylusPlugin2` converte i punti dello stilo a destra.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-138">Suppose that `stylusPlugin1` restricts the stylus points to a rectangle and `stylusPlugin2` translates the stylus points to the right.</span></span>  <span data-ttu-id="a0e5a-139">Nello scenario precedente, il <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> riceve i punti dello stilo limitato, ma non i punti dello stilo tradotti.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-139">In the previous scenario, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> receives the restricted stylus points, but not the translated stylus points.</span></span>  <span data-ttu-id="a0e5a-140">Quando l'utente lo disegna, entro i limiti del rettangolo di rendering del tratto, ma il tratto non sembra essere tradotto fino a quando l'utente solleva la penna.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-140">When the user draws the stroke, the stroke is rendered within the bounds of the rectangle, but the stroke doesn't appear to be translated until the user lifts the pen.</span></span>  
  
### <a name="performing-operations-with-a-stylus-plug-in-on-the-ui-thread"></a><span data-ttu-id="a0e5a-141">Esecuzione di operazioni con uno stilo plug-in sul thread UI</span><span class="sxs-lookup"><span data-stu-id="a0e5a-141">Performing operations with a Stylus Plug-in on the UI thread</span></span>  
 <span data-ttu-id="a0e5a-142">Poiché hit test accurati non possono essere eseguite sul thread di penna, alcuni elementi potrebbero ricevere occasionalmente input dello stilo destinato ad altri elementi.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-142">Because accurate hit-testing cannot be performed on the pen thread, some elements might occasionally receive stylus input intended for other elements.</span></span> <span data-ttu-id="a0e5a-143">Se è necessario assicurarsi che l'input è stato instradato correttamente prima di eseguire un'operazione, sottoscrivere ed eseguire l'operazione dei <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusDownProcessed%2A>, <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusMoveProcessed%2A>, o <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusUpProcessed%2A> (metodo).</span><span class="sxs-lookup"><span data-stu-id="a0e5a-143">If you need to make sure the input was routed correctly before performing an operation, subscribe to and perform the operation in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusDownProcessed%2A>, <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusMoveProcessed%2A>, or <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusUpProcessed%2A> method.</span></span> <span data-ttu-id="a0e5a-144">Questi metodi vengono richiamati dal thread dell'applicazione dopo l'esecuzione di hit test accurati.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-144">These methods are invoked by the application thread after accurate hit-testing has been performed.</span></span> <span data-ttu-id="a0e5a-145">Per eseguire la sottoscrizione a questi metodi, chiamare il <xref:System.Windows.Input.StylusPlugIns.RawStylusInput.NotifyWhenProcessed%2A> metodo nel metodo che si verifica nel thread di penna.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-145">To subscribe to these methods, call the <xref:System.Windows.Input.StylusPlugIns.RawStylusInput.NotifyWhenProcessed%2A> method in the method that occurs on the pen thread.</span></span>  
  
 <span data-ttu-id="a0e5a-146">Il diagramma seguente illustra la relazione tra il thread di penna e il thread dell'interfaccia utente per quanto riguarda gli eventi dello stilo di un <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn>.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-146">The following diagram illustrates the relationship between the pen thread and UI thread with respect to the stylus events of a <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn>.</span></span>  
  
 <span data-ttu-id="a0e5a-147">![Modelli di Threading dell'input penna &#40;dell'interfaccia utente e penna&#41;](./media/inkthreading-plugincallbacks.png "InkThreading_PluginCallbacks")</span><span class="sxs-lookup"><span data-stu-id="a0e5a-147">![Ink Threading Models &#40;UI and Pen&#41;](./media/inkthreading-plugincallbacks.png "InkThreading_PluginCallbacks")</span></span>  
  
## <a name="rendering-ink"></a><span data-ttu-id="a0e5a-148">Il rendering dell'input penna</span><span class="sxs-lookup"><span data-stu-id="a0e5a-148">Rendering Ink</span></span>  
 <span data-ttu-id="a0e5a-149">Quando l'utente consente di disegnare un tratto, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> esegue il rendering dell'input penna in un thread separato in modo che sembri "fluire" dalla penna anche quando il thread UI è occupato.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-149">As the user draws a stroke, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renders the ink on a separate thread so the ink appears to "flow" from the pen even when the UI thread is busy.</span></span>  <span data-ttu-id="a0e5a-150">Il <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> compila un struttura ad albero visuale nel thread di rendering dinamico che raccoglie i punti dello stilo.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-150">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> builds a visual tree on the dynamic rendering thread as it collects stylus points.</span></span>  <span data-ttu-id="a0e5a-151">Quando l'utente completa il tratto di <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> chiede di ricevere una notifica quando l'applicazione esegue il successivo passaggio di rendering.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-151">When the user finishes the stroke, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> asks to be notified when the application does the next rendering pass.</span></span>  <span data-ttu-id="a0e5a-152">Dopo l'applicazione ha completato il passaggio successivo per il rendering, il <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> pulisce la struttura ad albero visuale.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-152">After the application completes the next rendering pass, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cleans up its visual tree.</span></span>  <span data-ttu-id="a0e5a-153">Il diagramma seguente illustra questo processo.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-153">The following diagram illustrates this process.</span></span>  
  
 <span data-ttu-id="a0e5a-154">![Diagramma di threading dell'input penna](./media/inkthreading-visualtree.png "InkThreading_VisualTree")</span><span class="sxs-lookup"><span data-stu-id="a0e5a-154">![Ink threading diagram](./media/inkthreading-visualtree.png "InkThreading_VisualTree")</span></span>  
  
1. <span data-ttu-id="a0e5a-155">L'utente inizia il tratto.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-155">The user begins the stroke.</span></span>  
  
    1.  <span data-ttu-id="a0e5a-156">Il <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> crea la struttura ad albero visuale.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-156">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> creates the visual tree.</span></span>  
  
2. <span data-ttu-id="a0e5a-157">L'utente lo disegna il tratto.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-157">The user is drawing the stroke.</span></span>  
  
    1.  <span data-ttu-id="a0e5a-158">Il <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> compila la struttura ad albero visuale.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-158">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> builds the visual tree.</span></span>  
  
3. <span data-ttu-id="a0e5a-159">L'utente termina il tratto.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-159">The user ends the stroke.</span></span>  
  
    1.  <span data-ttu-id="a0e5a-160">Il <xref:System.Windows.Controls.InkPresenter> aggiunge il tratto alla relativa struttura ad albero visuale.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-160">The <xref:System.Windows.Controls.InkPresenter> adds the stroke to its visual tree.</span></span>  
  
    2.  <span data-ttu-id="a0e5a-161">Il livello di integrazione Media (MIL) sottoposto a rendering statico.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-161">The Media Integration Layer (MIL) statically renders the strokes.</span></span>  
  
    3.  <span data-ttu-id="a0e5a-162">Il <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> pulisce gli oggetti visivi.</span><span class="sxs-lookup"><span data-stu-id="a0e5a-162">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cleans up the visuals.</span></span>
