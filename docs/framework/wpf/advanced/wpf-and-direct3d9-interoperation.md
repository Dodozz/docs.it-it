---
title: Interoperatività di WPF e Direct3D9
ms.date: 03/30/2017
dev_langs:
- cpp
helpviewer_keywords:
- WPF [WPF], creating Direct3D9 content
- Direct3D9 [WPF interoperability], creating Direct3D9 content
ms.assetid: 1b14b823-69c4-4e8d-99e4-f6dade58f89a
ms.openlocfilehash: 9fd5cc270074a3a2845147bcad8baef8d1f8ba2a
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/23/2019
ms.locfileid: "54529411"
---
# <a name="wpf-and-direct3d9-interoperation"></a><span data-ttu-id="f819b-102">Interoperatività di WPF e Direct3D9</span><span class="sxs-lookup"><span data-stu-id="f819b-102">WPF and Direct3D9 Interoperation</span></span>
<span data-ttu-id="f819b-103">È possibile includere contenuto Direct3D9 in un'applicazione Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="f819b-103">You can include Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="f819b-104">In questo argomento viene descritto come creare contenuto Direct3D9 in modo che interagisce in modo efficiente con WPF.</span><span class="sxs-lookup"><span data-stu-id="f819b-104">This topic describes how to create Direct3D9 content so that it efficiently interoperates with WPF.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f819b-105">Quando si usa contenuto Direct3D9 in WPF, è necessario anche considerare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f819b-105">When using Direct3D9 content in WPF, you also need to think about performance.</span></span> <span data-ttu-id="f819b-106">Per altre informazioni su come ottimizzare le prestazioni, vedere [considerazioni sulle prestazioni per l'interoperabilità di WPF e Direct3D9](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md).</span><span class="sxs-lookup"><span data-stu-id="f819b-106">For more information about how to optimize for performance, see [Performance Considerations for Direct3D9 and WPF Interoperability](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md).</span></span>  
  
## <a name="display-buffers"></a><span data-ttu-id="f819b-107">Buffer di visualizzazione</span><span class="sxs-lookup"><span data-stu-id="f819b-107">Display Buffers</span></span>  
 <span data-ttu-id="f819b-108">Il <xref:System.Windows.Interop.D3DImage> classe gestisce due buffer di visualizzazione, che vengono chiamati i *buffer nascosto* e il *front buffer*.</span><span class="sxs-lookup"><span data-stu-id="f819b-108">The <xref:System.Windows.Interop.D3DImage> class manages two display buffers, which are called the *back buffer* and the *front buffer*.</span></span> <span data-ttu-id="f819b-109">Il buffer è la superficie Direct3D9.</span><span class="sxs-lookup"><span data-stu-id="f819b-109">The back buffer is your Direct3D9 surface.</span></span> <span data-ttu-id="f819b-110">Le modifiche al buffer nascosto vengono copiate il front-buffer quando si chiama il <xref:System.Windows.Interop.D3DImage.Unlock%2A> (metodo).</span><span class="sxs-lookup"><span data-stu-id="f819b-110">Changes to the back buffer are copied forward to the front buffer when you call the <xref:System.Windows.Interop.D3DImage.Unlock%2A> method.</span></span>  
  
 <span data-ttu-id="f819b-111">Nella figura seguente mostra la relazione tra il front-buffer e il buffer nascosto.</span><span class="sxs-lookup"><span data-stu-id="f819b-111">The following illustration shows the relationship between the back buffer and the front buffer.</span></span>  
  
 <span data-ttu-id="f819b-112">![Buffer di visualizzazione D3DImage](../../../../docs/framework/wpf/advanced/media/d3dimage-buffers.png "D3DImage_buffers")</span><span class="sxs-lookup"><span data-stu-id="f819b-112">![D3DImage display buffers](../../../../docs/framework/wpf/advanced/media/d3dimage-buffers.png "D3DImage_buffers")</span></span>  
  
## <a name="direct3d9-device-creation"></a><span data-ttu-id="f819b-113">Creazione di un dispositivo Direct3D9</span><span class="sxs-lookup"><span data-stu-id="f819b-113">Direct3D9 Device Creation</span></span>  
 <span data-ttu-id="f819b-114">Per eseguire il rendering Direct3D9 contenuto, è necessario creare un dispositivo Direct3D9.</span><span class="sxs-lookup"><span data-stu-id="f819b-114">To render Direct3D9 content, you must create a Direct3D9 device.</span></span> <span data-ttu-id="f819b-115">Sono presenti due oggetti Direct3D9 che è possibile usare per creare un dispositivo `IDirect3D9` e `IDirect3D9Ex`.</span><span class="sxs-lookup"><span data-stu-id="f819b-115">There are two Direct3D9 objects that you can use to create a device, `IDirect3D9` and `IDirect3D9Ex`.</span></span> <span data-ttu-id="f819b-116">Usare questi oggetti per creare `IDirect3DDevice9` e `IDirect3DDevice9Ex` dispositivi, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="f819b-116">Use these objects to create `IDirect3DDevice9` and `IDirect3DDevice9Ex` devices, respectively.</span></span>  
  
 <span data-ttu-id="f819b-117">Creare un dispositivo chiamando uno dei metodi seguenti.</span><span class="sxs-lookup"><span data-stu-id="f819b-117">Create a device by calling one of the following methods.</span></span>  
  
-   `IDirect3D9 * Direct3DCreate9(UINT SDKVersion);`  
  
-   `HRESULT Direct3DCreate9Ex(UINT SDKVersion, IDirect3D9Ex **ppD3D);`  
  
 <span data-ttu-id="f819b-118">In Windows Vista o versioni successive del sistema operativo, usare il `Direct3DCreate9Ex` metodo con una visualizzazione che è configurata per utilizzare Windows Visualizza Driver Model (WDDM).</span><span class="sxs-lookup"><span data-stu-id="f819b-118">On Windows Vista or later operating system, use the `Direct3DCreate9Ex` method with a display that is configured to use the Windows Display Driver Model (WDDM).</span></span> <span data-ttu-id="f819b-119">Usare il `Direct3DCreate9` metodo su qualsiasi altra piattaforma.</span><span class="sxs-lookup"><span data-stu-id="f819b-119">Use the `Direct3DCreate9` method on any other platform.</span></span>  
  
### <a name="availability-of-the-direct3dcreate9ex-method"></a><span data-ttu-id="f819b-120">Disponibilità del metodo Direct3DCreate9Ex</span><span class="sxs-lookup"><span data-stu-id="f819b-120">Availability of the Direct3DCreate9Ex method</span></span>  
 <span data-ttu-id="f819b-121">D3d9. dll ha il `Direct3DCreate9Ex` metodo solo in Windows Vista o versioni successive del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="f819b-121">The d3d9.dll has the `Direct3DCreate9Ex` method only on Windows Vista or later operating system.</span></span> <span data-ttu-id="f819b-122">Se si collega direttamente la funzione in Windows XP, l'applicazione non riesce a caricare.</span><span class="sxs-lookup"><span data-stu-id="f819b-122">If you directly link the function on Windows XP, your application fails to load.</span></span> <span data-ttu-id="f819b-123">Per determinare se il `Direct3DCreate9Ex` metodo è supportato, caricare la DLL e cercare l'indirizzo proc.</span><span class="sxs-lookup"><span data-stu-id="f819b-123">To determine whether the `Direct3DCreate9Ex` method is supported, load the DLL and look for the proc address.</span></span> <span data-ttu-id="f819b-124">Il codice seguente illustra come eseguire test per il `Direct3DCreate9Ex` (metodo).</span><span class="sxs-lookup"><span data-stu-id="f819b-124">The following code shows how to test for the `Direct3DCreate9Ex` method.</span></span> <span data-ttu-id="f819b-125">Per un esempio di codice completo, vedere [procedura dettagliata: Creazione di contenuto Direct3D9 per l'Hosting in WPF](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md).</span><span class="sxs-lookup"><span data-stu-id="f819b-125">For a full code example, see [Walkthrough: Creating Direct3D9 Content for Hosting in WPF](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md).</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#RendererManager_EnsureD3DObjects](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderermanager.cpp#renderermanager_ensured3dobjects)]  
  
### <a name="hwnd-creation"></a><span data-ttu-id="f819b-126">Creazione di un HWND</span><span class="sxs-lookup"><span data-stu-id="f819b-126">HWND Creation</span></span>  
 <span data-ttu-id="f819b-127">Creazione di un dispositivo richiede un oggetto HWND.</span><span class="sxs-lookup"><span data-stu-id="f819b-127">Creating a device requires an HWND.</span></span> <span data-ttu-id="f819b-128">In generale, si crea un HWND fittizio Direct3D9 da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="f819b-128">In general, you create a dummy HWND for Direct3D9 to use.</span></span> <span data-ttu-id="f819b-129">Esempio di codice seguente viene illustrato come creare un oggetto HWND fittizio.</span><span class="sxs-lookup"><span data-stu-id="f819b-129">The following code example shows how to create a dummy HWND.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#RendererManager_EnsureHWND](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderermanager.cpp#renderermanager_ensurehwnd)]  
  
### <a name="present-parameters"></a><span data-ttu-id="f819b-130">Parametri presenti</span><span class="sxs-lookup"><span data-stu-id="f819b-130">Present Parameters</span></span>  
 <span data-ttu-id="f819b-131">Creazione di un dispositivo richiede anche un `D3DPRESENT_PARAMETERS` struct, ma solo di alcuni parametri sono importanti.</span><span class="sxs-lookup"><span data-stu-id="f819b-131">Creating a device also requires a `D3DPRESENT_PARAMETERS` struct, but only a few parameters are important.</span></span> <span data-ttu-id="f819b-132">Questi parametri vengono scelti per ridurre al minimo il footprint di memoria.</span><span class="sxs-lookup"><span data-stu-id="f819b-132">These parameters are chosen to minimize the memory footprint.</span></span>  
  
 <span data-ttu-id="f819b-133">Impostare il `BackBufferHeight` e `BackBufferWidth` campi su 1.</span><span class="sxs-lookup"><span data-stu-id="f819b-133">Set the `BackBufferHeight` and `BackBufferWidth` fields to 1.</span></span> <span data-ttu-id="f819b-134">Impostandole su 0 fa in modo che è possibile impostare le dimensioni dell'oggetto HWND.</span><span class="sxs-lookup"><span data-stu-id="f819b-134">Setting them to 0 causes them to be set to the dimensions of the HWND.</span></span>  
  
 <span data-ttu-id="f819b-135">Impostare sempre la `D3DCREATE_MULTITHREADED` e `D3DCREATE_FPU_PRESERVE` flag per evitare il danneggiamento della memoria usata da Direct3D9 e impedire Direct3D9 di modificare le impostazioni di FPU.</span><span class="sxs-lookup"><span data-stu-id="f819b-135">Always set the `D3DCREATE_MULTITHREADED` and `D3DCREATE_FPU_PRESERVE` flags to prevent corrupting memory used by Direct3D9 and to prevent Direct3D9 from changing FPU settings.</span></span>  
  
 <span data-ttu-id="f819b-136">Il codice seguente viene illustrato come inizializzare il `D3DPRESENT_PARAMETERS` struct.</span><span class="sxs-lookup"><span data-stu-id="f819b-136">The following code shows how to initialize the `D3DPRESENT_PARAMETERS` struct.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#Renderer_Init](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderer.cpp#renderer_init)]  
  
## <a name="creating-the-back-buffer-render-target"></a><span data-ttu-id="f819b-137">Creazione di destinazione di rendering del Buffer nascosto</span><span class="sxs-lookup"><span data-stu-id="f819b-137">Creating the Back Buffer Render Target</span></span>  
 <span data-ttu-id="f819b-138">Per visualizzare il contenuto Direct3D9 in una <xref:System.Windows.Interop.D3DImage>, si crea una superficie Direct3D9 e assegnarla chiamando il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> (metodo).</span><span class="sxs-lookup"><span data-stu-id="f819b-138">To display Direct3D9 content in a <xref:System.Windows.Interop.D3DImage>, you create a Direct3D9 surface and assign it by calling the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> method.</span></span>  
  
### <a name="verifying-adapter-support"></a><span data-ttu-id="f819b-139">Verifica per determinare se il supporto di Adapter</span><span class="sxs-lookup"><span data-stu-id="f819b-139">Verifying Adapter Support</span></span>  
 <span data-ttu-id="f819b-140">Prima di creare un'area, verificare che tutti gli adapter supportano le proprietà della superficie desiderate.</span><span class="sxs-lookup"><span data-stu-id="f819b-140">Before creating a surface, verify that all adapters support the surface properties you require.</span></span> <span data-ttu-id="f819b-141">Anche se si esegue il rendering di una sola scheda, potrebbe essere visualizzata la finestra WPF con qualsiasi scheda nel sistema.</span><span class="sxs-lookup"><span data-stu-id="f819b-141">Even if you render to only one adapter, the WPF window may be displayed on any adapter in the system.</span></span> <span data-ttu-id="f819b-142">È sempre consigliabile scrivere codice Direct3D9 che gestisce le configurazioni a più adapter e controllare tutte le schede per il supporto perché WPF può spostare l'area tra le schede disponibili.</span><span class="sxs-lookup"><span data-stu-id="f819b-142">You should always write Direct3D9 code that handles multi-adapter configurations, and you should check all adapters for support, because WPF might move the surface among the available adapters.</span></span>  
  
 <span data-ttu-id="f819b-143">Esempio di codice seguente viene illustrato come controllare tutte le schede sul sistema per Direct3D9 supportano.</span><span class="sxs-lookup"><span data-stu-id="f819b-143">The following code example shows how to check all adapters on the system for Direct3D9 support.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#RendererManager_TestSurfaceSettings](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderermanager.cpp#renderermanager_testsurfacesettings)]  
  
### <a name="creating-the-surface"></a><span data-ttu-id="f819b-144">La creazione della superficie</span><span class="sxs-lookup"><span data-stu-id="f819b-144">Creating the Surface</span></span>  
 <span data-ttu-id="f819b-145">Prima di creare un'area, verificare che le funzionalità dei dispositivi supportano buone prestazioni sul sistema operativo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="f819b-145">Before creating a surface, verify that the device capabilities support good performance on the target operating system.</span></span> <span data-ttu-id="f819b-146">Per altre informazioni, vedere [considerazioni sulle prestazioni per l'interoperabilità di WPF e Direct3D9](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md).</span><span class="sxs-lookup"><span data-stu-id="f819b-146">For more information, see [Performance Considerations for Direct3D9 and WPF Interoperability](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md).</span></span>  
  
 <span data-ttu-id="f819b-147">Dopo avere verificato le funzionalità di dispositivo, è possibile creare l'area.</span><span class="sxs-lookup"><span data-stu-id="f819b-147">When you have verified device capabilities, you can create the surface.</span></span> <span data-ttu-id="f819b-148">Esempio di codice seguente viene illustrato come creare la destinazione di rendering.</span><span class="sxs-lookup"><span data-stu-id="f819b-148">The following code example shows how to create the render target.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#Renderer_CreateSurface](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderer.cpp#renderer_createsurface)]  
  
### <a name="wddm"></a><span data-ttu-id="f819b-149">WDDM</span><span class="sxs-lookup"><span data-stu-id="f819b-149">WDDM</span></span>  
 <span data-ttu-id="f819b-150">In Windows Vista e versioni successive, che sono configurati per utilizzare il WDDM, è possibile creare una trama di destinazione di rendering e passare la superficie di livello 0 per il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> (metodo).</span><span class="sxs-lookup"><span data-stu-id="f819b-150">On Windows Vista and later operating systems, which are configured to use the WDDM, you can create a render target texture and pass the level 0 surface to the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> method.</span></span> <span data-ttu-id="f819b-151">Questo approccio non è consigliato in Windows XP, poiché non è possibile creare una trama di destinazione di rendering bloccabile e prestazioni risultano ridotte.</span><span class="sxs-lookup"><span data-stu-id="f819b-151">This approach is not recommended on Windows XP, because you cannot create a lockable render target texture and performance will be reduced.</span></span>  
  
## <a name="handling-device-state"></a><span data-ttu-id="f819b-152">Gestione dello stato dispositivo</span><span class="sxs-lookup"><span data-stu-id="f819b-152">Handling Device State</span></span>  
 <span data-ttu-id="f819b-153">Il <xref:System.Windows.Interop.D3DImage> classe gestisce due buffer di visualizzazione, che vengono chiamati i *buffer nascosto* e il *front buffer*.</span><span class="sxs-lookup"><span data-stu-id="f819b-153">The <xref:System.Windows.Interop.D3DImage> class manages two display buffers, which are called the *back buffer* and the *front buffer*.</span></span> <span data-ttu-id="f819b-154">Il buffer è la superficie Direct3D.</span><span class="sxs-lookup"><span data-stu-id="f819b-154">The back buffer is your Direct3D surface.</span></span>  <span data-ttu-id="f819b-155">Le modifiche al buffer nascosto vengono copiate il front-buffer quando si chiama il <xref:System.Windows.Interop.D3DImage.Unlock%2A> metodo, in cui vengono visualizzati nell'hardware.</span><span class="sxs-lookup"><span data-stu-id="f819b-155">Changes to the back buffer are copied forward to the front buffer when you call the <xref:System.Windows.Interop.D3DImage.Unlock%2A> method, where it is displayed on the hardware.</span></span> <span data-ttu-id="f819b-156">In alcuni casi, il front buffer non è più disponibile.</span><span class="sxs-lookup"><span data-stu-id="f819b-156">Occasionally, the front buffer becomes unavailable.</span></span> <span data-ttu-id="f819b-157">Questa mancanza di disponibilità può essere causata dal blocco dello schermo, applicazioni Direct3D esclusive a schermo intero, cambio utente o altre attività di sistema.</span><span class="sxs-lookup"><span data-stu-id="f819b-157">This lack of availability can be caused by screen locking, full-screen exclusive Direct3D applications, user-switching, or other system activities.</span></span> <span data-ttu-id="f819b-158">In questo caso, l'applicazione WPF viene tenuto aggiornato tramite la gestione di <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> evento.</span><span class="sxs-lookup"><span data-stu-id="f819b-158">When this occurs, your WPF application is notified by handling the <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> event.</span></span>  <span data-ttu-id="f819b-159">Come l'applicazione risponde al front buffer mancata disponibilità varia a seconda se WPF è abilitato per eseguire il fallback per il rendering software.</span><span class="sxs-lookup"><span data-stu-id="f819b-159">How your application responds to the front buffer becoming unavailable depends on whether WPF is enabled to fall back to software rendering.</span></span> <span data-ttu-id="f819b-160">Il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> metodo ha un overload che accetta un parametro che specifica se WPF esegue il fallback per il rendering software.</span><span class="sxs-lookup"><span data-stu-id="f819b-160">The <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> method has an overload that takes a parameter that specifies whether WPF falls back to software rendering.</span></span>  
  
 <span data-ttu-id="f819b-161">Quando si chiama il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%29> overload né chiamare le <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%2CSystem.Boolean%29> overload con il `enableSoftwareFallback` parametro impostato su `false`, il sistema di rendering rilascia il riferimento al buffer nascosto quando il front buffer non è più disponibile e non è visualizzato.</span><span class="sxs-lookup"><span data-stu-id="f819b-161">When you call the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%29> overload or call the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%2CSystem.Boolean%29> overload with the `enableSoftwareFallback` parameter set to `false`, the rendering system releases its reference to the back buffer when the front buffer becomes unavailable and nothing is displayed.</span></span> <span data-ttu-id="f819b-162">Quando il buffer anteriore è disponibile anche in questo caso, il sistema di rendering genera il <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> evento per notificare all'applicazione WPF.</span><span class="sxs-lookup"><span data-stu-id="f819b-162">When the front buffer is available again, the rendering system raises the <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> event to notify your WPF application.</span></span>  <span data-ttu-id="f819b-163">È possibile creare un gestore eventi per il <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> riavviare rendering nuovamente con una superficie Direct3D valida dell'evento.</span><span class="sxs-lookup"><span data-stu-id="f819b-163">You can create an event handler for the <xref:System.Windows.Interop.D3DImage.IsFrontBufferAvailableChanged> event to restart rendering again with a valid Direct3D surface.</span></span> <span data-ttu-id="f819b-164">Per riavviare il rendering, è necessario chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A>.</span><span class="sxs-lookup"><span data-stu-id="f819b-164">To restart rendering, you must call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A>.</span></span>  
  
 <span data-ttu-id="f819b-165">Quando si chiama il <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%2CSystem.Boolean%29> rapporto di overload con il `enableSoftwareFallback` parametro impostato su `true`, il sistema per il rendering mantiene il riferimento al buffer nascosto quando il front buffer non è più disponibile, in modo che non è necessario chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> quando anteriore buffer è nuovamente disponibile.</span><span class="sxs-lookup"><span data-stu-id="f819b-165">When you call the <xref:System.Windows.Interop.D3DImage.SetBackBuffer%28System.Windows.Interop.D3DResourceType%2CSystem.IntPtr%2CSystem.Boolean%29> overload with the `enableSoftwareFallback` parameter set to `true`, the rendering system retains its reference to the back buffer when the front buffer becomes unavailable, so there is no need to call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> when the front buffer is available again.</span></span>  
  
 <span data-ttu-id="f819b-166">Quando è abilitato il rendering software, potrebbero verificarsi situazioni in cui il dispositivo dell'utente non è più disponibile, ma il sistema di rendering mantiene un riferimento all'area di Direct3D.</span><span class="sxs-lookup"><span data-stu-id="f819b-166">When software rendering is enabled, there may be situations where the user’s device becomes unavailable, but the rendering system retains a reference to the Direct3D surface.</span></span> <span data-ttu-id="f819b-167">Per verificare se è disponibile un dispositivo Direct3D9, chiamare il `TestCooperativeLevel` (metodo).</span><span class="sxs-lookup"><span data-stu-id="f819b-167">To check whether a Direct3D9 device is unavailable, call the `TestCooperativeLevel` method.</span></span> <span data-ttu-id="f819b-168">Per verificare una chiamata di dispositivi Direct3D9Ex il `CheckDeviceState` metodo, perché il `TestCooperativeLevel` metodo è obsoleto e restituisce sempre esito positivo.</span><span class="sxs-lookup"><span data-stu-id="f819b-168">To check a Direct3D9Ex devices call the `CheckDeviceState` method, because the `TestCooperativeLevel` method is deprecated and always returns success.</span></span> <span data-ttu-id="f819b-169">Se il dispositivo utente non è più disponibile, chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> rilascio di riferimento di WPF al buffer nascosto.</span><span class="sxs-lookup"><span data-stu-id="f819b-169">If the user device has become unavailable, call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> to release WPF’s reference to the back buffer.</span></span>  <span data-ttu-id="f819b-170">Se è necessario reimpostare il dispositivo, chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> con il `backBuffer` parametro impostato su `null`, quindi chiamare <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> nuovamente con `backBuffer` impostata su una superficie Direct3D valida.</span><span class="sxs-lookup"><span data-stu-id="f819b-170">If you need to reset your device, call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> with the `backBuffer` parameter set to `null`, and then call <xref:System.Windows.Interop.D3DImage.SetBackBuffer%2A> again with `backBuffer` set to a valid Direct3D surface.</span></span>  
  
 <span data-ttu-id="f819b-171">Chiamare il `Reset` metodo per il ripristino da un dispositivo non è valido solo se si implementa il supporto di più adapter.</span><span class="sxs-lookup"><span data-stu-id="f819b-171">Call the `Reset` method to recover from an invalid device only if you implement multi-adapter support.</span></span> <span data-ttu-id="f819b-172">In caso contrario, rilascia tutte le interfacce Direct3D9 e crearli di nuovo completamente.</span><span class="sxs-lookup"><span data-stu-id="f819b-172">Otherwise, release all Direct3D9 interfaces and re-create them completely.</span></span> <span data-ttu-id="f819b-173">Se il layout dell'adattatore è stato modificato, non vengono aggiornati Direct3D9 gli oggetti creati prima della modifica.</span><span class="sxs-lookup"><span data-stu-id="f819b-173">If the adapter layout has changed, Direct3D9 objects created before the change are not updated.</span></span>  
  
## <a name="handling-resizing"></a><span data-ttu-id="f819b-174">Gestione del ridimensionamento</span><span class="sxs-lookup"><span data-stu-id="f819b-174">Handling Resizing</span></span>  
 <span data-ttu-id="f819b-175">Se un <xref:System.Windows.Interop.D3DImage> viene visualizzato con una risoluzione diversa da quella nativa, viene ridimensionata in base al corrente <xref:System.Windows.Media.RenderOptions.BitmapScalingMode%2A>, ad eccezione del fatto che <xref:System.Windows.Media.Effects.SamplingMode.Bilinear> viene sostituito <xref:System.Windows.Media.BitmapScalingMode.Fant>.</span><span class="sxs-lookup"><span data-stu-id="f819b-175">If a <xref:System.Windows.Interop.D3DImage> is displayed at a resolution other than its native size, it is scaled according to the current <xref:System.Windows.Media.RenderOptions.BitmapScalingMode%2A>, except that <xref:System.Windows.Media.Effects.SamplingMode.Bilinear> is substituted for <xref:System.Windows.Media.BitmapScalingMode.Fant>.</span></span>  
  
 <span data-ttu-id="f819b-176">Se necessaria una maggiore fedeltà, è necessario creare una nuova superficie quando il contenitore del <xref:System.Windows.Interop.D3DImage> Modifica dimensione.</span><span class="sxs-lookup"><span data-stu-id="f819b-176">If you require higher fidelity, you must create a new surface when the container of the <xref:System.Windows.Interop.D3DImage> changes size.</span></span>  
  
 <span data-ttu-id="f819b-177">Esistono tre possibili approcci per gestire il ridimensionamento.</span><span class="sxs-lookup"><span data-stu-id="f819b-177">There are three possible approaches to handle resizing.</span></span>  
  
-   <span data-ttu-id="f819b-178">Partecipare al sistema di layout e creare una nuova area quando cambiano le dimensioni.</span><span class="sxs-lookup"><span data-stu-id="f819b-178">Participate in the layout system and create a new surface when the size changes.</span></span> <span data-ttu-id="f819b-179">Non creare troppi risulta rilevante, perché è possibile esaurire o frammentare la memoria video.</span><span class="sxs-lookup"><span data-stu-id="f819b-179">Do not create too many surfaces, because you may exhaust or fragment video memory.</span></span>  
  
-   <span data-ttu-id="f819b-180">Attendere un evento di ridimensionamento non verificato per un periodo fisso di tempo per creare la nuova area.</span><span class="sxs-lookup"><span data-stu-id="f819b-180">Wait until a resize event has not occurred for a fixed period of time to create the new surface.</span></span>  
  
-   <span data-ttu-id="f819b-181">Creare un <xref:System.Windows.Threading.DispatcherTimer> che controlla le dimensioni del contenitore più volte al secondo.</span><span class="sxs-lookup"><span data-stu-id="f819b-181">Create a <xref:System.Windows.Threading.DispatcherTimer> that checks the container dimensions several times per second.</span></span>  
  
## <a name="multi-monitor-optimization"></a><span data-ttu-id="f819b-182">Ottimizzazione di più monitor</span><span class="sxs-lookup"><span data-stu-id="f819b-182">Multi-monitor Optimization</span></span>  
 <span data-ttu-id="f819b-183">In modo significativo calo delle prestazioni può verificarsi quando il sistema di rendering sposta un <xref:System.Windows.Interop.D3DImage> in un altro monitor.</span><span class="sxs-lookup"><span data-stu-id="f819b-183">Significantly reduced performance can result when the rendering system moves a <xref:System.Windows.Interop.D3DImage> to another monitor.</span></span>  
  
 <span data-ttu-id="f819b-184">Su WDDM, purché i monitoraggi sono sullo stesso video card e si usa `Direct3DCreate9Ex`, non vi è alcun calo delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f819b-184">On WDDM, as long as the monitors are on the same video card and you use `Direct3DCreate9Ex`, there is no reduction in performance.</span></span> <span data-ttu-id="f819b-185">Se i monitoraggi si trovano in schede video separate, le prestazioni sono ridotte.</span><span class="sxs-lookup"><span data-stu-id="f819b-185">If the monitors are on separate video cards, performance is reduced.</span></span> <span data-ttu-id="f819b-186">In Windows XP, le prestazioni sono ridotte sempre.</span><span class="sxs-lookup"><span data-stu-id="f819b-186">On Windows XP, performance is always reduced.</span></span>  
  
 <span data-ttu-id="f819b-187">Quando il <xref:System.Windows.Interop.D3DImage> viene spostato in un altro monitor, è possibile creare una nuova superficie sulla scheda corrispondente per ripristinare le buone prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f819b-187">When the <xref:System.Windows.Interop.D3DImage> moves to another monitor, you can create a new surface on the corresponding adapter to restore good performance.</span></span>  
  
 <span data-ttu-id="f819b-188">Per evitare la riduzione delle prestazioni, scrivere codice in modo specifico per il caso di utilizzo di più monitor.</span><span class="sxs-lookup"><span data-stu-id="f819b-188">To avoid the performance penalty, write code specifically for the multi-monitor case.</span></span> <span data-ttu-id="f819b-189">Nell'elenco seguente illustra un modo per scrivere il codice con più monitor.</span><span class="sxs-lookup"><span data-stu-id="f819b-189">The following list shows one way to write multi-monitor code.</span></span>  
  
1.  <span data-ttu-id="f819b-190">Trovare un punto del <xref:System.Windows.Interop.D3DImage> nello spazio dello schermo con le `Visual.ProjectToScreen` (metodo).</span><span class="sxs-lookup"><span data-stu-id="f819b-190">Find a point of the <xref:System.Windows.Interop.D3DImage> in screen space with the `Visual.ProjectToScreen` method.</span></span>  
  
2.  <span data-ttu-id="f819b-191">Usare il `MonitorFromPoint` metodo GDI per trovare il monitoraggio in cui viene visualizzato il punto.</span><span class="sxs-lookup"><span data-stu-id="f819b-191">Use the `MonitorFromPoint` GDI method to find the monitor that is displaying the point.</span></span>  
  
3.  <span data-ttu-id="f819b-192">Usare il `IDirect3D9::GetAdapterMonitor` metodo per trovare l'adattatore Direct3D9 il monitoraggio si trova.</span><span class="sxs-lookup"><span data-stu-id="f819b-192">Use the `IDirect3D9::GetAdapterMonitor` method to find which Direct3D9 adapter the monitor is on.</span></span>  
  
4.  <span data-ttu-id="f819b-193">Se l'adapter non è quello utilizzato per l'adapter con il buffer nascosto, creare un nuovo buffer nascosto nel nuovo monitor e assegnarla al <xref:System.Windows.Interop.D3DImage> buffer nascosto.</span><span class="sxs-lookup"><span data-stu-id="f819b-193">If the adapter is not the same as the adapter with the back buffer, create a new back buffer on the new monitor and assign it to the <xref:System.Windows.Interop.D3DImage> back buffer.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f819b-194">Se il <xref:System.Windows.Interop.D3DImage> gestisce monitoraggi, le prestazioni saranno lente, tranne nel caso di WDDM e `IDirect3D9Ex` nella stessa scheda.</span><span class="sxs-lookup"><span data-stu-id="f819b-194">If the <xref:System.Windows.Interop.D3DImage> straddles monitors, performance will be slow, except in the case of WDDM and `IDirect3D9Ex` on the same adapter.</span></span> <span data-ttu-id="f819b-195">Non è possibile migliorare le prestazioni in questa situazione.</span><span class="sxs-lookup"><span data-stu-id="f819b-195">There is no way to improve performance in this situation.</span></span>  
  
 <span data-ttu-id="f819b-196">Esempio di codice seguente viene illustrato come trovare il monitoraggio corrente.</span><span class="sxs-lookup"><span data-stu-id="f819b-196">The following code example shows how to find the current monitor.</span></span>  
  
 [!code-cpp[System.Windows.Interop.D3DImage#RendererManager_SetAdapter](../../../../samples/snippets/cpp/VS_Snippets_Wpf/System.Windows.Interop.D3DImage/cpp/renderermanager.cpp#renderermanager_setadapter)]  
  
 <span data-ttu-id="f819b-197">Aggiornare il monitoraggio quando il <xref:System.Windows.Interop.D3DImage> le modifiche di dimensione o la posizione del contenitore o aggiorna il monitoraggio tramite un `DispatcherTimer` che aggiorna più volte al secondo.</span><span class="sxs-lookup"><span data-stu-id="f819b-197">Update the monitor when the <xref:System.Windows.Interop.D3DImage> container's size or position changes, or update the monitor by using a `DispatcherTimer` that updates a few times per second.</span></span>  
  
## <a name="wpf-software-rendering"></a><span data-ttu-id="f819b-198">Rendering Software WPF</span><span class="sxs-lookup"><span data-stu-id="f819b-198">WPF Software Rendering</span></span>  
 <span data-ttu-id="f819b-199">WPF esegue il rendering in modo sincrono sul thread dell'interfaccia utente in software nelle situazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="f819b-199">WPF renders synchronously on the UI thread in software in the following situations.</span></span>  
  
-   <span data-ttu-id="f819b-200">Stampa</span><span class="sxs-lookup"><span data-stu-id="f819b-200">Printing</span></span>  
  
-   <xref:System.Windows.Media.Effects.BitmapEffect>  
  
-   <xref:System.Windows.Media.Imaging.RenderTargetBitmap>  
  
 <span data-ttu-id="f819b-201">Quando si verifica una di queste situazioni, il sistema di rendering chiama il <xref:System.Windows.Interop.D3DImage.CopyBackBuffer%2A> metodo per copiare il buffer di hardware per il software.</span><span class="sxs-lookup"><span data-stu-id="f819b-201">When one of these situations occurs, the rendering system calls the <xref:System.Windows.Interop.D3DImage.CopyBackBuffer%2A> method to copy the hardware buffer to software.</span></span> <span data-ttu-id="f819b-202">L'implementazione predefinita chiama il `GetRenderTargetData` metodo con la superficie.</span><span class="sxs-lookup"><span data-stu-id="f819b-202">The default implementation calls the `GetRenderTargetData` method with your surface.</span></span> <span data-ttu-id="f819b-203">Poiché questa chiamata si verifica di fuori il criterio di blocco, sblocco, potrebbe non riuscire.</span><span class="sxs-lookup"><span data-stu-id="f819b-203">Because this call occurs outside of the Lock/Unlock pattern, it may fail.</span></span> <span data-ttu-id="f819b-204">In questo caso, il `CopyBackBuffer` restituzione del metodo `null` e viene visualizzata alcuna immagine.</span><span class="sxs-lookup"><span data-stu-id="f819b-204">In this case, the `CopyBackBuffer` method returns `null` and no image is displayed.</span></span>  
  
 <span data-ttu-id="f819b-205">È possibile eseguire l'override di <xref:System.Windows.Interop.D3DImage.CopyBackBuffer%2A> metodo, chiamare l'implementazione di base, e restituisce `null`, è possibile restituire un segnaposto <xref:System.Windows.Media.Imaging.BitmapSource>.</span><span class="sxs-lookup"><span data-stu-id="f819b-205">You can override the <xref:System.Windows.Interop.D3DImage.CopyBackBuffer%2A> method, call the base implementation, and if it returns `null`, you can return a placeholder <xref:System.Windows.Media.Imaging.BitmapSource>.</span></span>  
  
 <span data-ttu-id="f819b-206">È anche possibile implementare il proprio rendering software piuttosto che chiama l'implementazione di base.</span><span class="sxs-lookup"><span data-stu-id="f819b-206">You can also implement your own software rendering instead of calling the base implementation.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="f819b-207">Se viene eseguito il rendering completamente il software, WPF <xref:System.Windows.Interop.D3DImage> non viene visualizzata perché WPF non dispone di un front buffer.</span><span class="sxs-lookup"><span data-stu-id="f819b-207">If WPF is rendering completely in software, <xref:System.Windows.Interop.D3DImage> is not shown because WPF does not have a front buffer.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f819b-208">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="f819b-208">See also</span></span>
- <xref:System.Windows.Interop.D3DImage>
- [<span data-ttu-id="f819b-209">Considerazioni sulle prestazioni per l'interoperabilità fra Direct3D9 e WPF</span><span class="sxs-lookup"><span data-stu-id="f819b-209">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>](../../../../docs/framework/wpf/advanced/performance-considerations-for-direct3d9-and-wpf-interoperability.md)
- [<span data-ttu-id="f819b-210">Procedura dettagliata: Creazione di contenuto Direct3D9 per l'Hosting in WPF</span><span class="sxs-lookup"><span data-stu-id="f819b-210">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)
- [<span data-ttu-id="f819b-211">Procedura dettagliata: Hosting di contenuto Direct3D9 in WPF</span><span class="sxs-lookup"><span data-stu-id="f819b-211">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-direct3d9-content-in-wpf.md)
