---
title: Instance Locked Exception Action
ms.date: 03/30/2017
ms.assetid: 164a5419-315c-4987-ad72-54cbdb88d402
ms.openlocfilehash: 0cb39c51436271999c66c30210e0da79adc92e72
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 04/23/2019
ms.locfileid: "61699539"
---
# <a name="instance-locked-exception-action"></a><span data-ttu-id="ca9df-102">Instance Locked Exception Action</span><span class="sxs-lookup"><span data-stu-id="ca9df-102">Instance Locked Exception Action</span></span>
<span data-ttu-id="ca9df-103">La proprietà <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> dell'Archivio di istanze del flusso di lavoro SQL consente di specificare l'azione che il provider di persistenza SQL deve eseguire quando riceve un'eccezione <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-103">The <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> property of the SQL Workflow Instance Store lets you specify what action the SQL persistence provider should take when it receives an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="ca9df-104">Il provider di persistenza riceve questa eccezione quando tenta di bloccare un'istanza del servizio flusso di lavoro che è attualmente bloccata da un altro host del servizio.</span><span class="sxs-lookup"><span data-stu-id="ca9df-104">The persistence provider receives this exception when it tries to lock a workflow service instance that is currently locked by another service host.</span></span> <span data-ttu-id="ca9df-105">I valori di questa proprietà sono <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> e <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-105">The values for this property are <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, and <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="ca9df-106">Il valore predefinito è <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-106">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="ca9df-107">Nell'elenco seguente vengono descritte le tre opzioni:</span><span class="sxs-lookup"><span data-stu-id="ca9df-107">The following list describes the three options:</span></span>  
  
- <span data-ttu-id="ca9df-108"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-108"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="ca9df-109">L'host del servizio non tenta di bloccare l'istanza del servizio del flusso di lavoro e passa il <xref:System.Runtime.DurableInstancing.InstanceLockedException> al chiamante.</span><span class="sxs-lookup"><span data-stu-id="ca9df-109">The service host does not attempt to lock the workflow service instance and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller.</span></span>  <span data-ttu-id="ca9df-110">Se il flusso di lavoro rimane in memoria per un periodo superiore a 60 secondi, usare <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> come la ripetizione dei tentativi.</span><span class="sxs-lookup"><span data-stu-id="ca9df-110">If your workflow stays in memory for a period exceeding 60 seconds, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> as the retry.</span></span> <span data-ttu-id="ca9df-111">Il valore predefinito è <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-111">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span>  
  
- <span data-ttu-id="ca9df-112"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-112"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>.</span></span> <span data-ttu-id="ca9df-113">L'host del servizio tenta di nuovo di bloccare l'istanza con un intervallo lineare tra tentativi e passa <xref:System.Runtime.DurableInstancing.InstanceLockedException> al chiamante alla fine della sequenza.</span><span class="sxs-lookup"><span data-stu-id="ca9df-113">The service host reattempts to lock the workflow service instance with a linear interval between retry attempts and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller at the end of the sequence.</span></span> <span data-ttu-id="ca9df-114">Se il flusso di lavoro rimane in memoria approssimativamente tra i 5 e 60 secondi e i messaggi arrivano in batch, per cui è più probabile che i messaggi siano inviati alla stessa istanza nello stesso host per elaborare tutti i messaggi prima di scaricare il flusso di lavoro, usare <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> per ottenere la migliore latenza senza sprecare risorse.</span><span class="sxs-lookup"><span data-stu-id="ca9df-114">If you workflow stays in memory approximately between 5-60 seconds, and messages arrive in batches where it is more likely for messages being sent to the same instance on the same host to process all messages before unloading the workflow, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> to achieve the best latency without wasting resources.</span></span>  
  
- <span data-ttu-id="ca9df-115"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-115"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="ca9df-116">L'host del servizio tenta di nuovo di bloccare l'istanza di servizio del flusso di lavoro con un intervallo di interruzione esponenziale tra tentativi e passa l'eccezione al chiamante alla fine della sequenza.</span><span class="sxs-lookup"><span data-stu-id="ca9df-116">The service host reattempts to lock the workflow service instance with an exponential backoff interval between retry attempts, and passes the exception to the caller at the end of the sequence.</span></span> <span data-ttu-id="ca9df-117">Se il flusso di lavoro rimane in memoria per un tempo molto breve (meno di 5 secondi) o una Web farm è grande e la probabilità che un altro messaggio sia recapitato allo stesso host non è molto elevata, usare <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> per ottenere la migliore latenza.</span><span class="sxs-lookup"><span data-stu-id="ca9df-117">If your workflow stays in memory for a very short time (less than 5 seconds), or a Web farm is large and the chance of another message being delivered to the same host is not very high, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> to achieve the best latency.</span></span>  
  
 <span data-ttu-id="ca9df-118">La funzionalità Instance Locked Exception Action supporta gli scenari seguenti.</span><span class="sxs-lookup"><span data-stu-id="ca9df-118">The Instance Locked Exception Action feature supports the following scenarios.</span></span> <span data-ttu-id="ca9df-119">In tutti gli scenari, se la proprietà instanceLockedExceptionAction dell'oggetto SqlWorkflowInstanceStore viene impostata su <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> o <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, l'host tenta di nuovo di acquisire periodicamente e in modo trasparente il blocco sulle istanze.</span><span class="sxs-lookup"><span data-stu-id="ca9df-119">In all scenarios, if the instanceLockedExceptionAction property of the SqlWorkflowInstanceStore is set to <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> or <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, the host transparently retries to acquire the lock on instances periodically.</span></span>  
  
1. <span data-ttu-id="ca9df-120">**Abilitazione dell'arresto normale e riciclo sovrapposto di domini applicazione.**</span><span class="sxs-lookup"><span data-stu-id="ca9df-120">**Enabling graceful shutdown and overlapped recycling of application domains.**</span></span> <span data-ttu-id="ca9df-121">Si supponga che un **AppDomain** con un host del servizio in esecuzione di istanze del servizio del flusso di lavoro è in fase di riciclo e un nuovo **AppDomain** accede a gestire le nuove richieste mentre la vecchia  **AppDomain** è più disponibile.</span><span class="sxs-lookup"><span data-stu-id="ca9df-121">Suppose an **AppDomain** with a service host running workflow service instances is being recycled and a new **AppDomain** is brought up to handle new requests in parallel while the old **AppDomain** is brought down gracefully.</span></span> <span data-ttu-id="ca9df-122">L'arresto attende finché le istanze del servizio flusso di lavoro non sono inattive, quindi le istanze vengono rese persistenti e scaricate.</span><span class="sxs-lookup"><span data-stu-id="ca9df-122">The shutdown waits until workflow service instances are idle, and then persists and unloads the instances.</span></span> <span data-ttu-id="ca9df-123">Eventuali tentativi dagli host nel nuovo **AppDomain** bloccare un'istanza causerà un <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-123">Any attempts by hosts in the new **AppDomain** to lock an instance will cause an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span>  
  
2. <span data-ttu-id="ca9df-124">**Ridimensionamento orizzontale dei flussi di lavoro durevoli in una farm omogenea di server.**</span><span class="sxs-lookup"><span data-stu-id="ca9df-124">**Horizontally scaling durable workflows across a homogeneous farm of servers.**</span></span> <span data-ttu-id="ca9df-125">Si supponga che un nodo di una server farm in cui è in esecuzione un'istanza del flusso di lavoro venga arrestato in modo anomalo e l'host del flusso di lavoro non possa rimuovere i blocchi sull'istanza che sta eseguendo.</span><span class="sxs-lookup"><span data-stu-id="ca9df-125">Suppose a node of a server farm on which a workflow instance is running crashes and the workflow host cannot remove locks on the instance it is running.</span></span> <span data-ttu-id="ca9df-126">Quando un host del servizio che è in esecuzione in un altro nodo della farm riceve un messaggio per l'istanza di quel flusso di lavoro, tenta di acquisire i blocchi su queste istanze e riceverà l'eccezione <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="ca9df-126">When a service host running on another node of the farm receives a message for that workflow instance, it tries to acquire locks on these instances it will receive the <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="ca9df-127">I blocchi scadranno dopo un po' di tempo perché l'host che doveva rinnovare il blocco non esiste più.</span><span class="sxs-lookup"><span data-stu-id="ca9df-127">The locks will expire after some time because the host that was supposed to renew the lock no longer exists.</span></span>  
  
     <span data-ttu-id="ca9df-128">**Ridimensionamento orizzontale dei flussi di lavoro durevoli in una farm omogenea di server.**</span><span class="sxs-lookup"><span data-stu-id="ca9df-128">**Horizontally scaling durable workflows across a homogeneous farm of servers.**</span></span>  <span data-ttu-id="ca9df-129">Si supponga di voler ridimensionare orizzontalmente un flusso di lavoro durevole usando più host dietro un bilanciamento del carico di rete (bilanciamento del carico di rete), l'host del flusso di lavoro in esecuzione in un nodo della farm carica un'istanza del flusso di lavoro e sta elaborando un messaggio e il messaggio successivo per l'istanza viene indirizzato a l'host è in esecuzione in un altro nodo perché il bilanciamento carico di rete non dispone di algoritmo di routing per recapitare messaggi all'host che è già in esecuzione l'istanza.</span><span class="sxs-lookup"><span data-stu-id="ca9df-129">Suppose you want to horizontally scale a durable workflow using multiple hosts behind a NLB (Network Load Balancer), the workflow host running on one node of the farm loads a workflow instance and is processing a message, and the next message to the instance is routed to the host that is running on another node because the NLB does not have routing algorithm to deliver messages to the host that is already running the instance.</span></span> <span data-ttu-id="ca9df-130">Dopo la ricezione del messaggio, il secondo host tenta di caricare l'istanza del flusso di lavoro e riceve l'eccezione <xref:System.Runtime.DurableInstancing.InstanceLockedException> perché il primo host dispone di un blocco sull'istanza.</span><span class="sxs-lookup"><span data-stu-id="ca9df-130">Upon receiving the message, the second host attempts to load the workflow instance and receives the <xref:System.Runtime.DurableInstancing.InstanceLockedException> because the first host has a lock on the instance.</span></span> <span data-ttu-id="ca9df-131">Il primo host sblocca l'istanza quando l'elaborazione del primo messaggio è finita e il secondo host acquisisce il blocco quando ritenta la volta successiva, carica l'istanza ed elabora il secondo messaggio.</span><span class="sxs-lookup"><span data-stu-id="ca9df-131">The first host unlocks the instance when it is finished with processing the first message and the second host acquires the lock when it retries the next time, loads the instance, and processes the second message.</span></span>
