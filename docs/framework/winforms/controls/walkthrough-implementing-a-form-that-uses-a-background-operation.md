---
title: "Procedura dettagliata: Implementazione di un modulo che usa un'operazione in background"
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- threading [Windows Forms], forms
- BackgroundWorker component
- background tasks
- forms [Windows Forms], multithreading
- threading [Windows Forms], walkthroughs
- forms [Windows Forms], background operations
- threading [Windows Forms], background operations
- background operations
ms.assetid: 4691b796-9200-471a-89c3-ba4c7cc78c03
ms.openlocfilehash: 6399fb853162174895d892399fd3eb5226101515
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 04/18/2019
ms.locfileid: "59343402"
---
# <a name="walkthrough-implementing-a-form-that-uses-a-background-operation"></a><span data-ttu-id="5ccd9-102">Procedura dettagliata: Implementazione di un modulo che usa un'operazione in background</span><span class="sxs-lookup"><span data-stu-id="5ccd9-102">Walkthrough: Implementing a Form That Uses a Background Operation</span></span>
<span data-ttu-id="5ccd9-103">Se si dispone di un'operazione che richiederà molto tempo per il completamento, e il blocco non desiderate l'interfaccia utente (UI) o "blocco", è possibile usare il <xref:System.ComponentModel.BackgroundWorker> classe per eseguire l'operazione in un altro thread.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-103">If you have an operation that will take a long time to complete, and you do not want your user interface (UI) to stop responding or "hang," you can use the <xref:System.ComponentModel.BackgroundWorker> class to execute the operation on another thread.</span></span>  
  
 <span data-ttu-id="5ccd9-104">Questa procedura dettagliata illustra come usare il <xref:System.ComponentModel.BackgroundWorker> classe per eseguire i calcoli che richiedono molto tempo "in"background, mentre l'interfaccia utente rimane reattiva.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-104">This walkthrough illustrates how to use the <xref:System.ComponentModel.BackgroundWorker> class to perform time-consuming computations "in the background," while the user interface remains responsive.</span></span>  <span data-ttu-id="5ccd9-105">Nel corso della procedura, un'applicazione calcola i numeri Fibonacci in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-105">When you are through, you will have an application that computes Fibonacci numbers asynchronously.</span></span> <span data-ttu-id="5ccd9-106">Sebbene il calcolo di un numero Fibonacci a molte cifre possa impiegare una notevole quantità di tempo, il thread principale dell'interfaccia utente non verrà interrotto da questa operazione e la capacità di risposta del modulo resterà inalterata durante il calcolo.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-106">Even though computing a large Fibonacci number can take a noticeable amount of time, the main UI thread will not be interrupted by this delay, and the form will be responsive during the calculation.</span></span>  
  
 <span data-ttu-id="5ccd9-107">Le attività illustrate nella procedura dettagliata sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="5ccd9-107">Tasks illustrated in this walkthrough include:</span></span>  
  
-   <span data-ttu-id="5ccd9-108">Creazione di un'applicazione basata su Windows</span><span class="sxs-lookup"><span data-stu-id="5ccd9-108">Creating a Windows-based Application</span></span>  
  
-   <span data-ttu-id="5ccd9-109">Creazione di un <xref:System.ComponentModel.BackgroundWorker> nel Form</span><span class="sxs-lookup"><span data-stu-id="5ccd9-109">Creating a <xref:System.ComponentModel.BackgroundWorker> in Your Form</span></span>  
  
-   <span data-ttu-id="5ccd9-110">Aggiunta dei gestori eventi asincroni</span><span class="sxs-lookup"><span data-stu-id="5ccd9-110">Adding Asynchronous Event Handlers</span></span>  
  
-   <span data-ttu-id="5ccd9-111">Aggiunta dei report sullo stato di avanzamento e supporto per l'annullamento</span><span class="sxs-lookup"><span data-stu-id="5ccd9-111">Adding Progress Reporting and Support for Cancellation</span></span>  
  
 <span data-ttu-id="5ccd9-112">Per un elenco completo del codice usato in questo esempio, vedere [come: Implementare un Form che usa un'operazione in Background](how-to-implement-a-form-that-uses-a-background-operation.md).</span><span class="sxs-lookup"><span data-stu-id="5ccd9-112">For a complete listing of the code used in this example, see [How to: Implement a Form That Uses a Background Operation](how-to-implement-a-form-that-uses-a-background-operation.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="5ccd9-113">Le finestre di dialogo e i comandi di menu visualizzati potrebbero essere diversi da quelli descritti nella Guida a seconda delle impostazioni attive o dell'edizione del programma.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-113">The dialog boxes and menu commands you see might differ from those described in Help depending on your active settings or edition.</span></span> <span data-ttu-id="5ccd9-114">Per modificare le impostazioni, scegliere **Importa/Esporta impostazioni** dal menu **Strumenti** .</span><span class="sxs-lookup"><span data-stu-id="5ccd9-114">To change your settings, choose **Import and Export Settings** on the **Tools** menu.</span></span> <span data-ttu-id="5ccd9-115">Per altre informazioni, vedere [Personalizzare l'IDE di Visual Studio](/visualstudio/ide/personalizing-the-visual-studio-ide).</span><span class="sxs-lookup"><span data-stu-id="5ccd9-115">For more information, see [Personalize the Visual Studio IDE](/visualstudio/ide/personalizing-the-visual-studio-ide).</span></span>  
  
## <a name="creating-the-project"></a><span data-ttu-id="5ccd9-116">Creazione del progetto</span><span class="sxs-lookup"><span data-stu-id="5ccd9-116">Creating the Project</span></span>  
 <span data-ttu-id="5ccd9-117">Il primo passaggio indica come creare il progetto e impostare il modulo.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-117">The first step is to create the project and to set up the form.</span></span>  
  
#### <a name="to-create-a-form-that-uses-a-background-operation"></a><span data-ttu-id="5ccd9-118">Per creare un modulo che utilizza un'operazione in background</span><span class="sxs-lookup"><span data-stu-id="5ccd9-118">To create a form that uses a background operation</span></span>  
  
1. <span data-ttu-id="5ccd9-119">Creare un progetto di applicazione basata su Windows denominato `BackgroundWorkerExample` (**File** > **New** > **progetto**  >  **Visual c#** oppure **Visual Basic** > **Desktop classico** > **Windows Forms Application**).</span><span class="sxs-lookup"><span data-stu-id="5ccd9-119">Create a Windows-based application project called `BackgroundWorkerExample` (**File** > **New** > **Project** > **Visual C#** or **Visual Basic** > **Classic Desktop** > **Windows Forms Application**).</span></span>  
  
2. <span data-ttu-id="5ccd9-120">In **Esplora soluzioni** fare clic con il pulsante destro del mouse su **Form1** e scegliere **Rinomina** dal menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-120">In **Solution Explorer**, right-click **Form1** and select **Rename** from the shortcut menu.</span></span> <span data-ttu-id="5ccd9-121">Modificare il nome file in `FibonacciCalculator`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-121">Change the file name to `FibonacciCalculator`.</span></span> <span data-ttu-id="5ccd9-122">Scegliere il pulsante **Sì** quando richiesto per rinominare tutti i riferimenti all'elemento di codice '`Form1`'.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-122">Click the **Yes** button when you are asked if you want to rename all references to the code element '`Form1`'.</span></span>  
  
3. <span data-ttu-id="5ccd9-123">Trascinare un <xref:System.Windows.Forms.NumericUpDown> controllare dal **casella degli strumenti** nel form.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-123">Drag a <xref:System.Windows.Forms.NumericUpDown> control from the **Toolbox** onto the form.</span></span> <span data-ttu-id="5ccd9-124">Impostare il <xref:System.Windows.Forms.NumericUpDown.Minimum%2A> proprietà `1` e il <xref:System.Windows.Forms.NumericUpDown.Maximum%2A> proprietà `91`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-124">Set the <xref:System.Windows.Forms.NumericUpDown.Minimum%2A> property to `1` and the <xref:System.Windows.Forms.NumericUpDown.Maximum%2A> property to `91`.</span></span>  
  
4. <span data-ttu-id="5ccd9-125">Aggiungere due <xref:System.Windows.Forms.Button> controlli al form.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-125">Add two <xref:System.Windows.Forms.Button> controls to the form.</span></span>  
  
5. <span data-ttu-id="5ccd9-126">Rinominare il primo <xref:System.Windows.Forms.Button> controllo `startAsyncButton` e impostare le <xref:System.Windows.Forms.Control.Text%2A> proprietà `Start Async`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-126">Rename the first <xref:System.Windows.Forms.Button> control `startAsyncButton` and set the <xref:System.Windows.Forms.Control.Text%2A> property to `Start Async`.</span></span> <span data-ttu-id="5ccd9-127">Rinominare la seconda <xref:System.Windows.Forms.Button> controllo `cancelAsyncButton`e impostare le <xref:System.Windows.Forms.Control.Text%2A> proprietà `Cancel Async`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-127">Rename the second <xref:System.Windows.Forms.Button> control `cancelAsyncButton`, and set the <xref:System.Windows.Forms.Control.Text%2A> property to `Cancel Async`.</span></span> <span data-ttu-id="5ccd9-128">Impostare relativi <xref:System.Windows.Forms.Control.Enabled%2A> proprietà `false`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-128">Set its <xref:System.Windows.Forms.Control.Enabled%2A> property to `false`.</span></span>  
  
6. <span data-ttu-id="5ccd9-129">Creare un gestore eventi per entrambi i <xref:System.Windows.Forms.Button> controlli <xref:System.Windows.Forms.Control.Click> gli eventi.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-129">Create an event handler for both of the <xref:System.Windows.Forms.Button> controls' <xref:System.Windows.Forms.Control.Click> events.</span></span> <span data-ttu-id="5ccd9-130">Per informazioni dettagliate, vedere [Procedura: Creare i gestori eventi utilizzando la finestra di progettazione](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="5ccd9-130">For details, see [How to: Create Event Handlers Using the Designer](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span></span>  
  
7. <span data-ttu-id="5ccd9-131">Trascinare un <xref:System.Windows.Forms.Label> controllare dal **casella degli strumenti** nel form e rinominarlo `resultLabel`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-131">Drag a <xref:System.Windows.Forms.Label> control from the **Toolbox** onto the form and rename it `resultLabel`.</span></span>  
  
8. <span data-ttu-id="5ccd9-132">Trascinare un <xref:System.Windows.Forms.ProgressBar> controllare dal **casella degli strumenti** nel form.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-132">Drag a <xref:System.Windows.Forms.ProgressBar> control from the **Toolbox** onto the form.</span></span>  
  
## <a name="creating-a-backgroundworker-in-your-form"></a><span data-ttu-id="5ccd9-133">Creazione di un BackgroundWorker nel modulo</span><span class="sxs-lookup"><span data-stu-id="5ccd9-133">Creating a BackgroundWorker in Your Form</span></span>  
 <span data-ttu-id="5ccd9-134">È possibile creare il <xref:System.ComponentModel.BackgroundWorker> per l'operazione asincrona utilizzando il **Windows** **progettazione form**.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-134">You can create the <xref:System.ComponentModel.BackgroundWorker> for your asynchronous operation using the **Windows** **Forms Designer**.</span></span>  
  
#### <a name="to-create-a-backgroundworker-with-the-designer"></a><span data-ttu-id="5ccd9-135">Per creare un BackgroundWorker con la finestra di progettazione</span><span class="sxs-lookup"><span data-stu-id="5ccd9-135">To create a BackgroundWorker with the Designer</span></span>  
  
-   <span data-ttu-id="5ccd9-136">Dal **componenti** scheda della finestra di **della casella degli strumenti**, trascinare un <xref:System.ComponentModel.BackgroundWorker> nel form.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-136">From the **Components** tab of the **Toolbox**, drag a <xref:System.ComponentModel.BackgroundWorker> onto the form.</span></span>  
  
## <a name="adding-asynchronous-event-handlers"></a><span data-ttu-id="5ccd9-137">Aggiunta dei gestori eventi asincroni</span><span class="sxs-lookup"><span data-stu-id="5ccd9-137">Adding Asynchronous Event Handlers</span></span>  
 <span data-ttu-id="5ccd9-138">Ora si è pronti per aggiungere i gestori eventi per il <xref:System.ComponentModel.BackgroundWorker> eventi asincroni del componente.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-138">You are now ready to add event handlers for the <xref:System.ComponentModel.BackgroundWorker> component's asynchronous events.</span></span> <span data-ttu-id="5ccd9-139">L'operazione dispendiosa in termini di tempo che verrà eseguita in background, ossia quella che calcola i numeri Fibonacci, viene chiamata da uno di questi gestori eventi.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-139">The time-consuming operation that will run in the background, which computes Fibonacci numbers, is called by one of these event handlers.</span></span>  
  
#### <a name="to-implement-asynchronous-event-handlers"></a><span data-ttu-id="5ccd9-140">Per implementare i gestori eventi asincroni</span><span class="sxs-lookup"><span data-stu-id="5ccd9-140">To implement asynchronous event handlers</span></span>  
  
1. <span data-ttu-id="5ccd9-141">Nel **delle proprietà** finestra con il <xref:System.ComponentModel.BackgroundWorker> componente ancora selezionato, fare clic sul **eventi** pulsante.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-141">In the **Properties** window, with the <xref:System.ComponentModel.BackgroundWorker> component still selected, click the **Events** button.</span></span> <span data-ttu-id="5ccd9-142">Fare doppio clic il <xref:System.ComponentModel.BackgroundWorker.DoWork> e <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> eventi per creare gestori eventi.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-142">Double-click the <xref:System.ComponentModel.BackgroundWorker.DoWork> and <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> events to create event handlers.</span></span> <span data-ttu-id="5ccd9-143">Per altre informazioni su come usare i gestori eventi, vedere [come: Creare i gestori eventi utilizzando la finestra di progettazione](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span><span class="sxs-lookup"><span data-stu-id="5ccd9-143">For more information about how to use event handlers, see [How to: Create Event Handlers Using the Designer](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2010/zwwsdtbk(v=vs.100)).</span></span>  
  
2. <span data-ttu-id="5ccd9-144">Creare nel form un nuovo metodo denominato `ComputeFibonacci`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-144">Create a new method, called `ComputeFibonacci`, in your form.</span></span> <span data-ttu-id="5ccd9-145">L'operazione verrà effettivamente svolta da questo metodo che verrà eseguito in background.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-145">This method does the actual work, and it will run in the background.</span></span> <span data-ttu-id="5ccd9-146">Il codice dimostra l'implementazione ricorsiva dell'algoritmo Fibonacci che è decisamente inefficiente e esponenzialmente impiega più tempo per completare i numeri a molte cifre.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-146">This code demonstrates the recursive implementation of the Fibonacci algorithm, which is notably inefficient, taking exponentially longer time to complete for larger numbers.</span></span> <span data-ttu-id="5ccd9-147">Viene impiegato per dimostrare come un'operazione possa provocare lunghi ritardi nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-147">It is used here for illustrative purposes, to show an operation that can introduce long delays in your application.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#10)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#10)]
     [!code-vb[System.ComponentModel.BackgroundWorker#10](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#10)]  
  
3. <span data-ttu-id="5ccd9-148">Nel <xref:System.ComponentModel.BackgroundWorker.DoWork> gestore dell'evento, aggiungere una chiamata al `ComputeFibonacci` (metodo).</span><span class="sxs-lookup"><span data-stu-id="5ccd9-148">In the <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler, add a call to the `ComputeFibonacci` method.</span></span> <span data-ttu-id="5ccd9-149">Eseguire il primo parametro per `ComputeFibonacci` dal <xref:System.ComponentModel.DoWorkEventArgs.Argument%2A> proprietà del <xref:System.ComponentModel.DoWorkEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-149">Take the first parameter for `ComputeFibonacci` from the <xref:System.ComponentModel.DoWorkEventArgs.Argument%2A> property of the <xref:System.ComponentModel.DoWorkEventArgs>.</span></span> <span data-ttu-id="5ccd9-150">Il <xref:System.ComponentModel.BackgroundWorker> e <xref:System.ComponentModel.DoWorkEventArgs> parametri verranno usati in un secondo momento per i report di stato di avanzamento e annullamento supportano.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-150">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.ComponentModel.DoWorkEventArgs> parameters will be used later for progress reporting and cancellation support.</span></span> <span data-ttu-id="5ccd9-151">Assegnare il valore restituito da `ComputeFibonacci` per il <xref:System.ComponentModel.DoWorkEventArgs.Result%2A> proprietà del <xref:System.ComponentModel.DoWorkEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-151">Assign the return value from `ComputeFibonacci` to the <xref:System.ComponentModel.DoWorkEventArgs.Result%2A> property of the <xref:System.ComponentModel.DoWorkEventArgs>.</span></span> <span data-ttu-id="5ccd9-152">Questo risultato sarà disponibile per il <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-152">This result will be available to the <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> event handler.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="5ccd9-153">Il <xref:System.ComponentModel.BackgroundWorker.DoWork> gestore dell'evento non fa riferimento il `backgroundWorker1` istanze variabile direttamente, come evitare di associare questo gestore eventi a un'istanza specifica di <xref:System.ComponentModel.BackgroundWorker>.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-153">The <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler does not reference the `backgroundWorker1` instance variable directly, as this would couple this event handler to a specific instance of <xref:System.ComponentModel.BackgroundWorker>.</span></span> <span data-ttu-id="5ccd9-154">Al contrario, un riferimento al <xref:System.ComponentModel.BackgroundWorker> che ha generato l'evento viene recuperato dal `sender` parametro.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-154">Instead, a reference to the <xref:System.ComponentModel.BackgroundWorker> that raised this event is recovered from the `sender` parameter.</span></span> <span data-ttu-id="5ccd9-155">Questo è importante quando il modulo include più <xref:System.ComponentModel.BackgroundWorker>.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-155">This is important when the form hosts more than one <xref:System.ComponentModel.BackgroundWorker>.</span></span> <span data-ttu-id="5ccd9-156">È anche importante evitare di modificare tutti gli oggetti dell'interfaccia utente nel <xref:System.ComponentModel.BackgroundWorker.DoWork> gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-156">It is also important not to manipulate any user-interface objects in your <xref:System.ComponentModel.BackgroundWorker.DoWork> event handler.</span></span> <span data-ttu-id="5ccd9-157">Comunicare invece con l'interfaccia utente tramite il <xref:System.ComponentModel.BackgroundWorker> gli eventi.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-157">Instead, communicate to the user interface through the <xref:System.ComponentModel.BackgroundWorker> events.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#5)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#5)]
     [!code-vb[System.ComponentModel.BackgroundWorker#5](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#5)]  
  
4. <span data-ttu-id="5ccd9-158">Nel `startAsyncButton` del controllo <xref:System.Windows.Forms.Control.Click> gestore dell'evento, aggiungere il codice che avvia l'operazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-158">In the `startAsyncButton` control's <xref:System.Windows.Forms.Control.Click> event handler, add the code that starts the asynchronous operation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#13)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#13)]
     [!code-vb[System.ComponentModel.BackgroundWorker#13](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#13)]  
  
5. <span data-ttu-id="5ccd9-159">Nel <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> gestore eventi, assegnare il risultato del calcolo di `resultLabel` controllo.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-159">In the <xref:System.ComponentModel.BackgroundWorker.RunWorkerCompleted> event handler, assign the result of the calculation to the `resultLabel` control.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#6)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#6)]
     [!code-vb[System.ComponentModel.BackgroundWorker#6](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#6)]  
  
## <a name="adding-progress-reporting-and-support-for-cancellation"></a><span data-ttu-id="5ccd9-160">Aggiunta dei report sullo stato di avanzamento e supporto per l'annullamento</span><span class="sxs-lookup"><span data-stu-id="5ccd9-160">Adding Progress Reporting and Support for Cancellation</span></span>  
 <span data-ttu-id="5ccd9-161">Per le operazioni asincrone che impiegano molto tempo è spesso opportuno notificare all'utente lo stato di avanzamento e permettergli di annullare eventualmente l'operazione.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-161">For asynchronous operations that will take a long time, it is often desirable to report progress to the user and to allow the user to cancel the operation.</span></span> <span data-ttu-id="5ccd9-162">Il <xref:System.ComponentModel.BackgroundWorker> classe fornisce un evento che consente di inviare lo stato mentre l'operazione procede in background.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-162">The <xref:System.ComponentModel.BackgroundWorker> class provides an event that allows you to post progress as your background operation proceeds.</span></span> <span data-ttu-id="5ccd9-163">Fornisce inoltre un flag che consente al codice rilevare una chiamata a <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> e interrompersi.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-163">It also provides a flag that allows your worker code to detect a call to <xref:System.ComponentModel.BackgroundWorker.CancelAsync%2A> and interrupt itself.</span></span>  
  
#### <a name="to-implement-progress-reporting"></a><span data-ttu-id="5ccd9-164">Per implementare i report sullo stato di avanzamento</span><span class="sxs-lookup"><span data-stu-id="5ccd9-164">To implement progress reporting</span></span>  
  
1. <span data-ttu-id="5ccd9-165">Nella finestra **Proprietà** selezionare `backgroundWorker1`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-165">In the **Properties**, window, select `backgroundWorker1`.</span></span> <span data-ttu-id="5ccd9-166">Impostare il <xref:System.ComponentModel.BackgroundWorker.WorkerReportsProgress%2A> e <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> delle proprietà per `true`.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-166">Set the <xref:System.ComponentModel.BackgroundWorker.WorkerReportsProgress%2A> and <xref:System.ComponentModel.BackgroundWorker.WorkerSupportsCancellation%2A> properties to `true`.</span></span>  
  
2. <span data-ttu-id="5ccd9-167">Nel modulo `FibonacciCalculator` dichiarare due variabili</span><span class="sxs-lookup"><span data-stu-id="5ccd9-167">Declare two variables in the `FibonacciCalculator` form.</span></span> <span data-ttu-id="5ccd9-168">che verranno utilizzate per tenere traccia dello stato di avanzamento.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-168">These will be used to track progress.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#14)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#14)]
     [!code-vb[System.ComponentModel.BackgroundWorker#14](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#14)]  
  
3. <span data-ttu-id="5ccd9-169">Aggiunge un gestore eventi per l'evento <xref:System.ComponentModel.BackgroundWorker.ProgressChanged>.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-169">Add an event handler for the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event.</span></span> <span data-ttu-id="5ccd9-170">Nel <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> gestore dell'evento, aggiornare il <xref:System.Windows.Forms.ProgressBar> con il <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> proprietà del <xref:System.ComponentModel.ProgressChangedEventArgs> parametro.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-170">In the <xref:System.ComponentModel.BackgroundWorker.ProgressChanged> event handler, update the <xref:System.Windows.Forms.ProgressBar> with the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> property of the <xref:System.ComponentModel.ProgressChangedEventArgs> parameter.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#7)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#7)]
     [!code-vb[System.ComponentModel.BackgroundWorker#7](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#7)]  
  
#### <a name="to-implement-support-for-cancellation"></a><span data-ttu-id="5ccd9-171">Per implementare il supporto per l'annullamento</span><span class="sxs-lookup"><span data-stu-id="5ccd9-171">To implement support for cancellation</span></span>  
  
1. <span data-ttu-id="5ccd9-172">Nel `cancelAsyncButton` del controllo <xref:System.Windows.Forms.Control.Click> gestore dell'evento, aggiungere il codice che consente di annullare l'operazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-172">In the `cancelAsyncButton` control's <xref:System.Windows.Forms.Control.Click> event handler, add the code that cancels the asynchronous operation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#4)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#4)]
     [!code-vb[System.ComponentModel.BackgroundWorker#4](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#4)]  
  
2. <span data-ttu-id="5ccd9-173">I seguenti frammenti di codice nel metodo `ComputeFibonacci` restituiscono lo stato di avanzamento e supportano l'annullamento.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-173">The following code fragments in the `ComputeFibonacci` method report progress and support cancellation.</span></span>  
  
     [!code-cpp[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#11)]
     [!code-csharp[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#11)]
     [!code-vb[System.ComponentModel.BackgroundWorker#11](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#11)]  
    [!code-cpp[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/cpp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CPP/fibonacciform.cpp#12)]
    [!code-csharp[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/csharp/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/CS/fibonacciform.cs#12)]
    [!code-vb[System.ComponentModel.BackgroundWorker#12](~/samples/snippets/visualbasic/VS_Snippets_Winforms/System.ComponentModel.BackgroundWorker/VB/fibonacciform.vb#12)]  
  
## <a name="checkpoint"></a><span data-ttu-id="5ccd9-174">Checkpoint</span><span class="sxs-lookup"><span data-stu-id="5ccd9-174">Checkpoint</span></span>  
 <span data-ttu-id="5ccd9-175">A questo punto è possibile compilare ed eseguire l'applicazione Fibonacci Calculator.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-175">At this point, you can compile and run the Fibonacci Calculator application.</span></span>  
  
#### <a name="to-test-your-project"></a><span data-ttu-id="5ccd9-176">Per eseguire il test del progetto</span><span class="sxs-lookup"><span data-stu-id="5ccd9-176">To test your project</span></span>  
  
-   <span data-ttu-id="5ccd9-177">Premere F5 per compilare ed eseguire l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-177">Press F5 to compile and run the application.</span></span>  
  
     <span data-ttu-id="5ccd9-178">Durante l'esecuzione del calcolo in background, verrà visualizzato il <xref:System.Windows.Forms.ProgressBar> visualizzando lo stato di avanzamento del calcolo in fase di completamento.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-178">While the calculation is running in the background, you will see the <xref:System.Windows.Forms.ProgressBar> displaying the progress of the calculation toward completion.</span></span> <span data-ttu-id="5ccd9-179">È anche possibile annullare l'operazione in sospeso.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-179">You can also cancel the pending operation.</span></span>  
  
     <span data-ttu-id="5ccd9-180">Per i numeri con poche cifre, il calcolo dovrebbe essere molto rapido, ma per i numeri con tante cifre, si potrebbe notare un considerevole ritardo.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-180">For small numbers, the calculation should be very fast, but for larger numbers, you should see a noticeable delay.</span></span> <span data-ttu-id="5ccd9-181">Se si immette il valore 30 o superiore, il ritardo sarà di diversi secondi, a seconda della velocità del computer.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-181">If you enter a value of 30 or greater, you should see a delay of several seconds, depending on the speed of your computer.</span></span> <span data-ttu-id="5ccd9-182">Per i valori maggiori di 40, potrebbero essere necessari diversi minuti o ore per completare il calcolo.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-182">For values greater than 40, it may take minutes or hours to finish the calculation.</span></span> <span data-ttu-id="5ccd9-183">Mentre il calcolatore è impegnato a calcolare un numero Fibonacci con tante cifre, il modulo può essere spostato liberamente, ridotto a icona, ingrandito e persino chiuso</span><span class="sxs-lookup"><span data-stu-id="5ccd9-183">While the calculator is busy computing a large Fibonacci number, notice that you can freely move the form around, minimize, maximize, and even dismiss it.</span></span> <span data-ttu-id="5ccd9-184">in quanto il thread principale dell'interfaccia utente non è in attesa della fine del calcolo.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-184">This is because the main UI thread is not waiting for the calculation to finish.</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="5ccd9-185">Passaggi successivi</span><span class="sxs-lookup"><span data-stu-id="5ccd9-185">Next Steps</span></span>  
 <span data-ttu-id="5ccd9-186">Ora che è stato implementato un modulo che utilizza un <xref:System.ComponentModel.BackgroundWorker> componente per eseguire un calcolo in background, è possibile esplorare altre possibilità per le operazioni asincrone:</span><span class="sxs-lookup"><span data-stu-id="5ccd9-186">Now that you have implemented a form that uses a <xref:System.ComponentModel.BackgroundWorker> component to execute a computation in the background, you can explore other possibilities for asynchronous operations:</span></span>  
  
-   <span data-ttu-id="5ccd9-187">Usare più <xref:System.ComponentModel.BackgroundWorker> oggetti per diverse operazioni simultanee.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-187">Use multiple <xref:System.ComponentModel.BackgroundWorker> objects for several simultaneous operations.</span></span>  
  
-   <span data-ttu-id="5ccd9-188">Per eseguire il debug dell'applicazione con multithreading, vedere [come: Utilizzare la finestra thread](/visualstudio/debugger/how-to-use-the-threads-window).</span><span class="sxs-lookup"><span data-stu-id="5ccd9-188">To debug your multithreaded application, see [How to: Use the Threads Window](/visualstudio/debugger/how-to-use-the-threads-window).</span></span>  
  
-   <span data-ttu-id="5ccd9-189">Implementare il componente che supporta il modello di programmazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-189">Implement your own component that supports the asynchronous programming model.</span></span> <span data-ttu-id="5ccd9-190">Per ulteriori informazioni, vedere [Cenni preliminari sul modello asincrono basato su eventi](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span><span class="sxs-lookup"><span data-stu-id="5ccd9-190">For more information, see [Event-based Asynchronous Pattern Overview](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md).</span></span>  
  
    > [!CAUTION]
    >  <span data-ttu-id="5ccd9-191">L'uso di qualsiasi tipo di multithreading determina la potenziale esposizione a bug seri e complessi.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-191">When using multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="5ccd9-192">Vedere [Procedure consigliate per l'uso del threading gestito](../../../standard/threading/managed-threading-best-practices.md) prima di implementare soluzioni che usano il multithreading.</span><span class="sxs-lookup"><span data-stu-id="5ccd9-192">Consult the [Managed Threading Best Practices](../../../standard/threading/managed-threading-best-practices.md) before implementing any solution that uses multithreading.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5ccd9-193">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="5ccd9-193">See also</span></span>

- <xref:System.ComponentModel.BackgroundWorker?displayProperty=nameWithType>
- [<span data-ttu-id="5ccd9-194">Threading gestito</span><span class="sxs-lookup"><span data-stu-id="5ccd9-194">Managed Threading</span></span>](../../../standard/threading/index.md)
- [<span data-ttu-id="5ccd9-195">Suggerimenti per l'utilizzo del threading gestito</span><span class="sxs-lookup"><span data-stu-id="5ccd9-195">Managed Threading Best Practices</span></span>](../../../standard/threading/managed-threading-best-practices.md)
- [<span data-ttu-id="5ccd9-196">Panoramica sul modello asincrono basato su eventi</span><span class="sxs-lookup"><span data-stu-id="5ccd9-196">Event-based Asynchronous Pattern Overview</span></span>](../../../standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-overview.md)
- [<span data-ttu-id="5ccd9-197">Procedura: Implementare un modulo che usa un'operazione in background</span><span class="sxs-lookup"><span data-stu-id="5ccd9-197">How to: Implement a Form That Uses a Background Operation</span></span>](how-to-implement-a-form-that-uses-a-background-operation.md)
- [<span data-ttu-id="5ccd9-198">Procedura dettagliata: Esecuzione di un'operazione in Background</span><span class="sxs-lookup"><span data-stu-id="5ccd9-198">Walkthrough: Running an Operation in the Background</span></span>](walkthrough-running-an-operation-in-the-background.md)
- [<span data-ttu-id="5ccd9-199">BackgroundWorker (componente)</span><span class="sxs-lookup"><span data-stu-id="5ccd9-199">BackgroundWorker Component</span></span>](backgroundworker-component.md)
