---
title: programmazione per SQL Server e attributi di protezione host
ms.date: 03/30/2017
helpviewer_keywords:
- SQL Server [.NET Framework]
- permission sets, SQL Server
- SQL Server Programming and Host Protection Attributes
- managed code, SQL Server
- reliability [.NET Framework]
- writing reliable code
- hosts, reliability
- host protection attributes
- HostProtectionAttribute class, reliability
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
author: mairaw
ms.author: mairaw
ms.openlocfilehash: f1049187dabbea64599617bb4372ed50515a51e3
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/08/2019
ms.locfileid: "59088719"
---
# <a name="sql-server-programming-and-host-protection-attributes"></a>programmazione per SQL Server e attributi di protezione host
Per poter caricare ed eseguire codice gestito in un host di SQL Server, è necessario soddisfare i requisiti dell'host sia per la sicurezza dall'accesso di codice che per la protezione delle risorse dell'host.  I requisiti di sicurezza di accesso di codice sono specificati da uno dei tre set di autorizzazioni di SQL Server: -SAFE, EXTERNAL-ACCESS o UNSAFE. L'esecuzione del codice nell'ambito del set di autorizzazioni SAFE o EXTERNAL-ACCESS deve evitare alcuni tipi o membri con l'attributo <xref:System.Security.Permissions.HostProtectionAttribute> applicato. <xref:System.Security.Permissions.HostProtectionAttribute> non è un'autorizzazione di sicurezza, ma piuttosto una garanzia di affidabilità perché identifica specifici costrutti del codice, tipi o metodi, che l'host potrebbe non consentire.  L'uso di <xref:System.Security.Permissions.HostProtectionAttribute> impone un modello di programmazione che contribuisce alla protezione della stabilità dell'host.  
  
## <a name="host-protection-attributes"></a>Attributi di protezione dell'host  
 Gli attributi di protezione dell'host identificano i tipi o membri non idonei per il modello di programmazione dell'host e che rappresentano i seguenti livelli crescenti di minaccia per l'affidabilità:  
  
-   Sono altrimenti innocui.  
  
-   Potrebbero portare alla destabilizzazione del codice utente gestito dal server.  
  
-   Potrebbero portare alla destabilizzazione del processo del server stesso.  
  
 SQL Server non consente l'uso di un tipo o membro con <xref:System.Security.Permissions.HostProtectionAttribute> che specifica un valore <xref:System.Security.Permissions.HostProtectionResource> uguale a <xref:System.Security.Permissions.HostProtectionResource.SharedState>, <xref:System.Security.Permissions.HostProtectionResource.Synchronization>, <xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort> o <xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt>. In questo modo si impedisce agli assembly di chiamare membri che consentono la condivisione dello stato, eseguono sincronizzazioni, possono causare perdite di risorse al momento della terminazione o compromettono l'integrità del processo di SQL Server.  
  
### <a name="disallowed-types-and-members"></a>Tipi e membri non consentiti  
 La tabella seguente identifica i tipi e membri i cui valori <xref:System.Security.Permissions.HostProtectionResource> non sono consentiti da SQL Server.  
  
|Spazio dei nomi|Tipo o membro|  
|---------------|--------------------|  
|`Microsoft.Win32`|<xref:Microsoft.Win32.PowerModeChangedEventArgs> classe<br /><br /> <xref:Microsoft.Win32.PowerModeChangedEventHandler> delegato<br /><br /> <xref:Microsoft.Win32.SessionEndedEventArgs> classe<br /><br /> <xref:Microsoft.Win32.SessionEndedEventHandler> delegato<br /><br /> <xref:Microsoft.Win32.SessionEndingEventArgs> classe<br /><br /> <xref:Microsoft.Win32.SessionEndingEventHandler> delegato<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventArgs> classe<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventHandler> delegato<br /><br /> <xref:Microsoft.Win32.SystemEvents> classe<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventArgs> classe<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventHandler> delegato<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangedEventArgs> classe<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangingEventArgs> classe|  
|`System.Collections`|<xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType> metodo|  
|`System.ComponentModel`|<xref:System.ComponentModel.AddingNewEventArgs> classe<br /><br /> <xref:System.ComponentModel.AddingNewEventHandler> delegato<br /><br /> <xref:System.ComponentModel.ArrayConverter> classe<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventArgs> classe<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventHandler> delegato<br /><br /> <xref:System.ComponentModel.AsyncOperation> classe<br /><br /> <xref:System.ComponentModel.AsyncOperationManager> classe<br /><br /> <xref:System.ComponentModel.AttributeCollection> classe<br /><br /> <xref:System.ComponentModel.BackgroundWorker> classe<br /><br /> <xref:System.ComponentModel.BaseNumberConverter> classe<br /><br /> <xref:System.ComponentModel.BindingList%601> classe<br /><br /> <xref:System.ComponentModel.BooleanConverter> classe<br /><br /> <xref:System.ComponentModel.ByteConverter> classe<br /><br /> <xref:System.ComponentModel.CancelEventArgs> classe<br /><br /> <xref:System.ComponentModel.CancelEventHandler> delegato<br /><br /> <xref:System.ComponentModel.CharConverter> classe<br /><br /> <xref:System.ComponentModel.CollectionChangeEventArgs> classe<br /><br /> <xref:System.ComponentModel.CollectionChangeEventHandler> delegato<br /><br /> <xref:System.ComponentModel.CollectionConverter> classe<br /><br /> <xref:System.ComponentModel.ComponentCollection> classe<br /><br /> <xref:System.ComponentModel.ComponentConverter> classe<br /><br /> <xref:System.ComponentModel.ComponentEditor> classe<br /><br /> <xref:System.ComponentModel.ComponentResourceManager> classe<br /><br /> <xref:System.ComponentModel.Container> classe<br /><br /> <xref:System.ComponentModel.ContainerFilterService> classe<br /><br /> <xref:System.ComponentModel.CultureInfoConverter> classe<br /><br /> <xref:System.ComponentModel.CustomTypeDescriptor> classe<br /><br /> <xref:System.ComponentModel.DateTimeConverter> classe<br /><br /> <xref:System.ComponentModel.DecimalConverter> classe<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventHandler> delegato<br /><br /> <xref:System.ComponentModel.Design.CheckoutException> classe<br /><br /> <xref:System.ComponentModel.Design.CommandID> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventHandler> delegato<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventHandler> delegato<br /><br /> <xref:System.ComponentModel.Design.ComponentEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentEventHandler> delegato<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventHandler> delegato<br /><br /> <xref:System.ComponentModel.Design.DesignerCollection> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerEventHandler> delegato<br /><br /> <xref:System.ComponentModel.Design.DesignerOptionService> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerTransaction> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler> delegato<br /><br /> <xref:System.ComponentModel.Design.DesignerVerb> classe<br /><br /> <xref:System.ComponentModel.Design.DesignerVerbCollection> classe<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContext> classe<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer> classe<br /><br /> <xref:System.ComponentModel.Design.MenuCommand> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.ContextStack> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.DesignerLoader> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs> classe<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler> delegato<br /><br /> <xref:System.ComponentModel.Design.Serialization.SerializationStore> classe<br /><br /> <xref:System.ComponentModel.Design.ServiceContainer> classe<br /><br /> <xref:System.ComponentModel.Design.ServiceCreatorCallback> delegato<br /><br /> <xref:System.ComponentModel.Design.StandardCommands> classe<br /><br /> <xref:System.ComponentModel.Design.StandardToolWindows> classe<br /><br /> <xref:System.ComponentModel.DoubleConverter> classe<br /><br /> <xref:System.ComponentModel.DoWorkEventArgs> classe<br /><br /> <xref:System.ComponentModel.DoWorkEventHandler> delegato<br /><br /> <xref:System.ComponentModel.EnumConverter> classe<br /><br /> <xref:System.ComponentModel.EventDescriptor> classe<br /><br /> <xref:System.ComponentModel.EventDescriptorCollection> classe<br /><br /> <xref:System.ComponentModel.EventHandlerList> classe<br /><br /> <xref:System.ComponentModel.ExpandableObjectConverter> classe<br /><br /> <xref:System.ComponentModel.HandledEventArgs> classe<br /><br /> <xref:System.ComponentModel.HandledEventHandler> delegato<br /><br /> <xref:System.ComponentModel.InstanceCreationEditor> classe<br /><br /> <xref:System.ComponentModel.Int16Converter> classe<br /><br /> <xref:System.ComponentModel.Int32Converter> classe<br /><br /> <xref:System.ComponentModel.Int64Converter> classe<br /><br /> <xref:System.ComponentModel.InvalidAsynchronousStateException> classe<br /><br /> <xref:System.ComponentModel.InvalidEnumArgumentException> classe<br /><br /> <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A> metodo<br /><br /> <xref:System.ComponentModel.License> classe<br /><br /> <xref:System.ComponentModel.LicenseContext> classe<br /><br /> <xref:System.ComponentModel.LicenseException> classe<br /><br /> <xref:System.ComponentModel.LicenseManager> classe<br /><br /> <xref:System.ComponentModel.LicenseProvider> classe<br /><br /> <xref:System.ComponentModel.LicFileLicenseProvider> classe<br /><br /> <xref:System.ComponentModel.ListChangedEventArgs> classe<br /><br /> <xref:System.ComponentModel.ListChangedEventHandler> delegato<br /><br /> <xref:System.ComponentModel.ListSortDescription> classe<br /><br /> <xref:System.ComponentModel.ListSortDescriptionCollection> classe<br /><br /> <xref:System.ComponentModel.MaskedTextProvider> classe<br /><br /> <xref:System.ComponentModel.MemberDescriptor> classe<br /><br /> <xref:System.ComponentModel.MultilineStringConverter> classe<br /><br /> <xref:System.ComponentModel.NestedContainer> classe<br /><br /> <xref:System.ComponentModel.NullableConverter> classe<br /><br /> <xref:System.ComponentModel.ProgressChangedEventArgs> classe<br /><br /> <xref:System.ComponentModel.ProgressChangedEventHandler> delegato<br /><br /> <xref:System.ComponentModel.PropertyChangedEventArgs> classe<br /><br /> <xref:System.ComponentModel.PropertyChangedEventHandler> delegato<br /><br /> <xref:System.ComponentModel.PropertyDescriptor> classe<br /><br /> <xref:System.ComponentModel.PropertyDescriptorCollection> classe<br /><br /> <xref:System.ComponentModel.ReferenceConverter> classe<br /><br /> <xref:System.ComponentModel.RefreshEventArgs> classe<br /><br /> <xref:System.ComponentModel.RefreshEventHandler> delegato<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventArgs> classe<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventHandler> delegato<br /><br /> <xref:System.ComponentModel.SByteConverter> classe<br /><br /> <xref:System.ComponentModel.SingleConverter> classe<br /><br /> <xref:System.ComponentModel.StringConverter> classe<br /><br /> <xref:System.ComponentModel.SyntaxCheck> classe<br /><br /> <xref:System.ComponentModel.TimeSpanConverter> classe<br /><br /> <xref:System.ComponentModel.TypeConverter> classe<br /><br /> <xref:System.ComponentModel.TypeDescriptionProvider> classe<br /><br /> <xref:System.ComponentModel.TypeDescriptor> classe<br /><br /> <xref:System.ComponentModel.TypeListConverter> classe<br /><br /> <xref:System.ComponentModel.UInt16Converter> classe<br /><br /> <xref:System.ComponentModel.UInt32Converter> classe<br /><br /> <xref:System.ComponentModel.UInt64Converter> classe<br /><br /> <xref:System.ComponentModel.WarningException> classe<br /><br /> <xref:System.ComponentModel.Win32Exception> classe|  
|`System.Diagnostics`|<xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType> proprietà<br /><br /> <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> proprietà<br /><br /> <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType> proprietà<br /><br /> <xref:System.Diagnostics.ConsoleTraceListener> classe<br /><br /> <xref:System.Diagnostics.DefaultTraceListener> classe<br /><br /> <xref:System.Diagnostics.DelimitedListTraceListener> classe<br /><br /> <xref:System.Diagnostics.EventLogTraceListener> classe<br /><br /> <xref:System.Diagnostics.PerformanceCounter> classe<br /><br /> <xref:System.Diagnostics.PerformanceCounterCategory> classe<br /><br /> <xref:System.Diagnostics.Process> classe<br /><br /> <xref:System.Diagnostics.ProcessStartInfo> classe<br /><br /> <xref:System.Diagnostics.TextWriterTraceListener> classe<br /><br /> <xref:System.Diagnostics.TraceListener> classe<br /><br /> <xref:System.Diagnostics.XmlWriterTraceListener> classe<br /><br /> <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType> proprietà|  
|`System.IO`|<xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType> metodo|  
|`System.Reflection.Emit`|<xref:System.Reflection.Emit.ConstructorBuilder> classe<br /><br /> <xref:System.Reflection.Emit.EventBuilder> classe<br /><br /> <xref:System.Reflection.Emit.FieldBuilder> classe<br /><br /> <xref:System.Reflection.Emit.MethodBuilder> classe<br /><br /> <xref:System.Reflection.Emit.CustomAttributeBuilder> classe<br /><br /> <xref:System.Reflection.Emit.MethodRental> classe<br /><br /> <xref:System.Reflection.Emit.ModuleBuilder> classe<br /><br /> <xref:System.Reflection.Emit.PropertyBuilder> classe<br /><br /> <xref:System.Reflection.Emit.TypeBuilder> classe<br /><br /> <xref:System.Reflection.Emit.UnmanagedMarshal> classe|  
|`System.Text`|<xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType> metodo|  
|`System.Threading`|<xref:System.Threading.AutoResetEvent> classe<br /><br /> <xref:System.Threading.EventWaitHandle> classe<br /><br /> <xref:System.Threading.ManualResetEvent> classe<br /><br /> <xref:System.Threading.Monitor> classe<br /><br /> <xref:System.Threading.Mutex> classe<br /><br /> <xref:System.Threading.ReaderWriterLock> classe<br /><br /> <xref:System.Threading.Semaphore> classe<br /><br /> <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType> metodo<br /><br /> <xref:System.Threading.ThreadPool> classe<br /><br /> <xref:System.Threading.Timer> classe|  
|`System.Timers`|<xref:System.Timers.Timer> classe|  
|`System.Web.Configuration`|<xref:System.Web.Configuration.MachineKeyValidationConverter> classe|  
|`System.Windows.Forms`|<xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType> proprietà|  
  
## <a name="sql-server-permission-sets"></a>Set di autorizzazioni di SQL Server  
 SQL Server consente agli utenti di specificare i requisiti di affidabilità per il codice distribuito in un database. Quando gli assembly vengono caricati nel database, l'autore dell'assembly può specificare uno dei tre set di autorizzazioni per tale assembly: -SAFE, EXTERNAL-ACCESS o UNSAFE.  
  
|Set di autorizzazioni|SAFE|EXTERNAL-ACCESS|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|Sicurezza dall'accesso di codice|Sola esecuzione|Esecuzione più accesso alle risorse esterne|Senza restrizioni|  
|Restrizioni relative al modello di programmazione|Yes|Yes|Nessuna restrizione|  
|Requisito di verificabilità|Yes|Yes|No|  
|Possibilità di chiamare codice nativo|No|No|Yes|  
  
 SAFE è la modalità più affidabile e sicura con le restrizioni associate in termini di modello di programmazione consentito. Il codice SAFE dispone di funzionalità di sicurezza e affidabilità elevata. Agli assembly SAFE vengono concesse autorizzazioni sufficienti per l'esecuzione, l'esecuzione di calcoli e l'accesso al database locale. Gli assembly SAFE devono essere indipendenti dai tipi in modo verificabile e non possono chiamare codice non gestito.  
  
 Il livello EXTERNAL-ACCESS rappresenta un'opzione di sicurezza intermedia, consentendo al codice di accedere alle risorse esterne al database, ma comunque con l'affidabilità e la protezione del livello SAFE.  
  
 Il livello UNSAFE è destinato a codice altamente attendibile che può essere creato solo dagli amministratori di database. Questo codice attendibile non presenta alcuna restrizione di accesso di codice e può chiamare codice non gestito (nativo).  
  
 SQL Server usa il livello dei criteri di sicurezza dall'accesso di codice a livello dell'host per configurare criteri host che concedono uno dei tre set di autorizzazioni in base al set di autorizzazioni archiviato nei cataloghi di SQL Server. Al codice gestito in esecuzione all'interno del database viene sempre assegnato uno di questi set di autorizzazioni per l'accesso di codice.  
  
## <a name="programming-model-restrictions"></a>Restrizioni relative al modello di programmazione  
 Il modello di programmazione per il codice gestito in SQL Server richiede funzioni, procedure e tipi che non richiedono l'uso dello stato mantenuto tra più chiamate né la condivisione dello stato tra più sessioni utente. Inoltre, come descritto in precedenza, la presenza di uno stato condiviso può causare eccezioni critiche che influiscono sulla scalabilità e l'affidabilità dell'applicazione.  
  
 Considerati questi aspetti, SQL Server non consente l'uso di variabili statiche e membri dati statici. Per gli assembly SAFE ed EXTERNAL-ACCESS, SQL Server esamina i metadati dell'assembly nella fase CREATE ASSEMBLY e la creazione di tali assembly ha esito negativo se viene rilevato l'uso di membri dati e variabili statici.  
  
## <a name="see-also"></a>Vedere anche

- <xref:System.Security.Permissions.HostProtectionAttribute>
- <xref:System.Security.Permissions.HostProtectionResource>
