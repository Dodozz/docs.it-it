---
title: Propagazione di ID attività
ms.date: 03/30/2017
ms.assetid: cd1c1ae5-cc8a-4f51-90c9-f7b476bcfe70
ms.openlocfilehash: 642d4da49f90d3fc6f2b0dfc9896d724acb075b5
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/28/2019
ms.locfileid: "64651813"
---
# <a name="activity-id-propagation"></a><span data-ttu-id="f910b-102">Propagazione di ID attività</span><span class="sxs-lookup"><span data-stu-id="f910b-102">Activity ID Propagation</span></span>
<span data-ttu-id="f910b-103">La propagazione si verifica quando la traccia attività ServiceModel viene attivata (propagazione di ServiceModel) o disattivata (propagazione di attività utente-utente).</span><span class="sxs-lookup"><span data-stu-id="f910b-103">Propagation happens when ServiceModel activity tracing is enabled (ServiceModel propagation) or disabled (User-to-User activity propagation).</span></span>  
  
## <a name="servicemodel-activity-tracing-is-enabled"></a><span data-ttu-id="f910b-104">Traccia attività ServiceModel attivata</span><span class="sxs-lookup"><span data-stu-id="f910b-104">ServiceModel Activity Tracing is Enabled</span></span>  
 <span data-ttu-id="f910b-105">Se la traccia attività ServiceModel è attivata, la propagazione si verifica tra le attività ProcessAction.</span><span class="sxs-lookup"><span data-stu-id="f910b-105">If ServiceModel ActivityTracing is enabled, propagation happens between ProcessAction activities.</span></span>  
  
### <a name="server"></a><span data-ttu-id="f910b-106">Server</span><span class="sxs-lookup"><span data-stu-id="f910b-106">Server</span></span>  
 <span data-ttu-id="f910b-107">Quando la `propagateActivity` attributo è impostato su `true` sia il client di server, l'ID delle `ProcessAction` attività nel server è identico all'ID nella propagazione `ActivityId` intestazione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="f910b-107">When the `propagateActivity` attribute is set to `true` on both the client and server, the ID of the `ProcessAction` activity in the server is identical to the ID in the propagated `ActivityId` message header.</span></span>  
  
 <span data-ttu-id="f910b-108">Se non si specifica `ActivityId` è presente nel messaggio di intestazione (vale a dire `propagateActivity` = `false` sul client), o quando `propagateActivity` = `false` sul server, il server genera un nuovo ID di attività.</span><span class="sxs-lookup"><span data-stu-id="f910b-108">When no `ActivityId` header is present in the message (that is, `propagateActivity`=`false` on the client), or when `propagateActivity`=`false` on the server, the server generates a new activity ID.</span></span>  
  
### <a name="client"></a><span data-ttu-id="f910b-109">Client</span><span class="sxs-lookup"><span data-stu-id="f910b-109">Client</span></span>  
 <span data-ttu-id="f910b-110">Se il client è a thread singolo in modalità sincrona, ignora qualsiasi impostazione di `propagateActivity` sul client o sul server.</span><span class="sxs-lookup"><span data-stu-id="f910b-110">If the client is synchronously single threaded, the client disregards any settings of `propagateActivity` at the client or server.</span></span> <span data-ttu-id="f910b-111">La risposta viene invece gestita nell'attività di richiesta.</span><span class="sxs-lookup"><span data-stu-id="f910b-111">Instead, the response is handled in the request activity.</span></span> <span data-ttu-id="f910b-112">Se il client è sincrono o asincrono a thread multipli, `propagateActivity` = `true` nel client e vi è un'intestazione ID attività nel messaggio inviato dal server, il client recupera l'ID attività dal messaggio e trasferisce al Attività elaborazione azione che contiene l'ID attività propagato.</span><span class="sxs-lookup"><span data-stu-id="f910b-112">If the client is asynchronous or synchronous multithreaded, `propagateActivity`=`true` in the client, and there is an activity ID header in the message sent by the server, the client retrieves the activity ID from the message, and transfers to the Process Action activity that contains the propagated activity ID.</span></span> <span data-ttu-id="f910b-113">In caso contrario, il client esegue il trasferimento dall'attività Elaborazione messaggio a una nuova attività Elaborazione azione.</span><span class="sxs-lookup"><span data-stu-id="f910b-113">Otherwise, the client transfers from Process Message activity to a new Process Action activity.</span></span> <span data-ttu-id="f910b-114">Questo ulteriore trasferimento a una nuova attività Elaborazione azione viene eseguito per coerenza.</span><span class="sxs-lookup"><span data-stu-id="f910b-114">This extra transfer to a new Process Action activity is done for consistency.</span></span> <span data-ttu-id="f910b-115">In questa attività, il client recupera l'ID attività dell'attività BeginCall dal contesto del thread locale, quando il thread viene allocato per l'elaborazione del messaggio di risposta.</span><span class="sxs-lookup"><span data-stu-id="f910b-115">Inside this activity, the client retrieves the activity ID of the BeginCall activity from the local thread context, when the thread is allocated for response message processing.</span></span> <span data-ttu-id="f910b-116">Trasferisce quindi tale ID all'attività Elaborazione azione.</span><span class="sxs-lookup"><span data-stu-id="f910b-116">It then transfers to the initial Process Action activity.</span></span>  
  
 <span data-ttu-id="f910b-117">Se il client è duplex, agisce da server alla ricezione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="f910b-117">If the client is duplex, the client acts as server on receiving the message.</span></span>  
  
### <a name="propagation-in-fault-messages"></a><span data-ttu-id="f910b-118">Propagazione nei messaggi di errore</span><span class="sxs-lookup"><span data-stu-id="f910b-118">Propagation in Fault Messages</span></span>  
 <span data-ttu-id="f910b-119">Non c'è differenza nello gestire messaggi validi e di errore.</span><span class="sxs-lookup"><span data-stu-id="f910b-119">There is no difference in handling valid and fault messages.</span></span> <span data-ttu-id="f910b-120">Se `propagateActivity` = `true`, l'ID attività aggiunto alle intestazioni di messaggio di errore SOAP è identico all'attività dell'ambiente.</span><span class="sxs-lookup"><span data-stu-id="f910b-120">If `propagateActivity`=`true`, the activity ID added to the SOAP fault message headers is identical to the ambient activity.</span></span>  
  
## <a name="servicemodel-activity-tracing-is-disabled"></a><span data-ttu-id="f910b-121">Traccia attività ServiceModel disattivata</span><span class="sxs-lookup"><span data-stu-id="f910b-121">ServiceModel Activity Tracing is Disabled</span></span>  
 <span data-ttu-id="f910b-122">Se la traccia attività ServiceModel è disattivata, la propagazione si verifica direttamente tra le attività del codice utente, senza passare per le attività ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="f910b-122">If ServiceModel ActivityTracing is disabled, propagation occurs between user code activities directly without going through ServiceModel activities.</span></span> <span data-ttu-id="f910b-123">Viene inoltre propagato un ID attività definito dall'utente tramite l'intestazione ID attività del messaggio.</span><span class="sxs-lookup"><span data-stu-id="f910b-123">A user-defined activity ID is also propagated through the message activity ID header.</span></span>  
  
 <span data-ttu-id="f910b-124">Se `propagateActivity` = `true` e `ActivityTracing` = `off` per un listener di traccia ServiceModel (indipendentemente dal fatto che la tracciatura è attivata su ServiceModel), si verifica quanto segue sul server o client:</span><span class="sxs-lookup"><span data-stu-id="f910b-124">If `propagateActivity`=`true` and `ActivityTracing`=`off` for a ServiceModel trace listener (regardless of whether tracing is enabled on ServiceModel), the following happen on either the client or server:</span></span>  
  
- <span data-ttu-id="f910b-125">Alla richiesta di un'operazione o all'invio di una risposta, l'ID attività in TLS viene propagato fuori dal codice utente fino a quando non viene formato un messaggio.</span><span class="sxs-lookup"><span data-stu-id="f910b-125">On operation request or sending response, the activity ID in TLS is propagated out of user code until a message is formed.</span></span> <span data-ttu-id="f910b-126">Viene inoltre inserita un'intestazione ID attività nel messaggio prima dell'invio.</span><span class="sxs-lookup"><span data-stu-id="f910b-126">An activity ID header is also inserted into the message before it is sent.</span></span>  
  
- <span data-ttu-id="f910b-127">Alla ricezione di una richiesta o una risposta, l'ID attività viene recuperato dall'intestazione del messaggio non appena viene creato l'oggetto messaggio.</span><span class="sxs-lookup"><span data-stu-id="f910b-127">On receiving request or receiving response, the activity ID is retrieved from the message header as soon as the received message object is created.</span></span> <span data-ttu-id="f910b-128">L'ID attività in TLS viene propagato non appena il messaggio scompare dall'ambito, fino a quando non viene raggiunto il codice utente.</span><span class="sxs-lookup"><span data-stu-id="f910b-128">The activity ID in TLS is propagated as soon as the message disappears from scope until user code is reached.</span></span>  
  
 <span data-ttu-id="f910b-129">Questa garanzia delle azioni che le tracce dell'utente saranno visualizzate nella stessa attività se la propagazione è su.</span><span class="sxs-lookup"><span data-stu-id="f910b-129">These actions guarantee that user traces will appear in the same activity if propagation is on.</span></span> <span data-ttu-id="f910b-130">Tuttavia, non costituisce per le tracce ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="f910b-130">However, it makes no guarantee on ServiceModel traces.</span></span> <span data-ttu-id="f910b-131">Le tracce ServiceModel si verificano in un'attività del codice utente solo se l'elaborazione di tali tracce viene eseguita sullo stesso thread dove l'attività del codice utente è impostata.</span><span class="sxs-lookup"><span data-stu-id="f910b-131">ServiceModel traces occur in a user code activity only if the processing of those traces is executed on the same thread where the user code activity was set.</span></span>  
  
 <span data-ttu-id="f910b-132">In generale, le traccie ServiceModel possono essere osservate nelle posizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="f910b-132">In general, ServiceModel traces can be observed in the following places:</span></span>  
  
- <span data-ttu-id="f910b-133">Se la traccia ServiceModel è disattivata, tutte le tracce emesse vengono visualizzate in attività utente.</span><span class="sxs-lookup"><span data-stu-id="f910b-133">If ServiceModel tracing is disabled, all emitted traces appear in user activities.</span></span> <span data-ttu-id="f910b-134">Se la propagazione è attivata sul server e sul client, queste tracce si troveranno nella stessa attività.</span><span class="sxs-lookup"><span data-stu-id="f910b-134">If propagation is enabled at both the server and client, these traces will be in the same activity.</span></span>  
  
- <span data-ttu-id="f910b-135">Se la traccia ServiceModel è attivata, ma ActivityTracing è disattivata, le tracce utente verranno visualizzate nella stessa attività, se la propagazione è attivata su entrambe le estremità.</span><span class="sxs-lookup"><span data-stu-id="f910b-135">If ServiceModel tracing is enabled, but ActivityTracing is disabled, user traces appear in the same activity if propagation is enabled on both ends.</span></span> <span data-ttu-id="f910b-136">Le tracce ServiceModel si trovano nell'attività 0000 predefinita, a meno che non si verifichino nello stesso thread dell'elaborazione del codice utente in cui l'attività è inizialmente impostata.</span><span class="sxs-lookup"><span data-stu-id="f910b-136">ServiceModel traces appear in the default 0000 activity, unless they occur in the same thread as the user code processing where the activity is initially set.</span></span>  
  
- <span data-ttu-id="f910b-137">Se entrambe le tracce ServiceModel e ActivityTracing sono attivate, le traccie dell'utente sono visualizzate in attività definite dall'utente e le traccie ServiceModel sono visualizzate in attività definite da ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="f910b-137">If both ServiceModel tracing and ActivityTracing are enabled, user traces appear in user-defined activities, and ServiceModel traces appear in ServiceModel-defined activities.</span></span> <span data-ttu-id="f910b-138">La propagazione si verificherà a livello di ServiceModel.</span><span class="sxs-lookup"><span data-stu-id="f910b-138">Propagation happens at ServiceModel level.</span></span>
