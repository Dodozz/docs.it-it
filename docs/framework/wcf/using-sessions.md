---
title: Uso di sessioni
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- sessions [WCF]
ms.assetid: 864ba12f-3331-4359-a359-6d6d387f1035
ms.openlocfilehash: fc7b86f3f2c2c6276681c324dbe9a390fdfdafd4
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 04/23/2019
ms.locfileid: "61791456"
---
# <a name="using-sessions"></a><span data-ttu-id="e8ea1-102">Uso di sessioni</span><span class="sxs-lookup"><span data-stu-id="e8ea1-102">Using Sessions</span></span>
<span data-ttu-id="e8ea1-103">Nelle applicazioni Windows Communication Foundation (WCF), un *sessione* correla un gruppo di messaggi in una conversazione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-103">In Windows Communication Foundation (WCF) applications, a *session* correlates a group of messages into a conversation.</span></span> <span data-ttu-id="e8ea1-104">Le sessioni WCF sono differenti dall'oggetto sessione disponibile nelle [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applicazioni, supportano comportamenti diversi e sono controllate in modi diversi.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-104">WCF sessions are different than the session object available in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications, support different behaviors, and are controlled in different ways.</span></span> <span data-ttu-id="e8ea1-105">In questo argomento descrive le funzionalità che consentono le sessioni in WCF le applicazioni e come usarli.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-105">This topic describes the features that sessions enable in WCF applications and how to use them.</span></span>  
  
## <a name="sessions-in-windows-communication-foundation-applications"></a><span data-ttu-id="e8ea1-106">Sessioni nelle applicazioni Windows Communication Foundation</span><span class="sxs-lookup"><span data-stu-id="e8ea1-106">Sessions in Windows Communication Foundation Applications</span></span>  
 <span data-ttu-id="e8ea1-107">Quando un contratto di servizio specifica che è necessaria una sessione, significa che tutte le chiamate, ovvero gli scambi di messaggi sottostanti che supportano le chiamate, devono essere parte della stessa conversazione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-107">When a service contract specifies that it requires a session, that contract is specifying that all calls (that is, the underlying message exchanges that support the calls) must be part of the same conversation.</span></span> <span data-ttu-id="e8ea1-108">Se un contratto consente sessioni ma non ne richiede, i client possono connettersi e possono stabilire o meno una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-108">If a contract specifies that it allows sessions but does not require one, clients can connect and either establish a session or not establish a session.</span></span> <span data-ttu-id="e8ea1-109">Se, al termine della sessione, un messaggio viene inviato sullo stesso canale basato sulla sessione, viene generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-109">If the session ends and a message is sent through the same channel an exception is thrown.</span></span>  
  
 <span data-ttu-id="e8ea1-110">Le sessioni WCF hanno le principali funzionalità concettuale seguente:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-110">WCF sessions have the following main conceptual features:</span></span>  
  
- <span data-ttu-id="e8ea1-111">Vengono avviate e terminate esplicitamente dall'applicazione chiamante (client WCF).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-111">They are explicitly initiated and terminated by the calling application (the WCF client).</span></span>  
  
- <span data-ttu-id="e8ea1-112">I messaggi recapitati durante una sessione vengono elaborati nell'ordine in cui vengono ricevuti.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-112">Messages delivered during a session are processed in the order in which they are received.</span></span>  
  
- <span data-ttu-id="e8ea1-113">Le sessioni consentono di correlare un gruppo di messaggi in una conversazione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-113">Sessions correlate a group of messages into a conversation.</span></span> <span data-ttu-id="e8ea1-114">Sono possibili diversi tipi di correlazione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-114">Different types of correlation are possible.</span></span> <span data-ttu-id="e8ea1-115">Un canale basato sulla sessione, ad esempio, è in grado di correlare messaggi basati su una connessione di rete condivisa mentre un altro canale basato sulla sessione è in grado di correlare messaggi basati su un tag condiviso nel corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-115">For instance, one session-based channel may correlate messages based on a shared network connection while another session-based channel may correlate messages based on a shared tag in the message body.</span></span> <span data-ttu-id="e8ea1-116">Le funzionalità che possono derivare dalla sessione dipendono dalla natura della correlazione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-116">The features that can be derived from the session depend on the nature of the correlation.</span></span>  
  
- <span data-ttu-id="e8ea1-117">Non vi è alcun archivio dati generale associato a una sessione WCF.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-117">There is no general data store associated with a WCF session.</span></span>  
  
 <span data-ttu-id="e8ea1-118">Se si ha familiarità con le <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> classe [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applicazioni e le funzionalità offre, è possibile notare le differenze seguenti tra quel tipo di sessioni e le sessioni WCF:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-118">If you are familiar with the <xref:System.Web.SessionState.HttpSessionState?displayProperty=nameWithType> class in [!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] applications and the functionality it provides, you might notice the following differences between that kind of session and WCF sessions:</span></span>  
  
- <span data-ttu-id="e8ea1-119">Le sessioni[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sono sempre avviate dal server.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-119">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions are always server-initiated.</span></span>  
  
- <span data-ttu-id="e8ea1-120">Le sessioni[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sono implicitamente non ordinate.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-120">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions are implicitly unordered.</span></span>  
  
- <span data-ttu-id="e8ea1-121">Le sessioni[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] forniscono un meccanismo di archiviazione dati generale tramite richieste.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-121">[!INCLUDE[vstecasp](../../../includes/vstecasp-md.md)] sessions provide a general data storage mechanism across requests.</span></span>  
  
 <span data-ttu-id="e8ea1-122">In questo argomento vengono descritti gli argomenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-122">This topic describes:</span></span>  
  
- <span data-ttu-id="e8ea1-123">Il comportamento di esecuzione predefinito quando si utilizzano associazioni basate su sessione nel livello del modello di servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-123">The default execution behavior when using session-based bindings in the service model layer.</span></span>  
  
- <span data-ttu-id="e8ea1-124">I tipi di caratteristiche che forniscono i binding WCF basati su sessione, fornita dal sistema.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-124">The types of features that the WCF session-based, system-provided bindings provide.</span></span>  
  
- <span data-ttu-id="e8ea1-125">Come creare un contratto che dichiara un requisito della sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-125">How to create a contract that declares a session requirement.</span></span>  
  
- <span data-ttu-id="e8ea1-126">Come comprendere e controllare la creazione e chiusura della sessione e la relazione della sessione all'istanza del servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-126">How to understand and control the creation and termination of the session and the relationship of the session to the service instance.</span></span>  
  
## <a name="default-execution-behavior-using-sessions"></a><span data-ttu-id="e8ea1-127">Comportamento di esecuzione predefinito utilizzando le sessioni</span><span class="sxs-lookup"><span data-stu-id="e8ea1-127">Default Execution Behavior Using Sessions</span></span>  
 <span data-ttu-id="e8ea1-128">Un'associazione che tenta di avviare una sessione è chiamata un'associazione *basata sulla sessione* .</span><span class="sxs-lookup"><span data-stu-id="e8ea1-128">A binding that attempts to initiate a session is called a *session-based* binding.</span></span> <span data-ttu-id="e8ea1-129">Nei contratti di servizio viene specificata la richiesta, permesso o rifiuto di associazioni basate sulla sessione tramite l'impostazione della proprietà <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> sull'interfaccia del contratto di servizio (o classe) su uno dei valori di enumerazione <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="e8ea1-129">Service contracts specify that they require, permit, or refuse session-based bindings by setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on the service contract interface (or class) to one of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration values.</span></span> <span data-ttu-id="e8ea1-130">Per impostazione predefinita, il valore di questa proprietà è <xref:System.ServiceModel.SessionMode.Allowed>, vale a dire che se un client utilizza un'associazione basata sulla sessione con un'implementazione del servizio WCF, il servizio stabilisce e utilizza la sessione fornita.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-130">By default, the value of this property is <xref:System.ServiceModel.SessionMode.Allowed>, which means that if a client uses a session-based binding with a WCF service implementation, the service establishes and uses the session provided.</span></span>  
  
 <span data-ttu-id="e8ea1-131">Quando un servizio WCF accetta una sessione client, le seguenti funzionalità sono abilitate per impostazione predefinita:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-131">When a WCF service accepts a client session, the following features are enabled by default:</span></span>  
  
1. <span data-ttu-id="e8ea1-132">Tutte le chiamate tra un oggetto client WCF vengono gestite dalla stessa istanza del servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-132">All calls between a WCF client object are handled by the same service instance.</span></span>  
  
2. <span data-ttu-id="e8ea1-133">Diverse associazioni basate sulla sessione forniscono caratteristiche aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-133">Different session-based bindings provide additional features.</span></span>  
  
## <a name="system-provided-session-types"></a><span data-ttu-id="e8ea1-134">Tipi di sessione forniti dal sistema</span><span class="sxs-lookup"><span data-stu-id="e8ea1-134">System-Provided Session Types</span></span>  
 <span data-ttu-id="e8ea1-135">Un'associazione basata sulla sessione supporta l'associazione predefinita di un'istanza del servizio con una determinata sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-135">A session-based binding supports the default association of a service instance with a particular session.</span></span> <span data-ttu-id="e8ea1-136">Tuttavia, associazioni basate sulla sessione diverse supportano funzionalità diverse oltre a consentire il controllo delle istanze basate sulla sessione descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-136">However, different session-based bindings support different features in addition to enabling the session-based instancing control previously described.</span></span>  
  
 <span data-ttu-id="e8ea1-137">WCF fornisce i seguenti tipi di comportamento basato sulla sessione dell'applicazione:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-137">WCF provides the following types of session-based application behavior:</span></span>  
  
- <span data-ttu-id="e8ea1-138"><xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supporta sessioni basate sulla protezione nelle quali entrambe le parti della comunicazione hanno concordato una conversazione sicura specifica.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-138">The <xref:System.ServiceModel.Channels.SecurityBindingElement?displayProperty=nameWithType> supports security-based sessions, in which both ends of communication have agreed upon a specific secure conversation.</span></span> <span data-ttu-id="e8ea1-139">Per altre informazioni, vedere [Securing Services](../../../docs/framework/wcf/securing-services.md).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-139">For more information, see [Securing Services](../../../docs/framework/wcf/securing-services.md).</span></span> <span data-ttu-id="e8ea1-140">Ad esempio, l'associazione <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> , che contiene il supporto sia per le sessioni di sicurezza sia per le sessioni affidabili, per impostazione predefinita utilizza solo una sessione protetta che esegue la crittografia e la firma digitale dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-140">For example, the <xref:System.ServiceModel.WSHttpBinding?displayProperty=nameWithType> binding, which contains support for both security sessions and reliable sessions, by default uses only a secure session that encrypts and digitally signs messages.</span></span>  
  
- <span data-ttu-id="e8ea1-141">L'associazione <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> supporta le sessioni TCP/IP per garantire che tutti i messaggi siano correlati in base alla connessione a livello di socket.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-141">The <xref:System.ServiceModel.NetTcpBinding?displayProperty=nameWithType> binding supports TCP/IP-based sessions to ensure that all messages are correlated by the connection at the socket level.</span></span>  
  
- <span data-ttu-id="e8ea1-142">L'elemento <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> , che implementa la specifica WS-ReliableMessaging, supporta le sessioni affidabili in cui i messaggi possono essere configurati per essere recapitati nell'ordine ed esattamente una volta, in modo da garantire che i messaggi siano ricevuti anche quando durante la conversazione i messaggi passano per più nodi.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-142">The <xref:System.ServiceModel.Channels.ReliableSessionBindingElement?displayProperty=nameWithType> element, which implements the WS-ReliableMessaging specification, provides support for reliable sessions in which messages can be configured to be delivered in order and exactly once, ensuring messages are received even when messages travel across multiple nodes during the conversation.</span></span> <span data-ttu-id="e8ea1-143">Per altre informazioni, vedere [sessioni affidabili](../../../docs/framework/wcf/feature-details/reliable-sessions.md).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-143">For more information, see [Reliable Sessions](../../../docs/framework/wcf/feature-details/reliable-sessions.md).</span></span>  
  
- <span data-ttu-id="e8ea1-144">L'associazione <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> fornisce sessioni di datagramma di MSMQ.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-144">The <xref:System.ServiceModel.NetMsmqBinding?displayProperty=nameWithType> binding provides MSMQ datagram sessions.</span></span> <span data-ttu-id="e8ea1-145">Per altre informazioni, vedere [code in WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-145">For more information, see [Queues in WCF](../../../docs/framework/wcf/feature-details/queues-in-wcf.md).</span></span>  
  
 <span data-ttu-id="e8ea1-146">L'impostazione della proprietà <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> non specifica il tipo di sessione richiesto dal contratto ma soltanto che il contratto ne richiede una.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-146">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not specify the type of session the contract requires, only that it requires one.</span></span>  
  
## <a name="creating-a-contract-that-requires-a-session"></a><span data-ttu-id="e8ea1-147">Creazione di un contratto che richiede una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-147">Creating a Contract That Requires a Session</span></span>  
 <span data-ttu-id="e8ea1-148">La creazione di un contratto che richiede una sessione dichiara che il gruppo di operazioni che vengono dichiarate dal contratto di servizio devono essere eseguite tutte all'interno della stessa sessione e che i messaggi devono essere recapitati nell'ordine.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-148">Creating a contract that requires a session states that the group of operations that the service contract declares must all be executed within the same session and that messages must be delivered in order.</span></span> <span data-ttu-id="e8ea1-149">Per asserire il livello di supporto della sessione richiesto da un contratto di servizio, impostare la proprietà <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> sull'interfaccia o classe del contratto di servizio sul valore dell'enumerazione <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> da specificare se il contratto:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-149">To assert the level of session support that a service contract requires, set the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A?displayProperty=nameWithType> property on your service contract interface or class to the value of the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> enumeration to specify whether the contract:</span></span>  
  
- <span data-ttu-id="e8ea1-150">Richiede una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-150">Requires a session.</span></span>  
  
- <span data-ttu-id="e8ea1-151">Consente a un client di stabilire una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-151">Allows a client to establish a session.</span></span>  
  
- <span data-ttu-id="e8ea1-152">Proibisce una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-152">Prohibits a session.</span></span>  
  
 <span data-ttu-id="e8ea1-153">L'impostazione della proprietà <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> non specifica, tuttavia, il tipo di comportamento basato sulla sessione richiesto dal contratto.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-153">Setting the <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A> property does not, however, specify the type of session-based behavior the contract requires.</span></span> <span data-ttu-id="e8ea1-154">Indica a WCF di confermare a runtime che il configurato binding (che crea il canale di comunicazione) per il servizio, non esiste o può stabilire una sessione quando si implementa un servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-154">It instructs WCF to confirm at runtime that the configured binding (which creates the communication channel) for the service does, does not, or can establish a session when implementing a service.</span></span> <span data-ttu-id="e8ea1-155">Nuovamente, l'associazione è in grado di soddisfare tale requisito con qualsiasi tipo di comportamento basato sulla sessione che sceglie: protezione, trasporto, affidabile o una combinazione di questi.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-155">Again, the binding can satisfy that requirement with any type of session-based behavior it chooses—security, transport, reliable, or some combination.</span></span> <span data-ttu-id="e8ea1-156">Il comportamento esatto dipende dal valore <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> selezionato.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-156">The exact behavior depends on the <xref:System.ServiceModel.SessionMode?displayProperty=nameWithType> value selected.</span></span> <span data-ttu-id="e8ea1-157">Se l'associazione configurata del servizio non è conforme al valore di <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, viene generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-157">If the configured binding of the service does not conform to the value of <xref:System.ServiceModel.ServiceContractAttribute.SessionMode%2A>, an exception is thrown.</span></span> <span data-ttu-id="e8ea1-158">Si dice che associazioni e i canali che creano quelle sessioni del supporto siano basato sulla sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-158">Bindings and the channels they create that support sessions are said to be session-based.</span></span>  
  
 <span data-ttu-id="e8ea1-159">Il contratto di servizio seguente specifica che tutte le operazioni in `ICalculatorSession` devono essere scambiate all'interno di una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-159">The following service contract specifies that all operations in the `ICalculatorSession` must be exchanged within a session.</span></span> <span data-ttu-id="e8ea1-160">Nessuna delle operazioni restituisce un valore al chiamante eccetto il metodo `Equals` .</span><span class="sxs-lookup"><span data-stu-id="e8ea1-160">None of the operations returns a value to the caller except the `Equals` method.</span></span> <span data-ttu-id="e8ea1-161">Tuttavia, il metodo `Equals` non prende parametri e, pertanto, può restituire solo un valore diverso da zero all'interno di una sessione nella quale i dati sono già stati passati alle altre operazioni.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-161">However, the `Equals` method takes no parameters and, therefore, can only return a non-zero value inside a session in which data has already been passed to the other operations.</span></span> <span data-ttu-id="e8ea1-162">Per un funzionamento corretto, questo contratto necessita di una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-162">This contract requires a session to function properly.</span></span> <span data-ttu-id="e8ea1-163">Senza una sessione associata a un client specifico, l'istanza del servizio non ha modo di conoscere i dati precedenti inviati da questo client.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-163">Without a session associated with a specific client, the service instance has no way of knowing what previous data this client has sent.</span></span>  
  
 [!code-csharp[S_Service_Session#1](../../../samples/snippets/csharp/VS_Snippets_CFX/s_service_session/cs/service.cs#1)]
 [!code-vb[S_Service_Session#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/s_service_session/vb/service.vb#1)]  
  
 <span data-ttu-id="e8ea1-164">Se un servizio autorizza a una sessione, allora ne viene stabilita e utilizzata se il client ne avvia una; in caso contrario, non viene stabilita alcuna sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-164">If a service allows a session, then a session is established and used if the client initiates one; otherwise, no session is established.</span></span>  
  
## <a name="sessions-and-service-instances"></a><span data-ttu-id="e8ea1-165">Sessioni e istanze del servizio</span><span class="sxs-lookup"><span data-stu-id="e8ea1-165">Sessions and Service Instances</span></span>  
 <span data-ttu-id="e8ea1-166">Se si usa il valore predefinito delle istanze di comportamento in WCF, tutte le chiamate tra un oggetto client WCF vengono gestite dalla stessa istanza del servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-166">If you use the default instancing behavior in WCF, all calls between a WCF client object are handled by the same service instance.</span></span> <span data-ttu-id="e8ea1-167">Di conseguenza, a livello di applicazione, è possibile pensare a una sessione come attivazione di un comportamento dell'applicazione simile al comportamento della chiamata locale.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-167">Therefore, at the application level, you can think of a session as enabling application behavior similar to local call behavior.</span></span> <span data-ttu-id="e8ea1-168">Ad esempio, quando si crea un oggetto locale:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-168">For example, when you create a local object:</span></span>  
  
- <span data-ttu-id="e8ea1-169">Viene chiamato un costruttore.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-169">A constructor is called.</span></span>  
  
- <span data-ttu-id="e8ea1-170">Tutte le chiamate successive eseguite al riferimento all'oggetto client WCF vengono elaborate dalla stessa istanza dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-170">All subsequent calls made to the WCF client object reference are processed by the same object instance.</span></span>  
  
- <span data-ttu-id="e8ea1-171">Viene chiamato un distruttore quando il riferimento dell'oggetto viene distrutto.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-171">A destructor is called when the object reference is destroyed.</span></span>  
  
 <span data-ttu-id="e8ea1-172">Le sessioni attivano un comportamento simile tra client e servizi finché viene utilizzato il comportamento di istanza di servizio predefinito.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-172">Sessions enable a similar behavior between clients and services as long as the default service instance behavior is used.</span></span> <span data-ttu-id="e8ea1-173">Se un contratto di servizio richiede o supporta le sessioni, è possibile contrassegnare una o più operazioni del contratto come di avvio o chiusura di una sessione impostando le proprietà <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> e <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> .</span><span class="sxs-lookup"><span data-stu-id="e8ea1-173">If a service contract requires or supports sessions, one or more contract operations can be marked as initiating or terminating a session by setting the <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A> and <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A> properties.</span></span>  
  
 <span data-ttu-id="e8ea1-174">*Operazioni di avvio* sono quelle che devono essere chiamate come prima operazione di una nuova sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-174">*Initiating operations* are those that must be called as the first operation of a new session.</span></span> <span data-ttu-id="e8ea1-175">Le operazioni non di avvio possono essere chiamate solo dopo che è stata chiamata almeno un'operazione di avvio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-175">Non-initiating operations can be called only after at least one initiating operation has been called.</span></span> <span data-ttu-id="e8ea1-176">È pertanto possibile creare qualche tipo di costruttore di sessione per il servizio dichiarando operazioni di avvio progettate per ricevere dai client input appropriato per l'inizio dell'istanza del servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-176">You can therefore create a kind of session constructor for your service by declaring initiating operations designed to take input from clients appropriate to the beginning of the service instance.</span></span> <span data-ttu-id="e8ea1-177">Tuttavia, lo stato è associato alla sessione e non all'oggetto servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-177">(The state is associated with the session, however, and not the service object.)</span></span>  
  
 <span data-ttu-id="e8ea1-178">*Operazioni di chiusura*, al contrario, sono quelle che devono essere chiamate come ultimo messaggio in una sessione esistente.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-178">*Terminating operations*, conversely, are those that must be called as the last message in an existing session.</span></span> <span data-ttu-id="e8ea1-179">Nel caso predefinito, WCF ricicla l'oggetto servizio e il relativo contesto dopo la chiusura della sessione a cui è associato il servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-179">In the default case, WCF recycles the service object and its context after the session with which the service was associated is closed.</span></span> <span data-ttu-id="e8ea1-180">È possibile, pertanto, creare un tipo di distruttore dichiarando operazioni di chiusura progettate per eseguire una funzione appropriata alla fine dell'istanza del servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-180">You can, therefore, create a kind of destructor by declaring terminating operations designed to perform a function appropriate to the end of the service instance.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e8ea1-181">Anche se il comportamento predefinito reca qualche somiglianza con costruttori e distruttori locali, si tratta solo di una somiglianza.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-181">Although the default behavior bears a resemblance to local constructors and destructors, it is only a resemblance.</span></span> <span data-ttu-id="e8ea1-182">Avvio di un'operazione di chiusura o entrambi allo stesso tempo, può essere qualsiasi operazione del servizio WCF.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-182">Any WCF service operation can be an initiating or terminating operation, or both at the same time.</span></span> <span data-ttu-id="e8ea1-183">Inoltre, nel caso predefinito, le operazioni di avvio possono essere chiamate qualsiasi numero di volte e in qualsiasi ordine; dopo che la sessione è stata stabilita e associata a un'istanza non vengono create altre sessioni a meno che non venga controllata in modo esplicito la durata dell'istanza del servizio (modificando l'oggetto <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> ).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-183">In addition, in the default case, initiating operations can be called any number of times in any order; no additional sessions are created once the session is established and associated with an instance unless you explicitly control the lifetime of the service instance (by manipulating the <xref:System.ServiceModel.InstanceContext?displayProperty=nameWithType> object).</span></span> <span data-ttu-id="e8ea1-184">Infine, lo stato viene associato alla sessione e non all'oggetto servizio.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-184">Finally, the state is associated with the session and not the service object.</span></span>  
  
 <span data-ttu-id="e8ea1-185">Ad esempio, il `ICalculatorSession` usato nell'esempio precedente il contratto richiede che il client WCF oggetto prima chiamata di `Clear` operazione prima di qualsiasi altra operazione e che la sessione con questo oggetto client WCF deve terminare quando viene chiamata la `Equals` operazione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-185">For example, the `ICalculatorSession` contract used in the preceding example requires that the WCF client object first call the `Clear` operation prior to any other operation and that the session with this WCF client object should terminate when it calls the `Equals` operation.</span></span> <span data-ttu-id="e8ea1-186">Nell'esempio di codice seguente è illustrato un contratto che applica questi requisiti.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-186">The following code example shows a contract that enforces these requirements.</span></span> <span data-ttu-id="e8ea1-187">`Clear` deve essere chiamato per primo per avviare una sessione e tale sessione termina quando viene chiamato `Equals` .</span><span class="sxs-lookup"><span data-stu-id="e8ea1-187">`Clear` must be called first to initiate a session, and that session ends when `Equals` is called.</span></span>  
  
 [!code-csharp[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/csharp/VS_Snippets_CFX/sca.isinitiatingisterminating/cs/service.cs#1)]
 [!code-vb[SCA.IsInitiatingIsTerminating#1](../../../samples/snippets/visualbasic/VS_Snippets_CFX/sca.isinitiatingisterminating/vb/service.vb#1)]  
  
 <span data-ttu-id="e8ea1-188">I servizi non avviano sessioni con i client.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-188">Services do not start sessions with clients.</span></span> <span data-ttu-id="e8ea1-189">Nelle applicazioni client WCF, esiste una relazione diretta tra la durata del canale basato sulla sessione e la durata della sessione stessa.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-189">In WCF client applications, a direct relationship exists between the lifetime of the session-based channel and the lifetime of the session itself.</span></span> <span data-ttu-id="e8ea1-190">In tal senso, i client creano nuove sessioni creando nuovi canali basati sulla sessione e chiudono le sessioni esistenti chiudendo normalmente i canali basati sulla sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-190">As such, clients create new sessions by creating new session-based channels and tear down existing sessions by closing session-based channels gracefully.</span></span> <span data-ttu-id="e8ea1-191">Un client avvia una sessione con un endpoint del servizio chiamando uno degli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-191">A client starts a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="e8ea1-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> nel canale restituito da una chiamata a <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-192"><xref:System.ServiceModel.ICommunicationObject.Open%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="e8ea1-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> nell'oggetto client WCF generato per il [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-193"><xref:System.ServiceModel.ClientBase%601.Open%2A?displayProperty=nameWithType> on the WCF client object generated by the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../../../docs/framework/wcf/servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span>  
  
- <span data-ttu-id="e8ea1-194">Un'operazione di avvio su entrambi i tipi di oggetto client WCF (per impostazione predefinita, tutte le operazioni sono di avvio).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-194">An initiating operation on either type of WCF client object (by default, all operations are initiating).</span></span> <span data-ttu-id="e8ea1-195">Quando viene chiamata la prima operazione, l'oggetto client WCF automaticamente viene aperto il canale e avvia una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-195">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="e8ea1-196">In genere, un client termina una sessione con un endpoint del servizio chiamando uno degli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="e8ea1-196">Typically a client ends a session with a service endpoint by calling one of the following:</span></span>  
  
- <span data-ttu-id="e8ea1-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> nel canale restituito da una chiamata a <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-197"><xref:System.ServiceModel.ICommunicationObject.Close%2A?displayProperty=nameWithType> on the channel returned by a call to <xref:System.ServiceModel.ChannelFactory%601.CreateChannel%2A?displayProperty=nameWithType>.</span></span>  
  
- <span data-ttu-id="e8ea1-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> nell'oggetto client WCF generato da Svcutil.exe.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-198"><xref:System.ServiceModel.ClientBase%601.Close%2A?displayProperty=nameWithType> on the WCF client object generated by Svcutil.exe.</span></span>  
  
- <span data-ttu-id="e8ea1-199">Un'operazione di chiusura su entrambi i tipi di oggetto client WCF (per impostazione predefinita, terminazione non vengono eseguita alcuna operazione, il contratto deve specificare in modo esplicito un'operazione di chiusura).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-199">A terminating operation on either type of WCF client object (by default, no operations are terminating; the contract must explicitly specify a terminating operation).</span></span> <span data-ttu-id="e8ea1-200">Quando viene chiamata la prima operazione, l'oggetto client WCF automaticamente viene aperto il canale e avvia una sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-200">When the first operation is called, the WCF client object automatically opens the channel and initiates a session.</span></span>  
  
 <span data-ttu-id="e8ea1-201">Per esempi, vedere [Procedura: Creare un Service That Requires Sessions](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) , nonché [Default Service Behavior](../../../docs/framework/wcf/samples/default-service-behavior.md) e [Instancing](../../../docs/framework/wcf/samples/instancing.md) esempi.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-201">For examples, see [How to: Create a Service That Requires Sessions](../../../docs/framework/wcf/feature-details/how-to-create-a-service-that-requires-sessions.md) as well as the [Default Service Behavior](../../../docs/framework/wcf/samples/default-service-behavior.md) and [Instancing](../../../docs/framework/wcf/samples/instancing.md) samples.</span></span>  
  
 <span data-ttu-id="e8ea1-202">Per altre informazioni sui client e le sessioni, vedere [accesso ai servizi tramite Client WCF](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-202">For more information about clients and sessions, see [Accessing Services Using a WCF Client](../../../docs/framework/wcf/feature-details/accessing-services-using-a-client.md).</span></span>  
  
## <a name="sessions-interact-with-instancecontext-settings"></a><span data-ttu-id="e8ea1-203">Sessioni che interagiscono con impostazioni InstanceContext</span><span class="sxs-lookup"><span data-stu-id="e8ea1-203">Sessions Interact with InstanceContext Settings</span></span>  
 <span data-ttu-id="e8ea1-204">Esiste un'interazione tra l'enumerazione <xref:System.ServiceModel.SessionMode> in un contratto e la proprietà <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> , che consente di controllare l'associazione tra canali e oggetti servizio specifici.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-204">There is an interaction between the <xref:System.ServiceModel.SessionMode> enumeration in a contract and the <xref:System.ServiceModel.ServiceBehaviorAttribute.InstanceContextMode%2A?displayProperty=nameWithType> property, which controls the association between channels and specific service objects.</span></span> <span data-ttu-id="e8ea1-205">Per altre informazioni, vedere [sessioni, relativo alle istanze e concorrenza](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).</span><span class="sxs-lookup"><span data-stu-id="e8ea1-205">For more information, see [Sessions, Instancing, and Concurrency](../../../docs/framework/wcf/feature-details/sessions-instancing-and-concurrency.md).</span></span>  
  
### <a name="sharing-instancecontext-objects"></a><span data-ttu-id="e8ea1-206">Condivisione di oggetti InstanceContext</span><span class="sxs-lookup"><span data-stu-id="e8ea1-206">Sharing InstanceContext Objects</span></span>  
 <span data-ttu-id="e8ea1-207">È inoltre possibile controllare l'associazione tra canali basati sulla sessione o chiamate con sessione e oggetti <xref:System.ServiceModel.InstanceContext> eseguendo quell'associazione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-207">You can also control which session-based channel or call is associated with which <xref:System.ServiceModel.InstanceContext> object by performing that association yourself.</span></span> 
  
## <a name="sessions-and-streaming"></a><span data-ttu-id="e8ea1-208">Sessioni e flusso</span><span class="sxs-lookup"><span data-stu-id="e8ea1-208">Sessions and Streaming</span></span>  
 <span data-ttu-id="e8ea1-209">Quando si dispone di una grande quantità di dati da trasferire, la modalità di trasferimento streaming in WCF è un'alternativa praticabile al comportamento predefinito di memorizzazione nel buffer e l'elaborazione dei messaggi in memoria nella loro interezza.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-209">When you have a large amount of data to transfer, the streaming transfer mode in WCF is a feasible alternative to the default behavior of buffering and processing messages in memory in their entirety.</span></span> <span data-ttu-id="e8ea1-210">È possibile ricevere un comportamento imprevisto quando viene eseguito il flusso delle chiamate con un'associazione basata sulla sessione.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-210">You may get unexpected behavior when streaming calls with a session-based binding.</span></span> <span data-ttu-id="e8ea1-211">Tutte le chiamate del flusso sono eseguite tramite un solo canale (il canale del datagramma) che non supporta sessioni anche se l'associazione utilizzata è configurata per utilizzare sessioni.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-211">All streaming calls are made through a single channel (the datagram channel) that does not support sessions even if the binding being used is configured to use sessions.</span></span> <span data-ttu-id="e8ea1-212">Se più client effettuano un flusso di chiamate allo stesso oggetto servizio con un'associazione basata sulla sessione, la modalità di concorrenza dell'oggetto servizio è impostata su Single e la modalità di contesto dell'istanza è impostata su `PerSession`, tutte le chiamate devono transitare attraverso il canale del datagramma, pertanto viene elaborata una sola chiamata alla volta.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-212">If multiple clients make streaming calls to the same service object over a session-based binding, and the service object's concurrency mode is set to single and its instance context mode is set to `PerSession`, all calls must go through the datagram channel and so only one call is processed at a time.</span></span> <span data-ttu-id="e8ea1-213">Uno o più client possono quindi scadere. È possibile risolvere questo problema impostando `InstanceContextMode` dell'oggetto servizio su `PerCall` o Concurrency su Multiple.</span><span class="sxs-lookup"><span data-stu-id="e8ea1-213">One or more clients may then time out. You can work around this issue by either setting the service object's `InstanceContextMode` to `PerCall` or Concurrency to multiple.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="e8ea1-214">In questo caso, MaxConcurrentSessions non produce alcun effetto perché è disponibile una sola "sessione".</span><span class="sxs-lookup"><span data-stu-id="e8ea1-214">MaxConcurrentSessions have no effect in this case because there is only one "session" available.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e8ea1-215">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="e8ea1-215">See also</span></span>

- <xref:System.ServiceModel.OperationContractAttribute.IsInitiating%2A>
- <xref:System.ServiceModel.OperationContractAttribute.IsTerminating%2A>
