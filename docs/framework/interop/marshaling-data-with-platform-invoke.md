---
title: Marshalling dei dati con platform invoke
ms.date: 03/20/2019
dev_langs:
- cpp
helpviewer_keywords:
- platform invoke, marshaling data
- data marshaling, platform invoke
- marshaling, platform invoke
ms.assetid: dc5c76cf-7b12-406f-b79c-d1a023ec245d
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 396dc1dec60a6a984f9ddd0b8a8753b7293a5ab9
ms.sourcegitcommit: 77854e8704b9689b73103d691db34d71c2bf1dad
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 03/21/2019
ms.locfileid: "58307863"
---
# <a name="marshaling-data-with-platform-invoke"></a><span data-ttu-id="4cbcc-102">Marshalling dei dati con platform invoke</span><span class="sxs-lookup"><span data-stu-id="4cbcc-102">Marshaling Data with Platform Invoke</span></span>

<span data-ttu-id="4cbcc-103">Per chiamare le funzioni esportate da una libreria non gestita, un'applicazione .NET Framework richiede un prototipo di funzione nel codice gestito che rappresenta la funzione non gestita.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-103">To call functions exported from an unmanaged library, a .NET Framework application requires a function prototype in managed code that represents the unmanaged function.</span></span> <span data-ttu-id="4cbcc-104">Per creare un prototipo che abiliti PInvoke per effettuare il marshalling dei dati in modo corretto, è necessario eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="4cbcc-104">To create a prototype that enables platform invoke to marshal data correctly, you must do the following:</span></span>

- <span data-ttu-id="4cbcc-105">Applicare l'attributo <xref:System.Runtime.InteropServices.DllImportAttribute> alla funzione o al metodo statico nel codice gestito.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-105">Apply the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute to the static function or method in managed code.</span></span>

- <span data-ttu-id="4cbcc-106">Sostituire i tipi di dati non gestiti con tipi di dati gestiti.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-106">Substitute managed data types for unmanaged data types.</span></span>

<span data-ttu-id="4cbcc-107">È possibile usare la documentazione fornita con una funzione non gestita per costruire un prototipo gestito equivalente, applicando l'attributo con i relativi campi facoltativi e sostituendo i tipi di dati non gestiti con quelli gestiti.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-107">You can use the documentation supplied with an unmanaged function to construct an equivalent managed prototype by applying the attribute with its optional fields and substituting managed data types for unmanaged types.</span></span> <span data-ttu-id="4cbcc-108">Per istruzioni su come applicare l'attributo **DllImportAttribute**, vedere [Utilizzo di funzioni DLL non gestite](../../../docs/framework/interop/consuming-unmanaged-dll-functions.md).</span><span class="sxs-lookup"><span data-stu-id="4cbcc-108">For instructions about how to apply the **DllImportAttribute**, see [Consuming Unmanaged DLL Functions](../../../docs/framework/interop/consuming-unmanaged-dll-functions.md).</span></span>

<span data-ttu-id="4cbcc-109">Questa sezione fornisce esempi che dimostrano come creare prototipi di funzioni gestite per passare argomenti e ricevere valori restituiti da funzioni esportate mediante librerie non gestite.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-109">This section provides samples that demonstrate how to create managed function prototypes for passing arguments to and receiving return values from functions exported by unmanaged libraries.</span></span> <span data-ttu-id="4cbcc-110">Gli esempi illustrano anche l'uso dell'attributo <xref:System.Runtime.InteropServices.MarshalAsAttribute> e della classe <xref:System.Runtime.InteropServices.Marshal> per effettuare il marshalling esplicito dei dati.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-110">The samples also demonstrate when to use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute and the <xref:System.Runtime.InteropServices.Marshal> class to explicitly marshal data.</span></span>

## <a name="platform-invoke-data-types"></a><span data-ttu-id="4cbcc-111">Tipi di dati PInvoke</span><span class="sxs-lookup"><span data-stu-id="4cbcc-111">Platform invoke data types</span></span>

<span data-ttu-id="4cbcc-112">La tabella seguente include un elenco di tipi di dati usati nell'API Win32 (elencati in Wtypes.h) e nelle funzioni di tipo C.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-112">The following table lists data types used in the Win32 API (listed in Wtypes.h) and C-style functions.</span></span> <span data-ttu-id="4cbcc-113">Molte librerie non gestite contengono funzioni che passano questi tipi di dati come parametri e valori restituiti.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-113">Many unmanaged libraries contain functions that pass these data types as parameters and return values.</span></span> <span data-ttu-id="4cbcc-114">La terza colonna indica il tipo di valore o la classe incorporata corrispondente di .NET Framework che si usa nel codice gestito.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-114">The third column lists the corresponding .NET Framework built-in value type or class that you use in managed code.</span></span> <span data-ttu-id="4cbcc-115">In alcuni casi, è possibile sostituire il tipo elencato nella tabella con un tipo delle stesse dimensioni.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-115">In some cases, you can substitute a type of the same size for the type listed in the table.</span></span>

|<span data-ttu-id="4cbcc-116">Tipo non gestito in Wtypes.h</span><span class="sxs-lookup"><span data-stu-id="4cbcc-116">Unmanaged type in Wtypes.h</span></span>|<span data-ttu-id="4cbcc-117">Tipo non gestito del linguaggio C</span><span class="sxs-lookup"><span data-stu-id="4cbcc-117">Unmanaged C language type</span></span>|<span data-ttu-id="4cbcc-118">Nome del tipo gestito</span><span class="sxs-lookup"><span data-stu-id="4cbcc-118">Managed type name</span></span>|<span data-ttu-id="4cbcc-119">Description</span><span class="sxs-lookup"><span data-stu-id="4cbcc-119">Description</span></span>|
|--------------------------------|-------------------------------|------------------------|-----------------|
|<span data-ttu-id="4cbcc-120">**VOID**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-120">**VOID**</span></span>|<span data-ttu-id="4cbcc-121">**void**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-121">**void**</span></span>|<xref:System.Void?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-122">Applicato a una funzione che non restituisce un valore.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-122">Applied to a function that does not return a value.</span></span>|
|<span data-ttu-id="4cbcc-123">**HANDLE**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-123">**HANDLE**</span></span>|<span data-ttu-id="4cbcc-124">**void \***</span><span class="sxs-lookup"><span data-stu-id="4cbcc-124">**void \***</span></span>|<span data-ttu-id="4cbcc-125"><xref:System.IntPtr?displayProperty=nameWithType> o <xref:System.UIntPtr?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4cbcc-125"><xref:System.IntPtr?displayProperty=nameWithType> or <xref:System.UIntPtr?displayProperty=nameWithType></span></span>|<span data-ttu-id="4cbcc-126">32 bit nei sistemi operativi Windows a 32 bit, 64 bit nei sistemi operativi Windows a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-126">32 bits on 32-bit Windows operating systems, 64 bits on 64-bit Windows operating systems.</span></span>|
|<span data-ttu-id="4cbcc-127">**BYTE**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-127">**BYTE**</span></span>|<span data-ttu-id="4cbcc-128">**unsigned char**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-128">**unsigned char**</span></span>|<xref:System.Byte?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-129">8 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-129">8 bits</span></span>|
|<span data-ttu-id="4cbcc-130">**SHORT**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-130">**SHORT**</span></span>|<span data-ttu-id="4cbcc-131">**short**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-131">**short**</span></span>|<xref:System.Int16?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-132">16 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-132">16 bits</span></span>|
|<span data-ttu-id="4cbcc-133">**WORD**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-133">**WORD**</span></span>|<span data-ttu-id="4cbcc-134">**unsigned short**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-134">**unsigned short**</span></span>|<xref:System.UInt16?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-135">16 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-135">16 bits</span></span>|
|<span data-ttu-id="4cbcc-136">**INT**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-136">**INT**</span></span>|<span data-ttu-id="4cbcc-137">**int**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-137">**int**</span></span>|<xref:System.Int32?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-138">32 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-138">32 bits</span></span>|
|<span data-ttu-id="4cbcc-139">**UINT**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-139">**UINT**</span></span>|<span data-ttu-id="4cbcc-140">**unsigned int**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-140">**unsigned int**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-141">32 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-141">32 bits</span></span>|
|<span data-ttu-id="4cbcc-142">**LONG**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-142">**LONG**</span></span>|<span data-ttu-id="4cbcc-143">**long**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-143">**long**</span></span>|<xref:System.Int32?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-144">32 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-144">32 bits</span></span>|
|<span data-ttu-id="4cbcc-145">**BOOL**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-145">**BOOL**</span></span>|<span data-ttu-id="4cbcc-146">**long**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-146">**long**</span></span>|<span data-ttu-id="4cbcc-147"><xref:System.Boolean?displayProperty=nameWithType> o <xref:System.Int32?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4cbcc-147"><xref:System.Boolean?displayProperty=nameWithType> or <xref:System.Int32?displayProperty=nameWithType></span></span>|<span data-ttu-id="4cbcc-148">32 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-148">32 bits</span></span>|
|<span data-ttu-id="4cbcc-149">**DWORD**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-149">**DWORD**</span></span>|<span data-ttu-id="4cbcc-150">**unsigned long**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-150">**unsigned long**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-151">32 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-151">32 bits</span></span>|
|<span data-ttu-id="4cbcc-152">**ULONG**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-152">**ULONG**</span></span>|<span data-ttu-id="4cbcc-153">**unsigned long**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-153">**unsigned long**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-154">32 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-154">32 bits</span></span>|
|<span data-ttu-id="4cbcc-155">**CHAR**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-155">**CHAR**</span></span>|<span data-ttu-id="4cbcc-156">**char**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-156">**char**</span></span>|<xref:System.Char?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-157">Decorare con ANSI.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-157">Decorate with ANSI.</span></span>|
|<span data-ttu-id="4cbcc-158">**WCHAR**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-158">**WCHAR**</span></span>|<span data-ttu-id="4cbcc-159">**wchar_t**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-159">**wchar_t**</span></span>|<xref:System.Char?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-160">Decorare con Unicode.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-160">Decorate with Unicode.</span></span>|
|<span data-ttu-id="4cbcc-161">**LPSTR**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-161">**LPSTR**</span></span>|<span data-ttu-id="4cbcc-162">**char &ast;**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-162">**char &ast;**</span></span>|<span data-ttu-id="4cbcc-163"><xref:System.String?displayProperty=nameWithType> o <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4cbcc-163"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="4cbcc-164">Decorare con ANSI.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-164">Decorate with ANSI.</span></span>|
|<span data-ttu-id="4cbcc-165">**LPCSTR**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-165">**LPCSTR**</span></span>|<span data-ttu-id="4cbcc-166">**const char &ast;**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-166">**const char &ast;**</span></span>|<span data-ttu-id="4cbcc-167"><xref:System.String?displayProperty=nameWithType> o <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4cbcc-167"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="4cbcc-168">Decorare con ANSI.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-168">Decorate with ANSI.</span></span>|
|<span data-ttu-id="4cbcc-169">**LPWSTR**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-169">**LPWSTR**</span></span>|<span data-ttu-id="4cbcc-170">**wchar_t &ast;**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-170">**wchar_t &ast;**</span></span>|<span data-ttu-id="4cbcc-171"><xref:System.String?displayProperty=nameWithType> o <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4cbcc-171"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="4cbcc-172">Decorare con Unicode.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-172">Decorate with Unicode.</span></span>|
|<span data-ttu-id="4cbcc-173">**LPCWSTR**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-173">**LPCWSTR**</span></span>|<span data-ttu-id="4cbcc-174">**const wchar_t &ast;**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-174">**const wchar_t &ast;**</span></span>|<span data-ttu-id="4cbcc-175"><xref:System.String?displayProperty=nameWithType> o <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4cbcc-175"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="4cbcc-176">Decorare con Unicode.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-176">Decorate with Unicode.</span></span>|
|<span data-ttu-id="4cbcc-177">**FLOAT**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-177">**FLOAT**</span></span>|<span data-ttu-id="4cbcc-178">**float**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-178">**float**</span></span>|<xref:System.Single?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-179">32 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-179">32 bits</span></span>|
|<span data-ttu-id="4cbcc-180">**DOUBLE**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-180">**DOUBLE**</span></span>|<span data-ttu-id="4cbcc-181">**double**</span><span class="sxs-lookup"><span data-stu-id="4cbcc-181">**double**</span></span>|<xref:System.Double?displayProperty=nameWithType>|<span data-ttu-id="4cbcc-182">64 bit</span><span class="sxs-lookup"><span data-stu-id="4cbcc-182">64 bits</span></span>|

<span data-ttu-id="4cbcc-183">Per i tipi corrispondenti in [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)], C# e C++, vedere [Introduzione alla libreria di classi .NET Framework](../../../docs/standard/class-library-overview.md).</span><span class="sxs-lookup"><span data-stu-id="4cbcc-183">For corresponding types in [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)], C#, and C++, see the [Introduction to the .NET Framework Class Library](../../../docs/standard/class-library-overview.md).</span></span>

## <a name="pinvokelibdll"></a><span data-ttu-id="4cbcc-184">PinvokeLib.dll</span><span class="sxs-lookup"><span data-stu-id="4cbcc-184">PinvokeLib.dll</span></span>

<span data-ttu-id="4cbcc-185">Il codice seguente definisce le funzioni della libreria fornite da Pinvoke.dll.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-185">The following code defines the library functions provided by Pinvoke.dll.</span></span> <span data-ttu-id="4cbcc-186">Molti esempi descritti in questa sezione chiamano questa libreria.</span><span class="sxs-lookup"><span data-stu-id="4cbcc-186">Many samples described in this section call this library.</span></span>

### <a name="example"></a><span data-ttu-id="4cbcc-187">Esempio</span><span class="sxs-lookup"><span data-stu-id="4cbcc-187">Example</span></span>

[!code-cpp[PInvokeLib#1](../../../samples/snippets/cpp/VS_Snippets_CLR/pinvokelib/cpp/pinvokelib.cpp#1)]

[!code-cpp[PInvokeLib#2](../../../samples/snippets/cpp/VS_Snippets_CLR/pinvokelib/cpp/pinvokelib.h#2)]
