---
title: Flussi di lavoro asincroni (F#)
description: Informazioni sul supporto in F# linguaggio di programmazione per l'esecuzione di calcoli in modo asincrono, in cui vengono eseguiti senza bloccare l'esecuzione di altre operazioni.
ms.date: 05/16/2016
ms.openlocfilehash: 2a6d5f8b61d63a722744f8f71a037e8bc460c64f
ms.sourcegitcommit: db8b83057d052c1f9f249d128b08d4423af0f7c2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/02/2018
ms.locfileid: "43861562"
---
# <a name="asynchronous-workflows"></a><span data-ttu-id="607e3-103">Flussi di lavoro asincroni</span><span class="sxs-lookup"><span data-stu-id="607e3-103">Asynchronous Workflows</span></span>

> [!NOTE]
<span data-ttu-id="607e3-104">Il collegamento al riferimento per l'API porta a MSDN.</span><span class="sxs-lookup"><span data-stu-id="607e3-104">The API reference link will take you to MSDN.</span></span>  <span data-ttu-id="607e3-105">Il riferimento all'API in Microsoft Docs (docs.microsoft.com) non è completo.</span><span class="sxs-lookup"><span data-stu-id="607e3-105">The docs.microsoft.com API reference is not complete.</span></span>

<span data-ttu-id="607e3-106">In questo argomento viene descritto il supporto in F# per l'esecuzione di calcoli in modo asincrono, vale a dire, senza bloccare l'esecuzione di altre operazioni.</span><span class="sxs-lookup"><span data-stu-id="607e3-106">This topic describes support in F# for performing computations asynchronously, that is, without blocking execution of other work.</span></span> <span data-ttu-id="607e3-107">Ad esempio, i calcoli asincroni utilizzabile per scrivere applicazioni che dispongono di interfacce utente rimangano attive per gli utenti come l'applicazione viene eseguito altro lavoro.</span><span class="sxs-lookup"><span data-stu-id="607e3-107">For example, asynchronous computations can be used to write applications that have UIs that remain responsive to users as the application performs other work.</span></span>

## <a name="syntax"></a><span data-ttu-id="607e3-108">Sintassi</span><span class="sxs-lookup"><span data-stu-id="607e3-108">Syntax</span></span>

```fsharp
async { expression }
```

## <a name="remarks"></a><span data-ttu-id="607e3-109">Note</span><span class="sxs-lookup"><span data-stu-id="607e3-109">Remarks</span></span>

<span data-ttu-id="607e3-110">Nella sintassi precedente, il calcolo rappresentato da `expression` è configurato per eseguire in modo asincrono, vale a dire, senza bloccare il thread corrente di calcolo quando vengono eseguite le operazioni di sospensione asincrona, i/o e altre operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="607e3-110">In the previous syntax, the computation represented by `expression` is set up to run asynchronously, that is, without blocking the current computation thread when asynchronous sleep operations, I/O, and other asynchronous operations are performed.</span></span> <span data-ttu-id="607e3-111">I calcoli asincroni sono spesso avviati in un thread in background mentre l'esecuzione continua sul thread corrente.</span><span class="sxs-lookup"><span data-stu-id="607e3-111">Asynchronous computations are often started on a background thread while execution continues on the current thread.</span></span> <span data-ttu-id="607e3-112">Il tipo dell'espressione è `Async<'T>`, dove `'T` è il tipo restituito dall'espressione quando il `return` parola chiave viene usata.</span><span class="sxs-lookup"><span data-stu-id="607e3-112">The type of the expression is `Async<'T>`, where `'T` is the type returned by the expression when the `return` keyword is used.</span></span> <span data-ttu-id="607e3-113">Il codice in un'espressione di questo tipo è detta un' *blocco asincrono*, o *blocco async*.</span><span class="sxs-lookup"><span data-stu-id="607e3-113">The code in such an expression is referred to as an *asynchronous block*, or *async block*.</span></span>

<span data-ttu-id="607e3-114">Esistono diversi modi di programmazione in modo asincrono e il [ `Async` ](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) classe fornisce metodi che supportano diversi scenari.</span><span class="sxs-lookup"><span data-stu-id="607e3-114">There are a variety of ways of programming asynchronously, and the [`Async`](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) class provides methods that support several scenarios.</span></span> <span data-ttu-id="607e3-115">L'approccio generale consiste nel creare `Async` gli oggetti che rappresentano il calcolo o i calcoli che si desidera eseguire in modo asincrono e quindi avviare questi calcoli utilizzando una delle funzioni di attivazione.</span><span class="sxs-lookup"><span data-stu-id="607e3-115">The general approach is to create `Async` objects that represent the computation or computations that you want to run asynchronously, and then start these computations by using one of the triggering functions.</span></span> <span data-ttu-id="607e3-116">Le varie funzioni di attivazione forniscono diversi metodi per eseguire i calcoli asincroni e il metodo scelto dipende dalla necessità di usare il thread corrente, un thread in background o un oggetto di attività di .NET Framework, e se vi sono continuazione funzioni che deve essere eseguito quando il calcolo venga completato.</span><span class="sxs-lookup"><span data-stu-id="607e3-116">The various triggering functions provide different ways of running asynchronous computations, and which one you use depends on whether you want to use the current thread, a background thread, or a .NET Framework task object, and whether there are continuation functions that should run when the computation finishes.</span></span> <span data-ttu-id="607e3-117">Per avviare un calcolo asincrono nel thread corrente, ad esempio, è possibile usare [ `Async.StartImmediate` ](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span><span class="sxs-lookup"><span data-stu-id="607e3-117">For example, to start an asynchronous computation on the current thread, you can use [`Async.StartImmediate`](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span></span> <span data-ttu-id="607e3-118">Quando si avvia un calcolo asincrono da thread dell'interfaccia utente, non bloccare il ciclo di eventi principali che elabora le azioni utente, ad esempio le sequenze di tasti e attività del mouse, in modo che l'applicazione rimanga reattiva.</span><span class="sxs-lookup"><span data-stu-id="607e3-118">When you start an asynchronous computation from the UI thread, you do not block the main event loop that processes user actions such as keystrokes and mouse activity, so your application remains responsive.</span></span>

## <a name="asynchronous-binding-by-using-let"></a><span data-ttu-id="607e3-119">Associazione asincrona usando let!</span><span class="sxs-lookup"><span data-stu-id="607e3-119">Asynchronous Binding by Using let!</span></span>

<span data-ttu-id="607e3-120">In un flusso di lavoro asincrono, alcune operazioni e le espressioni sono sincrone e alcuni sono più lunghi calcoli che sono progettati per restituire un risultato in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="607e3-120">In an asynchronous workflow, some expressions and operations are synchronous, and some are longer computations that are designed to return a result asynchronously.</span></span> <span data-ttu-id="607e3-121">Quando si chiama un metodo in modo asincrono, invece di un normale `let` associazione, utilizzare `let!`.</span><span class="sxs-lookup"><span data-stu-id="607e3-121">When you call a method asynchronously, instead of an ordinary `let` binding, you use `let!`.</span></span> <span data-ttu-id="607e3-122">L'effetto di `let!` consiste nell'abilitare l'esecuzione di continuare in altri calcoli o thread perché è in corso il calcolo.</span><span class="sxs-lookup"><span data-stu-id="607e3-122">The effect of `let!` is to enable execution to continue on other computations or threads as the computation is being performed.</span></span> <span data-ttu-id="607e3-123">Dopo che il lato destro del `let!` associazione termina, il resto del flusso di lavoro asincrono riprende l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="607e3-123">After the right side of the `let!` binding returns, the rest of the asynchronous workflow resumes execution.</span></span>

<span data-ttu-id="607e3-124">Il codice seguente illustra la differenza tra `let` e `let!`.</span><span class="sxs-lookup"><span data-stu-id="607e3-124">The following code shows the difference between `let` and `let!`.</span></span> <span data-ttu-id="607e3-125">La riga di codice che usa `let` appena creato un calcolo asincrono come un oggetto che è possibile eseguire in un secondo momento usando, ad esempio, `Async.StartImmediate` oppure [ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span><span class="sxs-lookup"><span data-stu-id="607e3-125">The line of code that uses `let` just creates an asynchronous computation as an object that you can run later by using, for example, `Async.StartImmediate` or [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span></span> <span data-ttu-id="607e3-126">La riga di codice che usa `let!` avvia il calcolo e quindi il thread viene sospeso fino a quando il risultato è disponibile, in quale punto di esecuzione continua.</span><span class="sxs-lookup"><span data-stu-id="607e3-126">The line of code that uses `let!` starts the computation, and then the thread is suspended until the result is available, at which point execution continues.</span></span>

```fsharp
// let just stores the result as an asynchronous operation.
let (result1 : Async<byte[]>) = stream.AsyncRead(bufferSize)
// let! completes the asynchronous operation and returns the data.
let! (result2 : byte[])  = stream.AsyncRead(bufferSize)
```

<span data-ttu-id="607e3-127">Oltre a `let!`, è possibile usare `use!` eseguire associazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="607e3-127">In addition to `let!`, you can use `use!` to perform asynchronous bindings.</span></span> <span data-ttu-id="607e3-128">La differenza tra `let!` e `use!` equivale alla differenza tra `let` e `use`.</span><span class="sxs-lookup"><span data-stu-id="607e3-128">The difference between `let!` and `use!` is the same as the difference between `let` and `use`.</span></span> <span data-ttu-id="607e3-129">Per `use!`, l'oggetto viene eliminato alla chiusura dell'ambito corrente.</span><span class="sxs-lookup"><span data-stu-id="607e3-129">For `use!`, the object is disposed of at the close of the current scope.</span></span> <span data-ttu-id="607e3-130">Si noti che nella versione corrente del linguaggio F# `use!` non è consentito un valore essere inizializzato su null, anche se `use` viene.</span><span class="sxs-lookup"><span data-stu-id="607e3-130">Note that in the current release of the F# language, `use!` does not allow a value to be initialized to null, even though `use` does.</span></span>

## <a name="asynchronous-primitives"></a><span data-ttu-id="607e3-131">Primitivi asincroni</span><span class="sxs-lookup"><span data-stu-id="607e3-131">Asynchronous Primitives</span></span>

<span data-ttu-id="607e3-132">Viene chiamato un metodo che esegue una singola attività asincrona e restituisce il risultato un' *primitiva asincrona*, e queste sono progettate specificamente per l'uso con `let!`.</span><span class="sxs-lookup"><span data-stu-id="607e3-132">A method that performs a single asynchronous task and returns the result is called an *asynchronous primitive*, and these are designed specifically for use with `let!`.</span></span> <span data-ttu-id="607e3-133">Diversi primitivi asincroni sono definiti nella libreria di base F#.</span><span class="sxs-lookup"><span data-stu-id="607e3-133">Several asynchronous primitives are defined in the F# core library.</span></span> <span data-ttu-id="607e3-134">Questi due diversi metodi per le applicazioni Web sono definiti nel modulo [ `Microsoft.FSharp.Control.WebExtensions` ](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [ `WebRequest.AsyncGetResponse` ](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) e [ `WebClient.AsyncDownloadString` ](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span><span class="sxs-lookup"><span data-stu-id="607e3-134">Two such methods for Web applications are defined in the module [`Microsoft.FSharp.Control.WebExtensions`](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [`WebRequest.AsyncGetResponse`](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) and [`WebClient.AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span></span> <span data-ttu-id="607e3-135">Entrambe le primitive di scaricano i dati da una pagina Web, data un URL.</span><span class="sxs-lookup"><span data-stu-id="607e3-135">Both primitives download data from a Web page, given a URL.</span></span> <span data-ttu-id="607e3-136">`AsyncGetResponse` Genera una `System.Net.WebResponse` oggetti, e `AsyncDownloadString` produce una stringa che rappresenta il codice HTML per una pagina Web.</span><span class="sxs-lookup"><span data-stu-id="607e3-136">`AsyncGetResponse` produces a `System.Net.WebResponse` object, and `AsyncDownloadString` produces a string that represents the HTML for a Web page.</span></span>

<span data-ttu-id="607e3-137">Sono inclusi diversi primitivi per le operazioni dei / o asincrone nel [ `Microsoft.FSharp.Control.CommonExtensions` ](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) modulo.</span><span class="sxs-lookup"><span data-stu-id="607e3-137">Several primitives for asynchronous I/O operations are included in the [`Microsoft.FSharp.Control.CommonExtensions`](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) module.</span></span> <span data-ttu-id="607e3-138">Questi metodi di estensione del `System.IO.Stream` classe vengono [ `Stream.AsyncRead` ](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) e [ `Stream.AsyncWrite` ](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span><span class="sxs-lookup"><span data-stu-id="607e3-138">These extension methods of the `System.IO.Stream` class are [`Stream.AsyncRead`](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) and [`Stream.AsyncWrite`](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span></span>

<span data-ttu-id="607e3-139">È anche possibile scrivere i proprio primitivi asincroni mediante la definizione di una funzione il cui corpo completo è racchiuso in un blocco asincrono.</span><span class="sxs-lookup"><span data-stu-id="607e3-139">You can also write your own asynchronous primitives by defining a function whose complete body is enclosed in an async block.</span></span>

<span data-ttu-id="607e3-140">Per usare i metodi asincroni in .NET Framework sono progettati per altri modelli asincroni con F# modello di programmazione asincrono, si crea una funzione che restituisce un F# `Async` oggetto.</span><span class="sxs-lookup"><span data-stu-id="607e3-140">To use asynchronous methods in the .NET Framework that are designed for other asynchronous models with the F# asynchronous programming model, you create a function that returns an F# `Async` object.</span></span> <span data-ttu-id="607e3-141">La libreria F# contiene funzioni che rendono questa operazione semplice.</span><span class="sxs-lookup"><span data-stu-id="607e3-141">The F# library has functions that make this easy to do.</span></span>

<span data-ttu-id="607e3-142">Un esempio dell'uso di flussi di lavoro asincroni è incluso in questo contesto. sono disponibili numerosi altri nella documentazione per i metodi del [Async (classe)](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span><span class="sxs-lookup"><span data-stu-id="607e3-142">One example of using asynchronous workflows is included here; there are many others in the documentation for the methods of the [Async class](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span></span>

<span data-ttu-id="607e3-143">In questo esempio viene illustrato come utilizzare i flussi di lavoro asincroni per eseguire calcoli in parallelo.</span><span class="sxs-lookup"><span data-stu-id="607e3-143">This example shows how to use asynchronous workflows to perform computations in parallel.</span></span>

<span data-ttu-id="607e3-144">Nell'esempio di codice seguente, una funzione `fetchAsync` Ottiene il testo HTML restituito da una richiesta Web.</span><span class="sxs-lookup"><span data-stu-id="607e3-144">In the following code example, a function `fetchAsync` gets the HTML text returned from a Web request.</span></span> <span data-ttu-id="607e3-145">Il `fetchAsync` funzione contiene un blocco di codice asincrono.</span><span class="sxs-lookup"><span data-stu-id="607e3-145">The `fetchAsync` function contains an asynchronous block of code.</span></span> <span data-ttu-id="607e3-146">Quando viene eseguita un'associazione al risultato di una primitiva asincrona, in questo caso [ `AsyncDownloadString` ](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), let!</span><span class="sxs-lookup"><span data-stu-id="607e3-146">When a binding is made to the result of an asynchronous primitive, in this case [`AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), let!</span></span> <span data-ttu-id="607e3-147">anziché let viene utilizzato.</span><span class="sxs-lookup"><span data-stu-id="607e3-147">is used instead of let.</span></span>

<span data-ttu-id="607e3-148">Si utilizza la funzione [ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) per eseguire un'operazione asincrona e attenderne il risultato.</span><span class="sxs-lookup"><span data-stu-id="607e3-148">You use the function [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) to execute an asynchronous operation and wait for its result.</span></span> <span data-ttu-id="607e3-149">Ad esempio, è possibile eseguire più operazioni asincrone in parallelo usando la [ `Async.Parallel` ](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) insieme alla funzione il `Async.RunSynchronously` (funzione).</span><span class="sxs-lookup"><span data-stu-id="607e3-149">As an example, you can execute multiple asynchronous operations in parallel by using the [`Async.Parallel`](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) function together with the `Async.RunSynchronously` function.</span></span> <span data-ttu-id="607e3-150">Il `Async.Parallel` funzione accetta un elenco del `Async` gli oggetti, imposta il codice per ogni `Async` oggetto attività da eseguire in parallelo e restituisce un `Async` oggetto che rappresenta il calcolo parallelo.</span><span class="sxs-lookup"><span data-stu-id="607e3-150">The `Async.Parallel` function takes a list of the `Async` objects, sets up the code for each `Async` task object to run in parallel, and returns an `Async` object that represents the parallel computation.</span></span> <span data-ttu-id="607e3-151">Come per una singola operazione, si chiama `Async.RunSynchronously` per avviare l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="607e3-151">Just as for a single operation, you call `Async.RunSynchronously` to start the execution.</span></span>

<span data-ttu-id="607e3-152">Il `runAll` funzione avvia tre flussi di lavoro asincroni in parallelo e attende fino a quando non vengono tutti completati.</span><span class="sxs-lookup"><span data-stu-id="607e3-152">The `runAll` function launches three asynchronous workflows in parallel and waits until they have all completed.</span></span>

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet8003.fs)]

## <a name="see-also"></a><span data-ttu-id="607e3-153">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="607e3-153">See also</span></span>

- [<span data-ttu-id="607e3-154">Riferimenti per il linguaggio F#</span><span class="sxs-lookup"><span data-stu-id="607e3-154">F# Language Reference</span></span>](index.md)
- [<span data-ttu-id="607e3-155">Espressioni di calcolo</span><span class="sxs-lookup"><span data-stu-id="607e3-155">Computation Expressions</span></span>](computation-expressions.md)
- [<span data-ttu-id="607e3-156">Classe Control. Async</span><span class="sxs-lookup"><span data-stu-id="607e3-156">Control.Async Class</span></span>](https://msdn.microsoft.com/visualfsharpdocs/conceptual/control.async-class-%5bfsharp%5d)
