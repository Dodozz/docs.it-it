---
title: await - Riferimenti per C#
ms.custom: seodec18
ms.date: 05/22/2017
f1_keywords:
- await_CSharpKeyword
helpviewer_keywords:
- await keyword [C#]
- await [C#]
ms.assetid: 50725c24-ac76-4ca7-bca1-dd57642ffedb
ms.openlocfilehash: 91d76309fedb2a6f3d877a47f230fda74060107e
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 04/08/2019
ms.locfileid: "59122889"
---
# <a name="await-c-reference"></a><span data-ttu-id="a672a-102">await (Riferimenti per C#)</span><span class="sxs-lookup"><span data-stu-id="a672a-102">await (C# Reference)</span></span>
<span data-ttu-id="a672a-103">L'operatore `await` viene applicato a un'attività in un metodo asincrono per inserire un punto di sospensione nell'esecuzione del metodo fino al completamento dell'attività di cui si è in attesa.</span><span class="sxs-lookup"><span data-stu-id="a672a-103">The `await` operator is applied to a task in an asynchronous method to insert a suspension point in the execution of the method until the awaited task completes.</span></span> <span data-ttu-id="a672a-104">L'attività rappresenta il lavoro attualmente in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a672a-104">The task represents ongoing work.</span></span>  
  
`await` <span data-ttu-id="a672a-105">può essere usato solo in un metodo asincrono modificato dalla parola chiave [async](../../../csharp/language-reference/keywords/async.md).</span><span class="sxs-lookup"><span data-stu-id="a672a-105">can only be used in an asynchronous method modified by the [async](../../../csharp/language-reference/keywords/async.md) keyword.</span></span> <span data-ttu-id="a672a-106">Tale metodo, definito usando il modificatore `async` e contenente di solito una o più espressioni `await`, viene denominato *metodo asincrono*.</span><span class="sxs-lookup"><span data-stu-id="a672a-106">Such a method, defined by using the `async` modifier and usually containing one or more `await` expressions, is referred to as an *async method*.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="a672a-107">Le parole chiave `async` e `await` sono state introdotte in C# 5.</span><span class="sxs-lookup"><span data-stu-id="a672a-107">The `async` and `await` keywords were introduced in C# 5.</span></span> <span data-ttu-id="a672a-108">Per un'introduzione alla programmazione asincrona, vedere [Asynchronous Programming with async and await](../../../csharp/programming-guide/concepts/async/index.md) (Programmazione asincrona con async e await).</span><span class="sxs-lookup"><span data-stu-id="a672a-108">For an introduction to async programming, see [Asynchronous Programming with async and await](../../../csharp/programming-guide/concepts/async/index.md).</span></span>  
  
<span data-ttu-id="a672a-109">L'attività a cui si applica l'operatore `await` viene in genere restituita da una chiamata a un metodo che implementa il [modello asincrono basato su attività](../../../standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md).</span><span class="sxs-lookup"><span data-stu-id="a672a-109">The task to which the `await` operator is applied typically is returned by a call to a method that implements the [Task-Based Asynchronous Pattern](../../../standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md).</span></span> <span data-ttu-id="a672a-110">Sono inclusi i metodi che restituiscono oggetti <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.ValueTask> e <xref:System.Threading.Tasks.ValueTask%601>.</span><span class="sxs-lookup"><span data-stu-id="a672a-110">They include methods that return <xref:System.Threading.Tasks.Task>, <xref:System.Threading.Tasks.Task%601>, <xref:System.Threading.Tasks.ValueTask>, and <xref:System.Threading.Tasks.ValueTask%601> objects.</span></span>  

<span data-ttu-id="a672a-111">Nell'esempio seguente il metodo <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A?displayProperty=nameWithType> restituisce un oggetto `Task<byte[]>`.</span><span class="sxs-lookup"><span data-stu-id="a672a-111">In the following example, the <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A?displayProperty=nameWithType> method returns a `Task<byte[]>`.</span></span> <span data-ttu-id="a672a-112">L'attività è una promessa di produrre la matrice di byte effettiva una volta completata l'attività.</span><span class="sxs-lookup"><span data-stu-id="a672a-112">The task is a promise to produce the actual byte array when the task is complete.</span></span> <span data-ttu-id="a672a-113">L'operatore <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A> sospende l'esecuzione fino al completamento delle operazioni del metodo `await`.</span><span class="sxs-lookup"><span data-stu-id="a672a-113">The `await` operator suspends execution until the work of the <xref:System.Net.Http.HttpClient.GetByteArrayAsync%2A> method is complete.</span></span> <span data-ttu-id="a672a-114">Nel frattempo, il controllo viene restituito al chiamante di `GetPageSizeAsync`.</span><span class="sxs-lookup"><span data-stu-id="a672a-114">In the meantime, control is returned to the caller of `GetPageSizeAsync`.</span></span> <span data-ttu-id="a672a-115">Al termine dell'esecuzione dell'attività, l'espressione `await` restituisce una matrice di byte.</span><span class="sxs-lookup"><span data-stu-id="a672a-115">When the task finishes execution, the `await` expression evaluates to a byte array.</span></span>  

[!code-csharp[await-example](../../../../samples/snippets/csharp/language-reference/keywords/await/await1.cs)]  

> [!IMPORTANT]
> <span data-ttu-id="a672a-116">Per un esempio completo, vedere [Procedura dettagliata: Accesso al Web con Async e Await](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md).</span><span class="sxs-lookup"><span data-stu-id="a672a-116">For the complete example, see [Walkthrough: Accessing the Web by Using Async and Await](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md).</span></span> <span data-ttu-id="a672a-117">È possibile scaricare l'esempio da [Developer Code Samples](https://code.msdn.microsoft.com/Async-Sample-Accessing-the-9c10497f) (Esempi di codice per sviluppatori) del sito Web Microsoft.</span><span class="sxs-lookup"><span data-stu-id="a672a-117">You can download the sample from [Developer Code Samples](https://code.msdn.microsoft.com/Async-Sample-Accessing-the-9c10497f) on the Microsoft website.</span></span> <span data-ttu-id="a672a-118">L'esempio è nel progetto AsyncWalkthrough_HttpClient.</span><span class="sxs-lookup"><span data-stu-id="a672a-118">The example is in the AsyncWalkthrough_HttpClient project.</span></span>  
  
<span data-ttu-id="a672a-119">Come mostrato nell'esempio precedente, se `await` viene applicato al risultato di una chiamata a un metodo che restituisce un elemento `Task<TResult>`, il tipo dell'espressione `await` è `TResult`.</span><span class="sxs-lookup"><span data-stu-id="a672a-119">As shown in the previous example, if `await` is applied to the result of a method call that returns a `Task<TResult>`, then the type of the `await` expression is `TResult`.</span></span> <span data-ttu-id="a672a-120">Se `await` viene applicato al risultato di una chiamata a un metodo che restituisce un elemento `Task`, il tipo dell'espressione `await` è `void`.</span><span class="sxs-lookup"><span data-stu-id="a672a-120">If `await` is applied to the result of a method call that returns a `Task`, then the type of the `await` expression is `void`.</span></span> <span data-ttu-id="a672a-121">Nell'esempio che segue viene illustrata la differenza.</span><span class="sxs-lookup"><span data-stu-id="a672a-121">The following example illustrates the difference.</span></span>  
  
```csharp  
// await keyword used with a method that returns a Task<TResult>.  
TResult result = await AsyncMethodThatReturnsTaskTResult();  
  
// await keyword used with a method that returns a Task.  
await AsyncMethodThatReturnsTask();  

// await keyword used with a method that returns a ValueTask<TResult>.
TResult result = await AsyncMethodThatReturnsValueTaskTResult();
```  
  
<span data-ttu-id="a672a-122">Un'espressione `await` non blocca il thread su cui è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="a672a-122">An `await` expression does not block the thread on which it is executing.</span></span> <span data-ttu-id="a672a-123">Comporta invece la registrazione, tramite il compilatore, della parte restante del metodo asincrono come continuazione dell'attività di cui si è in attesa.</span><span class="sxs-lookup"><span data-stu-id="a672a-123">Instead, it causes the compiler to sign up the rest of the async method as a continuation on the awaited task.</span></span> <span data-ttu-id="a672a-124">Il controllo quindi viene restituito al chiamante del metodo asincrono.</span><span class="sxs-lookup"><span data-stu-id="a672a-124">Control then returns to the caller of the async method.</span></span> <span data-ttu-id="a672a-125">Al termine dell'attività, ne richiama la continuazione e l'esecuzione del metodo asincrono riprende da dove era stata interrotta.</span><span class="sxs-lookup"><span data-stu-id="a672a-125">When the task completes, it invokes its continuation, and execution of the async method resumes where it left off.</span></span>  
  
<span data-ttu-id="a672a-126">Un'espressione `await` può trovarsi solo nel corpo di un metodo che la contiene, di un'espressione lambda o di un metodo anonimo, che deve essere contrassegnato con un modificatore `async`.</span><span class="sxs-lookup"><span data-stu-id="a672a-126">An `await` expression can occur only in the body of its enclosing method, lambda expression, or anonymous method, which must be marked with an `async` modifier.</span></span> <span data-ttu-id="a672a-127">Il termine *await* funge da parola chiave solo in tale contesto.</span><span class="sxs-lookup"><span data-stu-id="a672a-127">The term *await* serves as a keyword only in that context.</span></span> <span data-ttu-id="a672a-128">Altrove, viene interpretata come identificatore.</span><span class="sxs-lookup"><span data-stu-id="a672a-128">Elsewhere, it is interpreted as an identifier.</span></span> <span data-ttu-id="a672a-129">All'interno del metodo, dell'espressione lambda o del metodo anonimo, un'espressione `await` non può trovarsi nel corpo di una funzione sincrona, in un'espressione di query, nel blocco di un'[istruzione lock](../../../csharp/language-reference/keywords/lock-statement.md) o in un contesto [non sicuro](../../../csharp/language-reference/keywords/unsafe.md).</span><span class="sxs-lookup"><span data-stu-id="a672a-129">Within the method, lambda expression, or anonymous method, an `await` expression cannot occur in the body of a synchronous function, in a query expression, in the block of a [lock statement](../../../csharp/language-reference/keywords/lock-statement.md), or in an [unsafe](../../../csharp/language-reference/keywords/unsafe.md) context.</span></span>  
  
## <a name="exceptions"></a><span data-ttu-id="a672a-130">Eccezioni</span><span class="sxs-lookup"><span data-stu-id="a672a-130">Exceptions</span></span>  
<span data-ttu-id="a672a-131">La maggior parte dei metodi asincroni restituisce <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="a672a-131">Most async methods return a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>.</span></span> <span data-ttu-id="a672a-132">Le proprietà dell'attività restituita contengono informazioni sullo stato e sulla cronologia, ad esempio se l'attività è stata completata, se il metodo asincrono ha generato un'eccezione o è stato annullato e il risultato finale.</span><span class="sxs-lookup"><span data-stu-id="a672a-132">The properties of the returned task carry information about its status and history, such as whether the task is complete, whether the async method caused an exception or was canceled, and what the final result is.</span></span> <span data-ttu-id="a672a-133">L'operatore `await` accede a tali proprietà chiamando i metodi sull'oggetto restituito dal metodo `GetAwaiter`.</span><span class="sxs-lookup"><span data-stu-id="a672a-133">The `await` operator accesses those properties by calling methods on the object returned by the `GetAwaiter` method.</span></span>  
  
<span data-ttu-id="a672a-134">Se si è in attesa di un metodo asincrono che restituisce un'attività che genera un'eccezione, l'operatore `await` genera di nuovo l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="a672a-134">If you await a task-returning async method that causes an exception, the `await` operator rethrows the exception.</span></span>  
  
<span data-ttu-id="a672a-135">Se si è in attesa di un metodo asincrono che restituisce un'attività che è stato annullato, tramite l'operatore `await` viene rigenerata un'eccezione <xref:System.OperationCanceledException>.</span><span class="sxs-lookup"><span data-stu-id="a672a-135">If you await a task-returning async method that's canceled, the `await` operator rethrows an <xref:System.OperationCanceledException>.</span></span>  
  
<span data-ttu-id="a672a-136">Una singola attività in uno stato di errore può rispecchiare più eccezioni.</span><span class="sxs-lookup"><span data-stu-id="a672a-136">A single task that is in a faulted state can reflect multiple exceptions.</span></span> <span data-ttu-id="a672a-137">Ad esempio, l'attività può essere il risultato di una chiamata a <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a672a-137">For example, the task might be the result of a call to <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="a672a-138">Quando si attende tale attività, l'operazione await rigenera solo una delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="a672a-138">When you await such a task, the await operation rethrows only one of the exceptions.</span></span> <span data-ttu-id="a672a-139">Tuttavia, non è possibile prevedere quale delle eccezioni verrà rigenerata.</span><span class="sxs-lookup"><span data-stu-id="a672a-139">However, you can't predict which of the exceptions is rethrown.</span></span>  
  
<span data-ttu-id="a672a-140">Per esempi sulla gestione degli errori nei metodi asincroni, vedere [try-catch](../../../csharp/language-reference/keywords/try-catch.md).</span><span class="sxs-lookup"><span data-stu-id="a672a-140">For examples of error handling in async methods, see [try-catch](../../../csharp/language-reference/keywords/try-catch.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="a672a-141">Esempio</span><span class="sxs-lookup"><span data-stu-id="a672a-141">Example</span></span>  
<span data-ttu-id="a672a-142">L'esempio seguente restituisce il numero totale di caratteri nelle pagine di cui gli URL vengono passati come argomenti della riga di comando.</span><span class="sxs-lookup"><span data-stu-id="a672a-142">The following example returns the total number of characters in the pages whose URLs are passed to it as command line arguments.</span></span> <span data-ttu-id="a672a-143">L'esempio chiama il metodo `GetPageLengthsAsync`, contrassegnato con la parola chiave `async`.</span><span class="sxs-lookup"><span data-stu-id="a672a-143">The example calls the `GetPageLengthsAsync` method, which is marked with the `async` keyword.</span></span> <span data-ttu-id="a672a-144">Il metodo `GetPageLengthsAsync` usa a sua volta la parola chiave `await` per attendere le chiamate del metodo <xref:System.Net.Http.HttpClient.GetStringAsync%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a672a-144">The `GetPageLengthsAsync` method in turn uses the `await` keyword to await calls to the <xref:System.Net.Http.HttpClient.GetStringAsync%2A?displayProperty=nameWithType> method.</span></span>  

[!code-csharp[await-example](../../../../samples/snippets/csharp/language-reference/keywords/await/await2.cs)]  

<span data-ttu-id="a672a-145">L'esempio precedente usa C# 7.1, che supporta il [metodo `async` `Main`](../../programming-guide/main-and-command-args/index.md).</span><span class="sxs-lookup"><span data-stu-id="a672a-145">The preceding example uses C# 7.1, which supports the [`async` `Main` method](../../programming-guide/main-and-command-args/index.md).</span></span> <span data-ttu-id="a672a-146">Poiché le versioni precedenti di C# non supportano i punti di ingresso dell'applicazione che restituiscono <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601>, non è possibile applicare il modificatore `async` al metodo `Main` e attendere la chiamata del metodo `GetPageLengthsAsync`.</span><span class="sxs-lookup"><span data-stu-id="a672a-146">Because earlier C# versions don't support application entry points that return <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>, you cannot apply the `async` modifier to the `Main` method and await the `GetPageLengthsAsync` method call.</span></span> <span data-ttu-id="a672a-147">In tal caso, è possibile assicurarsi che il metodo `Main` resti in attesa del completamento dell'operazione asincrona recuperando il valore della proprietà <xref:System.Threading.Tasks.Task%601.Result?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a672a-147">In that case, you can ensure that the `Main` method waits for the async operation to complete by retrieving the value of the <xref:System.Threading.Tasks.Task%601.Result?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="a672a-148">Per le attività che non restituiscono un valore, è possibile chiamare il metodo <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a672a-148">For tasks that do not return a value, you can call the <xref:System.Threading.Tasks.Task.Wait%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="a672a-149">Per informazioni su come selezionare la versione del linguaggio, vedere [Selezionare la versione del linguaggio C#](../configure-language-version.md).</span><span class="sxs-lookup"><span data-stu-id="a672a-149">For information about how to select the language version, see [Select the C# language version](../configure-language-version.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="a672a-150">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="a672a-150">See also</span></span>

- [<span data-ttu-id="a672a-151">Programmazione asincrona con async e await</span><span class="sxs-lookup"><span data-stu-id="a672a-151">Asynchronous Programming with async and await</span></span>](../../../csharp/programming-guide/concepts/async/index.md)
- [<span data-ttu-id="a672a-152">Procedura dettagliata: Accesso al Web con Async e Await</span><span class="sxs-lookup"><span data-stu-id="a672a-152">Walkthrough: Accessing the Web by Using Async and Await</span></span>](../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md)
- [<span data-ttu-id="a672a-153">async</span><span class="sxs-lookup"><span data-stu-id="a672a-153">async</span></span>](../../../csharp/language-reference/keywords/async.md)
